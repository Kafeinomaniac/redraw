!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.chartpen=e():t.chartpen=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return t[i].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t){for(var e=atob(t.split(",")[1]),n=[],i=0;i<e.length;i++)n.push(e.charCodeAt(i));return new Blob([new Uint8Array(n)],{type:"image/png"})}function a(t,e){if(e&&e.tools){var n={};for(var i in e.tools){var o=e.tools[i];n[o]=t[o]}return n}return t}function r(t,e,n,i){var o={};for(var s in t[i].options)t[i].options.hasOwnProperty(s)&&(e[i]&&e[i]&&e[i].hasOwnProperty(s)?o[s]=e[i][s]:g.indexOf(s)>-1&&n.hasOwnProperty(s)?o[s]=n[s]:o[s]=t[i].options[s]);return o}var c=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=n(1),u=i(l),h=n(2),f=i(h),d=n(4),v=i(d),p=n(5),b=i(p),m={tools:{}},g=["color","activeColor"],y=function(){function t(e,n){o(this,t),this.events=new v["default"],n=n||{},this._canvas=new f["default"](e,this.events,n),n.jsonContent&&this._canvas.loadFromJSON(n.jsonContent),this.controls=this.initializeTools(this.events,n)}return c(t,[{key:"getDataUrlForExport",value:function(){return this._canvas.canvas.deactivateAllWithDispatch(),this._canvas.canvas.toDataURL({format:"png",multiplier:1/this._canvas.scale})}},{key:"toBase64URL",value:function(){return this.getDataUrlForExport()}},{key:"toDataBlob",value:function(){return s(this.getDataUrlForExport())}},{key:"toJson",value:function(t){this.controls.cancelActiveTool();var e=this._canvas.canvas.toObject(["lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY","lockUniScaling","hasControls","hasRotatingPoint","selectable","fill","padding"]);return t||delete e.backgroundImage,JSON.stringify(e)}},{key:"fromJson",value:function(t){this._canvas.loadFromJSON(t)}},{key:"isEmpty",value:function(){return 0===this._canvas.getAllObjects().length}},{key:"isDirty",value:function(){return!0}},{key:"getCanvas",value:function(){return this._canvas.canvas}},{key:"on",value:function(t,e,n,i){this.events.subscribeTo(t,"cx-"+n,e,i)}},{key:"off",value:function(t,e){this.events.unsubscribeTo(t,"cx-"+e)}},{key:"initializeTools",value:function(t,e){e.toolSettings=e.toolSettings||{};var n=a(m.tools,e);for(var i in n){var o=r(m.tools,e.toolSettings,e,i);m.tools[i].options=o,new m.tools[i].toolFn(this._canvas,t,o)}var s=new b["default"](t,e);return s.setupTools(n,this._canvas.canvasContainer,e),s}}]),t}();m.Annotation=y,m.registerTool=function(t,e,n){m.tools[t]={address:t,toolFn:e,options:n},m.tools[t].options.buttonClass=m.tools[t].options.buttonClass||""},(new u["default"]).appendToWindow("redraw",m)},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o="undefined"!=typeof window,s=function(){function t(){n(this,t),this.document=o?document:{},this.window=o?window:{}}return i(t,[{key:"appendToWindow",value:function(t,e){return!!o&&(window[t]=e,!0)}},{key:"getFromWindow",value:function(t){return window?window[t]:{getFromWindow:function(){},tools:[]}}}]),t}();e["default"]=s},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(3),r=i(a),c=function(){function t(e,n,i){o(this,t),this.options=i,this.eventAggregator=n;var s=e.parentNode,a=document.createElement("div");a.className=r["default"].CSS.PARENT,this.scale=1,s.insertBefore(a,e),s.removeChild(e);var c=document.createElement("canvas"),l=document.createElement("div");l.className=r["default"].CSS.CANVAS_WRAPPER,l.appendChild(c),a.appendChild(l),this.canvasElem=c,this.canvasContainer=a,this.canvasLeft=c.offsetLeft,this.canvas=new fabric.Canvas(c),this.imgElement=e;var u=this,h=function(){u.setupImage()},f=new Image;f.addEventListener("load",h,!1),f.src=this.imgElement.src}return s(t,[{key:"setupImage",value:function(){function t(t){return function(){t.renderAll(),n.notify("canvas-loaded","CANVAS")}}if(this.image=new fabric.Image(this.imgElement),this.options.maxWidth&&this.options.maxWidth<this.image.width&&(this.scale=this.options.maxWidth/this.image.width),this.options.maxHeight&&this.options.maxHeight<this.image.height){var e=this.options.maxHeight/this.image.height;this.scale>e&&(this.scale=e)}this.width=this.scale*this.imgElement.width,this.height=this.scale*this.imgElement.height,this.canvas.setDimensions({width:this.width,height:this.height}),this.image.setScaleX(this.scale),this.image.setScaleY(this.scale);var n=this.eventAggregator;if(this.canvas.setBackgroundImage(this.image,t(this.canvas),{}),this.options.maxWidth&&this.options.maxWidth<this.image.width&&(this.scale=this.options.maxWidth/this.image.width),this.options.maxHeight&&this.options.maxHeight<this.image.height){var i=this.options.maxHeight/this.image.height;this.scale>i&&(this.scale=i)}this.eventAggregator.subscribeTo("TOOL_USAGE","toolbar",function(t,e,n){"active"===n?this.canvas.defaultCursor="crosshair":this.canvas.defaultCursor="default"},this)}},{key:"loadFromJSON",value:function(t){this.canvas.clear(),this.canvas.loadFromJSON(t,this.canvas.renderAll.bind(this.canvas))}},{key:"getCanvasTop",value:function(){return this.canvasContainer.offsetTop}},{key:"getAllObjects",value:function(){return this.canvas.getObjects()}},{key:"enableSelection",value:function(t){this.canvas.selection=t,this.canvas.forEachObject(function(e){e.selectable=t})}}]),t}();e["default"]=c},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]={TOOL:{ARROW:"arrow",DELETE:"delete",HORIZONTAL_LINE:"horizontalLine",PIXELATE:"pixelate",RECTANGLE:"rectangle",RESET:"reset",TEXT:"text"},DEFAULT_COLOR:"#33e",DEFAULT_ACTIVE_COLOR:"#55f",CSS:{ACTIVE_BUTTON:"active",DISABLED_BUTTON:"disabled",BUTTON:"redraw-btn",PARENT:"redraw-parent",TOOLBAR:"redraw-toolbar",CANVAS_WRAPPER:"redraw-canvas"}}},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(){n(this,t),this.subscriptionsByTopic={}}return i(t,[{key:"subscribeTo",value:function(t,e,n,i){this.subscriptionsByTopic[t]||(this.subscriptionsByTopic[t]=[]),this.subscriptionsByTopic[t].push({subscriber:e,callbackFn:n,invokationScope:i})}},{key:"unsubscribeTo",value:function(t,e){for(var n in this.subscriptionsByTopic[t])this.subscriptionsByTopic[t][n].subscriber===e&&this.subscriptionsByTopic[t].splice(n,1)}},{key:"notify",value:function(t,e,n){for(var i in this.subscriptionsByTopic[t]){var o=void 0;this.subscriptionsByTopic[t][i].invokationScope&&(o=this.subscriptionsByTopic[t][i].invokationScope),this.subscriptionsByTopic[t][i].callbackFn.apply(o,[t,e,n])}}}]),t}();e["default"]=o},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(e){var n=e.split(" ");n.forEach(function(e){t.classList.add(e)})}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),r=i(a),c=function l(t,e){function n(e){return function(){i&&t.notify(i,"toolbar","toolbar-deactivate"),i!==e?(i=e,t.notify(e,"toolbar","toolbar-click")):i=void 0}}o(this,l),this.toolsInUse={};var i=void 0;this.cancelActiveTool=function(){i&&(t.notify(i,"toolbar","toolbar-deactivate"),i=void 0)};var a=function(e){46!==e.keyCode&&27!==e.keyCode||t.notify("keydown","toolbar",e.keyCode)};window.addEventListener("keydown",a,!1),this.setupTools=function(o,a,c){var l=document.createElement("div");s(l,r["default"].CSS.TOOLBAR),s(l,e.toolbarClass),c.toolbarFirst===!0?a.insertBefore(l,a.firstChild):a.appendChild(l);for(var u in o){var h=document.createElement("button");h.innerHTML=o[u].options.label,h.classList.add(r["default"].CSS.BUTTON),s(h,c.buttonClass),s(h,o[u].options.buttonClass),h.onclick=n(o[u].address),this.toolsInUse[o[u].address]=h,l.appendChild(h)}var f=c.buttonActiveClass||r["default"].CSS.ACTIVE_BUTTON,d=c.buttonDisabledClass||r["default"].CSS.DISABLED_BUTTON;t.subscribeTo("TOOL_USAGE","toolbar",function(t,e,n){var o=this.toolsInUse[e];"active"!==n?(e===i&&(i=void 0),o.classList.remove(f)):o.classList.add(f)},this),t.subscribeTo("tool-enabled","toolbar",function(t,e,n){n?this.toolsInUse[e].classList.remove(d):this.toolsInUse[e].classList.add(d)},this)}};e["default"]=c}])});
//# sourceMappingURL=redraw.min.js.map
