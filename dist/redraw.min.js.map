{"version":3,"sources":["redraw.min.js"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","dataURItoBlob","encodedData","decodedData","atob","split","array","i","length","push","charCodeAt","Blob","Uint8Array","type","getToolsFromUserSettings","allTools","options","tools","definedTools","t","toolName","overwriteProps","allProps","precedenceProps","globalOptions","results","hasOwnProperty","globalOverrides","indexOf","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","_browserApi","_browserApi2","_canvasWrapper","_canvasWrapper2","_eventAggregator","_eventAggregator2","_controlsDispatcher","_controlsDispatcher2","redrawNs","Redraw","imgElement","events","_canvas","jsonContent","loadFromJSON","controls","initializeTools","value","canvas","deactivateAllWithDispatch","toDataURL","format","multiplier","scale","getDataUrlForExport","includeImage","cancelActiveTool","jsObj","toObject","backgroundImage","JSON","stringify","jsonRepresentation","getAllObjects","topic","callbackFn","subscriberId","scope","subscribeTo","unsubscribeTo","toolSettings","toolsInUse","passedProps","toolFn","setupTools","canvasContainer","Annotation","registerTool","_name","_toolFn","_options","address","buttonClass","appendToWindow","isBrowser","window","Browser","document","attributeName","getFromWindow","_canvasConst","_canvasConst2","Canvas","eventAggregator","parent","parentNode","redrawWrapper","createElement","className","CSS","PARENT","insertBefore","removeChild","canvasElem","canvasWrapper","CANVAS_WRAPPER","appendChild","canvasLeft","offsetLeft","fabric","_this","delayedSetup","setupImage","tmp","Image","addEventListener","src","getBinder","renderAll","event","notify","image","maxWidth","width","maxHeight","height","scaleY","setDimensions","setScaleX","setScaleY","setBackgroundImage","_scaleY","subscriptionId","sender","status","defaultCursor","clear","bind","offsetTop","getObjects","isEnabled","selection","forEachObject","o","selectable","TOOL","ARROW","DELETE","HORIZONTAL_LINE","PIXELATE","RECTANGLE","RESET","TEXT","DEFAULT_COLOR","DEFAULT_ACTIVE_COLOR","ACTIVE_BUTTON","DISABLED_BUTTON","BUTTON","TOOLBAR","EventAggregator","subscriptionsByTopic","onNotifyFn","_invokationScope","subscriber","invokationScope","_subscriber","j","splice","payload","s2","undefined","apply","addClasses","btnObj","classes","allClasses","forEach","clazz","classList","add","ControlsDispatcher","notifyActive","activeTool","manageKeys","e","keyCode","domParent","mainOptions","container","toolbarClass","toolbarFirst","firstChild","btn","innerHTML","label","onclick","btnActiveCss","buttonActiveClass","btnDisabledCss","buttonDisabledClass","currTool","remove"],"mappings":"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","file":"redraw.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"chartpen\"] = factory();\n\telse\n\t\troot[\"chartpen\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _browserApi = __webpack_require__(1);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _canvasWrapper = __webpack_require__(2);\n\t\n\tvar _canvasWrapper2 = _interopRequireDefault(_canvasWrapper);\n\t\n\tvar _eventAggregator = __webpack_require__(4);\n\t\n\tvar _eventAggregator2 = _interopRequireDefault(_eventAggregator);\n\t\n\tvar _controlsDispatcher = __webpack_require__(5);\n\t\n\tvar _controlsDispatcher2 = _interopRequireDefault(_controlsDispatcher);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * Namespace-root, that will be set to window-Object.\n\t * @access private\n\t */\n\tvar redrawNs = {\n\t  tools: {}\n\t};\n\t\n\t/**\n\t * Makes a blob from eg base64-string.\n\t * @access private\n\t * @param data {string} encodedData - to encode\n\t * @returns {Blob} results\n\t */\n\tfunction dataURItoBlob(encodedData) {\n\t  var decodedData = atob(encodedData.split(',')[1]);\n\t  var array = []; // 8-bit unsigned array\n\t  for (var i = 0; i < decodedData.length; i++) {\n\t    array.push(decodedData.charCodeAt(i));\n\t  }\n\t\n\t  return new Blob([new Uint8Array(array)], {\n\t    type: 'image/png'\n\t  });\n\t}\n\t\n\t/**\n\t * If the user has defined the options.tools, then use this to\n\t * extract the sepcified subset from allTools.\n\t * @access private\n\t * @param {Object[]} allTools - should be tools to pick from.\n\t * @param {Object} options - with or without property tools.\n\t * @returns {Object} containing all or the selected tools.\n\t */\n\tfunction getToolsFromUserSettings(allTools, options) {\n\t\n\t  if (options && options.tools) {\n\t    var definedTools = {};\n\t    for (var t in options.tools) {\n\t      var toolName = options.tools[t];\n\t      definedTools[toolName] = allTools[toolName];\n\t    }\n\t\n\t    return definedTools;\n\t  } else {\n\t    return allTools;\n\t  }\n\t}\n\t\n\t/**\n\t * Defines the options-properties allowed to infect all tools-settings.\n\t * @access private\n\t */\n\tvar globalOverrides = ['color', 'activeColor'];\n\t\n\t/**\n\t * Figures out which options should be applied for a particular toolName.\n\t * @access private\n\t * @param {Object} allProps - already defined options, that shold not be lost, but perhaps\n\t * replaced if defined in precedenceProps or globalOptions.\n\t * @param {Object} precedenceProps - that may have a property named toolName, that will\n\t * replace options from allProps.\n\t * @param {Object} globalOptions - top-level options that will overwrite allProp but not precedenceProps\n\t * @param {string} toolName - name of the tool, which options is processed\n\t * @returns {Object} with tool applies options\n\t */\n\tfunction overwriteProps(allProps, precedenceProps, globalOptions, toolName) {\n\t  var results = {};\n\t\n\t  for (var p in allProps[toolName].options) {\n\t    if (allProps[toolName].options.hasOwnProperty(p)) {\n\t      if (precedenceProps[toolName] && precedenceProps[toolName] && precedenceProps[toolName].hasOwnProperty(p)) {\n\t        results[p] = precedenceProps[toolName][p];\n\t      } else if (globalOverrides.indexOf(p) > -1 && globalOptions.hasOwnProperty(p)) {\n\t        results[p] = globalOptions[p];\n\t      } else {\n\t        results[p] = allProps[toolName].options[p];\n\t      }\n\t    }\n\t  }\n\t\n\t  return results;\n\t}\n\t\n\t/**\n\t * Main module, and the only public api for usage.\n\t * @module redraw\n\t */\n\t\n\tvar Redraw = function () {\n\t  /**\n\t   * Redraw constructor. Bootstraps the canvas and tools.\n\t   * @constructor\n\t   * @param {Object} imgElement - The dom element that holds the image.\n\t   * @param {Object} options - Options.\n\t   */\n\t  function Redraw(imgElement, options) {\n\t    _classCallCheck(this, Redraw);\n\t\n\t    this.events = new _eventAggregator2.default();\n\t    options = options || {};\n\t    this._canvas = new _canvasWrapper2.default(imgElement, this.events, options); // Needs defactor\n\t\n\t    if (options.jsonContent) {\n\t      this._canvas.loadFromJSON(options.jsonContent);\n\t    }\n\t\n\t    this.controls = this.initializeTools(this.events, options);\n\t  }\n\t  /**\n\t   * Get the png-representation of the canvas.\n\t   * @access public\n\t   * @returns {string} with base64 encoded png.\n\t   */\n\t\n\t\n\t  _createClass(Redraw, [{\n\t    key: 'getDataUrlForExport',\n\t    value: function getDataUrlForExport() {\n\t      this._canvas.canvas.deactivateAllWithDispatch();\n\t      return this._canvas.canvas.toDataURL({\n\t        format: 'png',\n\t        multiplier: 1 / this._canvas.scale\n\t      });\n\t    }\n\t\n\t    /**\n\t     * Get the base64-encoded png-representation of the canvas.\n\t     * @access public\n\t     * @returns {string} with base64 encoded png.\n\t     */\n\t\n\t  }, {\n\t    key: 'toBase64URL',\n\t    value: function toBase64URL() {\n\t      return this.getDataUrlForExport();\n\t    }\n\t\n\t    /**\n\t     * Get the binary png-representation of the canvas.\n\t     * @access public\n\t     * @returns {Blob} with canvas as png.\n\t     */\n\t\n\t  }, {\n\t    key: 'toDataBlob',\n\t    value: function toDataBlob() {\n\t      return dataURItoBlob(this.getDataUrlForExport());\n\t    }\n\t\n\t    /**\n\t     * Get the json-representation of the canvas.\n\t     * @access public\n\t     * @param {boolean} includeImage - true if background-image should be included in the json.\n\t     * @returns {string} with json.\n\t     */\n\t\n\t  }, {\n\t    key: 'toJson',\n\t    value: function toJson(includeImage) {\n\t      this.controls.cancelActiveTool();\n\t      var jsObj = this._canvas.canvas.toObject(['lockMovementX', 'lockMovementY', 'lockRotation', 'lockScalingX', 'lockScalingY', 'lockUniScaling', 'hasControls', 'hasRotatingPoint', 'selectable', 'fill', 'padding']);\n\t\n\t      if (!includeImage) {\n\t        delete jsObj.backgroundImage;\n\t      }\n\t\n\t      return JSON.stringify(jsObj);\n\t    }\n\t\n\t    /**\n\t     * Resets image and loads content from provided json.\n\t     * @access public\n\t     * @param {string} jsonRepresentation - to provide as current state of the canvas.\n\t     */\n\t\n\t  }, {\n\t    key: 'fromJson',\n\t    value: function fromJson(jsonRepresentation) {\n\t      this._canvas.loadFromJSON(jsonRepresentation);\n\t    }\n\t\n\t    /**\n\t     * Tells whether or not any objects are present in the canvas, i.e. arrows, rectangles other than the image itself.\n\t     * @access public\n\t     * @returns {boolean} true if there are obejcts, i.e.\n\t     */\n\t\n\t  }, {\n\t    key: 'isEmpty',\n\t    value: function isEmpty() {\n\t      return this._canvas.getAllObjects().length === 0;\n\t    }\n\t  }, {\n\t    key: 'isDirty',\n\t    value: function isDirty() {\n\t      return true;\n\t    }\n\t\n\t    /**\n\t     * Returns the canvas representation, as is from Fabric.js\n\t     * @access public\n\t     * @returns {Object} canvas, see http://fabricjs.com/.\n\t     */\n\t\n\t  }, {\n\t    key: 'getCanvas',\n\t    value: function getCanvas() {\n\t      return this._canvas.canvas;\n\t    }\n\t  }, {\n\t    key: 'on',\n\t    value: function on(topic, callbackFn, subscriberId, scope) {\n\t      this.events.subscribeTo(topic, 'cx-' + subscriberId, callbackFn, scope);\n\t    }\n\t  }, {\n\t    key: 'off',\n\t    value: function off(topic, subscriberId) {\n\t      this.events.unsubscribeTo(topic, 'cx-' + subscriberId);\n\t    }\n\t\n\t    /**\n\t     * Initializes all selected tools.\n\t     * @param {EventAggregator} events - used for all mediated communications.\n\t     * @param {Object} options - settings for all tools.\n\t     */\n\t\n\t  }, {\n\t    key: 'initializeTools',\n\t    value: function initializeTools(events, options) {\n\t      var localToolSettings = {};\n\t      options.toolSettings = options.toolSettings || {};\n\t      var toolsInUse = getToolsFromUserSettings(redrawNs.tools, options);\n\t\n\t      for (var toolName in toolsInUse) {\n\t        var passedProps = overwriteProps(redrawNs.tools, options.toolSettings, options, toolName);\n\t\n\t        redrawNs.tools[toolName].options = passedProps;\n\t\n\t        new redrawNs.tools[toolName].toolFn(this._canvas, events, passedProps);\n\t      }\n\t\n\t      var controls = new _controlsDispatcher2.default(events, options);\n\t      controls.setupTools(toolsInUse, this._canvas.canvasContainer, options);\n\t      return controls;\n\t    }\n\t  }]);\n\t\n\t  return Redraw;\n\t}();\n\t\n\tredrawNs.Annotation = Redraw;\n\t/**\n\t * Used by tools to register themselves to be available for usage.\n\t * @access public\n\t * @param {string} _name - name of tool.\n\t * @param {function(canvas: CanvasWrapper, events: EventAggregator, passedProps: Object)} _toolFn - callback function, invoked upon initialization of the tools.\n\t * @param {Object} _options - options, to be used as default ones.\n\t */\n\tredrawNs.registerTool = function (_name, _toolFn, _options) {\n\t  redrawNs.tools[_name] = {\n\t    address: _name,\n\t    toolFn: _toolFn,\n\t    options: _options\n\t  };\n\t\n\t  // buttonClass is an attribute that applies to all tools\n\t  redrawNs.tools[_name].options.buttonClass = redrawNs.tools[_name].options.buttonClass || '';\n\t};\n\t\n\tnew _browserApi2.default().appendToWindow('redraw', redrawNs);\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar isBrowser = typeof window !== 'undefined';\n\t\n\t/**\n\t * Facade of the browser apis. The main purpose id to facilitate testing.\n\t */\n\t\n\tvar Browser = function () {\n\t  /**\n\t   * Contructor that determines if there is a browser present.\n\t   * @constructor\n\t   */\n\t  function Browser() {\n\t    _classCallCheck(this, Browser);\n\t\n\t    this.document = isBrowser ? document : {};\n\t    this.window = isBrowser ? window : {};\n\t  }\n\t\n\t  /**\n\t   * Appends property to the browser window object.\n\t   * @param {string} attributeName - Name of the property to create/assign.\n\t   * @param {Object} obj - value to set.\n\t   */\n\t\n\t\n\t  _createClass(Browser, [{\n\t    key: 'appendToWindow',\n\t    value: function appendToWindow(attributeName, obj) {\n\t\n\t      if (isBrowser) {\n\t        window[attributeName] = obj;\n\t        return true;\n\t      }\n\t      return false;\n\t    }\n\t\n\t    /**\n\t     * Use to retrieve property from the browser window object.\n\t     * @param {string} attributeName - Name of the property to create/assign.\n\t     * @returns {Object} obj - retrieved value, or mock if not browser.\n\t     */\n\t\n\t  }, {\n\t    key: 'getFromWindow',\n\t    value: function getFromWindow(attributeName) {\n\t      if (window) {\n\t        return window[attributeName];\n\t      }\n\t\n\t      return {\n\t        getFromWindow: function getFromWindow() {},\n\t        tools: []\n\t      };\n\t    }\n\t  }]);\n\t\n\t  return Browser;\n\t}();\n\t\n\texports.default = Browser;\n\n/***/ },\n/* 2 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _canvasConst = __webpack_require__(3);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * Gets the scroll position of a dom element.\n\t * @access private\n\t * @param {Object} elem - target element.\n\t */\n\tfunction scrollPosition(elem) {\n\t  var left = 0;\n\t  var top = 0;\n\t\n\t  do {\n\t    left += elem.scrollLeft;\n\t    top += elem.scrollTop;\n\t  } while (elem = elem.offsetParent);\n\t\n\t  return [left, top];\n\t}\n\t\n\t/**\n\t * Canvas object that facilitates\n\t */\n\t\n\tvar Canvas = function () {\n\t  /**\n\t   * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t   * @constructor\n\t   * @param {Object} imgElement - dom element that will be replaced and\n\t   * used as background for canvas.\n\t   * @param {EventAggregator} eventAggregator - Event mediator.\n\t   * @param {Object} options - parameters used to setup looks and all tools preferences.\n\t   */\n\t  function Canvas(imgElement, eventAggregator, options) {\n\t    _classCallCheck(this, Canvas);\n\t\n\t    this.options = options;\n\t    this.eventAggregator = eventAggregator;\n\t    var parent = imgElement.parentNode;\n\t    var redrawWrapper = document.createElement('div');\n\t    redrawWrapper.className = _canvasConst2.default.CSS.PARENT;\n\t    this.scale = 1;\n\t    parent.insertBefore(redrawWrapper, imgElement);\n\t    parent.removeChild(imgElement);\n\t\n\t    var canvasElem = document.createElement('canvas');\n\t    var canvasWrapper = document.createElement('div');\n\t    canvasWrapper.className = _canvasConst2.default.CSS.CANVAS_WRAPPER;\n\t    canvasWrapper.appendChild(canvasElem);\n\t    redrawWrapper.appendChild(canvasWrapper);\n\t\n\t    this.canvasElem = canvasElem;\n\t\n\t    this.canvasContainer = redrawWrapper;\n\t    this.canvasLeft = canvasElem.offsetLeft;\n\t    this.canvas = new fabric.Canvas(canvasElem);\n\t    this.imgElement = imgElement;\n\t\n\t    /* wait until the image is surely loaded to make the setup */\n\t    var _this = this;\n\t    var delayedSetup = function delayedSetup() {\n\t      _this.setupImage();\n\t    };\n\t\n\t    var tmp = new Image();\n\t    tmp.addEventListener('load', delayedSetup, false);\n\t    tmp.src = this.imgElement.src;\n\t  }\n\t\n\t  _createClass(Canvas, [{\n\t    key: 'setupImage',\n\t    value: function setupImage() {\n\t      this.image = new fabric.Image(this.imgElement);\n\t      if (this.options.maxWidth && this.options.maxWidth < this.image.width) {\n\t        this.scale = this.options.maxWidth / this.image.width;\n\t      }\n\t\n\t      if (this.options.maxHeight && this.options.maxHeight < this.image.height) {\n\t        var scaleY = this.options.maxHeight / this.image.height;\n\t        if (this.scale > scaleY) {\n\t          this.scale = scaleY;\n\t        }\n\t      }\n\t\n\t      this.width = this.scale * this.imgElement.width;\n\t      this.height = this.scale * this.imgElement.height;\n\t\n\t      this.canvas.setDimensions({\n\t        width: this.width,\n\t        height: this.height\n\t      });\n\t\n\t      this.image.setScaleX(this.scale);\n\t      this.image.setScaleY(this.scale);\n\t      var event = this.eventAggregator;\n\t\n\t      function getBinder(_canvas) {\n\t        return function () {\n\t          _canvas.renderAll();\n\t          event.notify('canvas-loaded', 'CANVAS');\n\t        };\n\t      }\n\t\n\t      this.canvas.setBackgroundImage(this.image, getBinder(this.canvas), {});\n\t\n\t      if (this.options.maxWidth && this.options.maxWidth < this.image.width) {\n\t        this.scale = this.options.maxWidth / this.image.width;\n\t      }\n\t\n\t      if (this.options.maxHeight && this.options.maxHeight < this.image.height) {\n\t        var _scaleY = this.options.maxHeight / this.image.height;\n\t        if (this.scale > _scaleY) {\n\t          this.scale = _scaleY;\n\t        }\n\t      }\n\t\n\t      this.eventAggregator.subscribeTo('TOOL_USAGE', 'toolbar', function (subscriptionId, sender, status) {\n\t        if (status === 'active') {\n\t          this.canvas.defaultCursor = 'crosshair';\n\t        } else {\n\t          this.canvas.defaultCursor = 'default';\n\t        }\n\t      }, this);\n\t    }\n\t  }, {\n\t    key: 'loadFromJSON',\n\t    value: function loadFromJSON(jsonContent) {\n\t      this.canvas.clear();\n\t      this.canvas.loadFromJSON(jsonContent, this.canvas.renderAll.bind(this.canvas));\n\t    }\n\t\n\t    /**\n\t     * Gets the top position of the canvas dom element.\n\t     * @access public\n\t     * @returns {number} position in pixels?\n\t     */\n\t\n\t  }, {\n\t    key: 'getCanvasTop',\n\t    value: function getCanvasTop() {\n\t      return this.canvasContainer.offsetTop;\n\t    }\n\t\n\t    /**\n\t     * Gets the array of all objects of the canvas.\n\t     * @access public\n\t     * @returns {Array} with canvas object, or undefined if empty.\n\t     */\n\t\n\t  }, {\n\t    key: 'getAllObjects',\n\t    value: function getAllObjects() {\n\t      return this.canvas.getObjects();\n\t    }\n\t\n\t    /**\n\t     * Set/unset whether or not it is possible to select objects of the canvas.\n\t     * @access pulic\n\t     * @param {boolean} isEnabled - true if selection is enabled, false otherwise.\n\t     */\n\t\n\t  }, {\n\t    key: 'enableSelection',\n\t    value: function enableSelection(isEnabled) {\n\t      this.canvas.selection = isEnabled; // Restore fabricjs selection-box\n\t      this.canvas.forEachObject(function (o) {\n\t        o.selectable = isEnabled;\n\t      });\n\t    }\n\t  }]);\n\t\n\t  return Canvas;\n\t}();\n\t\n\texports.default = Canvas;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = {\n\t  TOOL: {\n\t    ARROW: 'arrow',\n\t    DELETE: 'delete',\n\t    HORIZONTAL_LINE: 'horizontalLine',\n\t    PIXELATE: 'pixelate',\n\t    RECTANGLE: 'rectangle',\n\t    RESET: 'reset',\n\t    TEXT: 'text'\n\t  },\n\t  DEFAULT_COLOR: '#33e',\n\t  DEFAULT_ACTIVE_COLOR: '#55f',\n\t  CSS: {\n\t    ACTIVE_BUTTON: 'active',\n\t    DISABLED_BUTTON: 'disabled',\n\t    BUTTON: 'redraw-btn',\n\t    PARENT: 'redraw-parent',\n\t    TOOLBAR: 'redraw-toolbar',\n\t    CANVAS_WRAPPER: 'redraw-canvas'\n\t  }\n\t};\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * Mediator for events.\n\t */\n\tvar EventAggregator = function () {\n\t  /**\n\t   * Contructor that initializes internal stuff.\n\t   * @constructor\n\t   */\n\t  function EventAggregator() {\n\t    _classCallCheck(this, EventAggregator);\n\t\n\t    this.subscriptionsByTopic = {};\n\t  }\n\t\n\t  /**\n\t   * Registers a subscriber for a specific event topic.\n\t   * @param {string} topic - name of the event type / topic.\n\t   * @param {string} subscriberId - id the subscriber, must be unique.\n\t   * @param {function(topic: string, sender: string, payload: Object)} onNotifyFn - callback\n\t   * invoked upon when upon notification.\n\t   * @param {Object} [_invokationScope] - scope to be used when invoking callback.\n\t   */\n\t\n\t\n\t  _createClass(EventAggregator, [{\n\t    key: \"subscribeTo\",\n\t    value: function subscribeTo(topic, subscriberId, onNotifyFn, _invokationScope) {\n\t      if (!this.subscriptionsByTopic[topic]) {\n\t        this.subscriptionsByTopic[topic] = [];\n\t      }\n\t\n\t      this.subscriptionsByTopic[topic].push({\n\t        subscriber: subscriberId,\n\t        callbackFn: onNotifyFn,\n\t        invokationScope: _invokationScope\n\t      });\n\t    }\n\t\n\t    // ToDo needs test\n\t    /**\n\t     * Unregisters a subscriber from a specific event topic.\n\t     * @param {string} topic - name of the event type / topic.\n\t     * @param {string} _subscriber - id the unique subscriber.\n\t     */\n\t\n\t  }, {\n\t    key: \"unsubscribeTo\",\n\t    value: function unsubscribeTo(topic, _subscriber) {\n\t      for (var j in this.subscriptionsByTopic[topic]) {\n\t        if (this.subscriptionsByTopic[topic][j].subscriber === _subscriber) {\n\t          this.subscriptionsByTopic[topic].splice(j, 1);\n\t        }\n\t      }\n\t    }\n\t\n\t    /**\n\t     * Called to notify all subscribers of this topic\n\t     * @param {string} topic - name of the event type / topic.\n\t     * @param {string} sender - address of the sender.\n\t     * @param {Object} payload - any data to pass to the subscriber.\n\t     */\n\t\n\t  }, {\n\t    key: \"notify\",\n\t    value: function notify(topic, sender, payload) {\n\t      for (var s2 in this.subscriptionsByTopic[topic]) {\n\t        var scope = undefined;\n\t        if (this.subscriptionsByTopic[topic][s2].invokationScope) {\n\t          scope = this.subscriptionsByTopic[topic][s2].invokationScope;\n\t        }\n\t\n\t        this.subscriptionsByTopic[topic][s2].callbackFn.apply(scope, [topic, sender, payload]);\n\t      }\n\t    }\n\t  }]);\n\t\n\t  return EventAggregator;\n\t}();\n\t\n\texports.default = EventAggregator;\n\n/***/ },\n/* 5 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _canvasConst = __webpack_require__(3);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * Adds a class to the array of classes.\n\t * @private\n\t */\n\tfunction addClasses(btnObj, classes) {\n\t  if (!classes) return;\n\t  var allClasses = classes.split(' ');\n\t\n\t  allClasses.forEach(function (clazz) {\n\t    btnObj.classList.add(clazz);\n\t  });\n\t}\n\t\n\t/**\n\t * Main manager for the toolbar.\n\t */\n\t\n\tvar ControlsDispatcher =\n\t/**\n\t * Controls contructor. Is provided with canvas-wrapper and options to initialize to toolbar.\n\t * @constructor\n\t * @param {EventAggregator} eventAggregator - Event mediator.\n\t * @param {Object} options - from user.\n\t */\n\tfunction ControlsDispatcher(eventAggregator, options) {\n\t  _classCallCheck(this, ControlsDispatcher);\n\t\n\t  this.toolsInUse = {};\n\t  var activeTool = void 0;\n\t\n\t  function notifyActive(topic) {\n\t    return function () {\n\t      if (activeTool) {\n\t        eventAggregator.notify(activeTool, 'toolbar', 'toolbar-deactivate');\n\t      }\n\t\n\t      if (activeTool !== topic) {\n\t        activeTool = topic;\n\t        eventAggregator.notify(topic, 'toolbar', 'toolbar-click');\n\t      } else {\n\t        activeTool = undefined;\n\t      }\n\t    };\n\t  }\n\t\n\t  this.cancelActiveTool = function () {\n\t\n\t    if (activeTool) {\n\t      eventAggregator.notify(activeTool, 'toolbar', 'toolbar-deactivate');\n\t      activeTool = undefined;\n\t    }\n\t  };\n\t\n\t  var manageKeys = function manageKeys(e) {\n\t    if (e.keyCode === 46 || e.keyCode === 27) {\n\t      eventAggregator.notify('keydown', 'toolbar', e.keyCode);\n\t    }\n\t  };\n\t\n\t  window.addEventListener('keydown', manageKeys, false);\n\t\n\t  this.setupTools = function (tools, domParent, mainOptions) {\n\t    var container = document.createElement('div');\n\t\n\t    addClasses(container, _canvasConst2.default.CSS.TOOLBAR);\n\t    addClasses(container, options.toolbarClass);\n\t\n\t    if (mainOptions.toolbarFirst === true) {\n\t      domParent.insertBefore(container, domParent.firstChild);\n\t    } else {\n\t      domParent.appendChild(container);\n\t    }\n\t\n\t    for (var toolName in tools) {\n\t      var btn = document.createElement('button');\n\t      btn.innerHTML = tools[toolName].options.label;\n\t\n\t      btn.classList.add(_canvasConst2.default.CSS.BUTTON);\n\t\n\t      addClasses(btn, mainOptions.buttonClass);\n\t      addClasses(btn, tools[toolName].options.buttonClass);\n\t\n\t      btn.onclick = notifyActive(tools[toolName].address);\n\t      this.toolsInUse[tools[toolName].address] = btn;\n\t      container.appendChild(btn);\n\t    }\n\t\n\t    var btnActiveCss = mainOptions.buttonActiveClass || _canvasConst2.default.CSS.ACTIVE_BUTTON;\n\t    var btnDisabledCss = mainOptions.buttonDisabledClass || _canvasConst2.default.CSS.DISABLED_BUTTON;\n\t\n\t    eventAggregator.subscribeTo('TOOL_USAGE', 'toolbar', function (subscriptionId, sender, status) {\n\t      var currTool = this.toolsInUse[sender];\n\t\n\t      if (status !== 'active') {\n\t        if (sender === activeTool) {\n\t          activeTool = undefined;\n\t        }\n\t\n\t        currTool.classList.remove(btnActiveCss);\n\t      } else {\n\t        currTool.classList.add(btnActiveCss);\n\t      }\n\t    }, this);\n\t\n\t    eventAggregator.subscribeTo('tool-enabled', 'toolbar', function (subscriptionId, sender, isEnabled) {\n\t      if (isEnabled) {\n\t        this.toolsInUse[sender].classList.remove(btnDisabledCss);\n\t      } else {\n\t        this.toolsInUse[sender].classList.add(btnDisabledCss);\n\t      }\n\t    }, this);\n\t  };\n\t};\n\t\n\texports.default = ControlsDispatcher;\n\n/***/ }\n/******/ ])\n});\n;\n//# sourceMappingURL=redraw.js.map"],"sourceRoot":"/source/"}