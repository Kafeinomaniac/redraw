{"version":3,"sources":["redraw.min.js"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","dataURItoBlob","encodedData","decodedData","atob","split","array","i","length","push","charCodeAt","Blob","Uint8Array","type","getToolsFromUserSettings","allTools","options","tools","definedTools","t","toolName","overwriteProps","allProps","precedenceProps","globalOptions","results","hasOwnProperty","globalOverrides","indexOf","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","_browserApi","_browserApi2","_canvasWrapper","_canvasWrapper2","_eventAggregator","_eventAggregator2","_controlsDispatcher","_controlsDispatcher2","redrawNs","Redraw","imgElement","events","_canvas","jsonContent","loadFromJSON","controls","initializeTools","value","canvas","deactivateAllWithDispatch","toDataURL","format","multiplier","scale","getDataUrlForExport","includeImage","cancelActiveTool","jsObj","toObject","backgroundImage","JSON","stringify","jsonRepresentation","getAllObjects","topic","callbackFn","subscriberId","scope","subscribeTo","unsubscribeTo","toolSettings","toolsInUse","passedProps","toolFn","setupTools","canvasContainer","Annotation","registerTool","_name","_toolFn","_options","address","buttonCss","appendToWindow","isBrowser","window","Browser","document","attributeName","getFromWindow","_canvasConst","_canvasConst2","Canvas","eventAggregator","parent","parentNode","redrawWrapper","createElement","className","CSS","PARENT","insertBefore","removeChild","canvasElem","canvasWrapper","CANVAS_WRAPPER","appendChild","canvasLeft","offsetLeft","fabric","theCanvas","delayedSetup","setupImage","tmp","Image","addEventListener","src","getBinder","renderAll","event","notify","image","maxWidth","width","maxHeight","height","scaleY","setDimensions","setScaleX","setScaleY","setBackgroundImage","_scaleY","subscriptionId","sender","status","defaultCursor","clear","bind","offsetTop","getObjects","isEnabled","selection","forEachObject","o","selectable","TOOL","ARROW","BOX","PIXELATE","CLEAR","DUMP","HLINE","REMOVE","TEXT","DEFAULT_COLOR","TOOLBAR","BUTTON","ACTIVE_BUTTON","EventAggregator","subscriptionsByTopic","onNotifyFn","_invokationScope","subscriber","invokationScope","_subscriber","j","splice","payload","s2","undefined","apply","addClasses","btnObj","classes","allClasses","forEach","clazz","classList","add","ControlsDispatcher","notifyActive","activeTool","manageKeys","e","keyCode","domParent","mainOptions","container","toolbarCss","toolbarFirst","firstChild","btn","innerHTML","label","onclick","btnActiveCss","buttonActiveCss","currTool","remove","line","ArrowTool","toolOptions","arrow","start","end","callee","initListeners","arguments","moveFn","onMove","downFn","onMouseDown","upFn","onMUP","message","done","enableSelection","removeCanvasListeners","points","x1","y1","x2","y2","dx","dy","angle","Math","atan2","PI","Triangle","fill","activeColor","top","left","size","originX","originY","pointer","getPointer","set","x","y","moveArrowIndicator","perimeter","abs","color","group","Group","hasControls","hasBorders","stroke","Line","strokeWidth","lineWidth","abort","me","on","off","rect","BoxTool","detachBoxListener","mouseDown","drawBox","drawBoxDone","currWidth","startLeft","currHeight","startTop","setCoords","opacity","Rect","borderColor","hasRotatingPoint","attachBoxListener","callbackCtx","PixelateTool","applyFilter","index","filter","filters","applyFilters","object","getContext","getImageData","util","clone","lockMovementX","lockMovementY","clipTo","ctx","render","f","Pixelate","blocksize","sendToBack","ResetTool","initClear","confirm","clearAllElements","all","HorizontalLineTool","createHorizontalLine","padding","_HorizontalLineTool","addr","action","horizontalLine","detachHorizontalLineListener","onMouseMove","onMouseUp","RemoveTool","getActiveObject","TextTool","editor","textTool","detachTextListener","IText","fontFamily","fontSize","_arrow","_arrow2","defaultToolProps","_box","_box2","_pixelate","_pixelate2","_clearTool","_clearTool2","toolProps","_horizontalLineTool","_horizontalLineTool2","_removeTool","_removeTool2","_text","_text2"],"mappings":"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","file":"redraw.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"rechart\"] = factory();\n\telse\n\t\troot[\"rechart\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(1);\n\t__webpack_require__(7);\n\t__webpack_require__(8);\n\t__webpack_require__(9);\n\t__webpack_require__(10);\n\t__webpack_require__(11);\n\t__webpack_require__(12);\n\t__webpack_require__(13);\n\t__webpack_require__(14);\n\t__webpack_require__(15);\n\t__webpack_require__(16);\n\t__webpack_require__(17);\n\t__webpack_require__(18);\n\t__webpack_require__(19);\n\tmodule.exports = __webpack_require__(20);\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _canvasWrapper = __webpack_require__(3);\n\t\n\tvar _canvasWrapper2 = _interopRequireDefault(_canvasWrapper);\n\t\n\tvar _eventAggregator = __webpack_require__(5);\n\t\n\tvar _eventAggregator2 = _interopRequireDefault(_eventAggregator);\n\t\n\tvar _controlsDispatcher = __webpack_require__(6);\n\t\n\tvar _controlsDispatcher2 = _interopRequireDefault(_controlsDispatcher);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * Namespace-root, that will be set to window-Object.\n\t * @access private\n\t */\n\tvar redrawNs = {\n\t    tools: {}\n\t};\n\t\n\t/**\n\t * Makes a blob from eg base64-string.\n\t * @access private\n\t * @param data {string} encodedData - to encode\n\t * @returns {Blob} results\n\t */\n\tfunction dataURItoBlob(encodedData) {\n\t    var decodedData = atob(encodedData.split(',')[1]);\n\t    var array = []; // 8-bit unsigned array\n\t    for (var i = 0; i < decodedData.length; i++) {\n\t        array.push(decodedData.charCodeAt(i));\n\t    }\n\t    return new Blob([new Uint8Array(array)], {\n\t        type: 'image/png'\n\t    });\n\t}\n\t\n\t/**\n\t * If the user has defined the options.tools, then use this to\n\t * extract the sepcified subset from allTools.\n\t * @access private\n\t * @param {Object[]} allTools - should be tools to pick from.\n\t * @param {Object} options - with or without property tools.\n\t * @returns {Object} containing all or the selected tools.\n\t */\n\tfunction getToolsFromUserSettings(allTools, options) {\n\t\n\t    if (options && options.tools) {\n\t        var definedTools = {};\n\t        for (var t in options.tools) {\n\t            var toolName = options.tools[t];\n\t            definedTools[toolName] = allTools[toolName];\n\t        }\n\t        return definedTools;\n\t    } else {\n\t        return allTools;\n\t    }\n\t}\n\t\n\t/**\n\t * Defines the options-properties allowed to infect all tools-settings.\n\t * @access private\n\t */\n\tvar globalOverrides = ['color', 'activeColor'];\n\t\n\t/**\n\t * Figures out which options should be applied for a particular toolName.\n\t * @access private\n\t * @param {Object} allProps - already defined options, that shold not be lost, but perhaps\n\t * replaced if defined in precedenceProps or globalOptions.\n\t * @param {Object} precedenceProps - that may have a property named toolName, that will\n\t * replace options from allProps.\n\t * @param {Object} globalOptions - top-level options that will overwrite allProp but not precedenceProps\n\t * @param {string} toolName - name of the tool, which options is processed\n\t * @returns {Object} with tool applies options\n\t */\n\tfunction overwriteProps(allProps, precedenceProps, globalOptions, toolName) {\n\t    var results = {};\n\t\n\t    for (var p in allProps[toolName].options) {\n\t        if (allProps[toolName].options.hasOwnProperty(p)) {\n\t            if (precedenceProps[toolName] && precedenceProps[toolName] && precedenceProps[toolName].hasOwnProperty(p)) {\n\t                results[p] = precedenceProps[toolName][p];\n\t            } else if (globalOverrides.indexOf(p) > -1 && globalOptions.hasOwnProperty(p)) {\n\t                results[p] = globalOptions[p];\n\t            } else {\n\t                results[p] = allProps[toolName].options[p];\n\t            }\n\t        }\n\t    }\n\t    return results;\n\t}\n\t\n\t/**\n\t * Main module, and the only public api for usage.\n\t * @module redraw\n\t */\n\t\n\tvar Redraw = function () {\n\t    /**\n\t     * Redraw constructor. Bootstraps the canvas and tools.\n\t     * @constructor\n\t     * @param {Object} imgElement - The dom element that holds the image.\n\t     * @param {Object} options - Options.\n\t     */\n\t\n\t    function Redraw(imgElement, options) {\n\t        _classCallCheck(this, Redraw);\n\t\n\t        this.events = new _eventAggregator2.default();\n\t        options = options || {};\n\t        this._canvas = new _canvasWrapper2.default(imgElement, this.events, options); // Needs defactor\n\t\n\t        if (options.jsonContent) {\n\t            this._canvas.loadFromJSON(options.jsonContent);\n\t        }\n\t\n\t        this.controls = this.initializeTools(this.events, options);\n\t    }\n\t    /**\n\t     * Get the png-representation of the canvas.\n\t     * @access public\n\t     * @returns {string} with base64 encoded png.\n\t     */\n\t\n\t\n\t    _createClass(Redraw, [{\n\t        key: 'getDataUrlForExport',\n\t        value: function getDataUrlForExport() {\n\t            this._canvas.canvas.deactivateAllWithDispatch();\n\t            return this._canvas.canvas.toDataURL({\n\t                format: 'png',\n\t                multiplier: 1 / this._canvas.scale\n\t            });\n\t        }\n\t\n\t        /**\n\t         * Get the base64-encoded png-representation of the canvas.\n\t         * @access public\n\t         * @returns {string} with base64 encoded png.\n\t         */\n\t\n\t    }, {\n\t        key: 'toBase64URL',\n\t        value: function toBase64URL() {\n\t            return this.getDataUrlForExport();\n\t        }\n\t\n\t        /**\n\t         * Get the binary png-representation of the canvas.\n\t         * @access public\n\t         * @returns {Blob} with canvas as png.\n\t         */\n\t\n\t    }, {\n\t        key: 'toDataBlob',\n\t        value: function toDataBlob() {\n\t            return dataURItoBlob(this.getDataUrlForExport());\n\t        }\n\t\n\t        /**\n\t         * Get the json-representation of the canvas.\n\t         * @access public\n\t         * @param {boolean} includeImage - true if background-image should be included in the json.\n\t         * @returns {string} with json.\n\t         */\n\t\n\t    }, {\n\t        key: 'toJson',\n\t        value: function toJson(includeImage) {\n\t            this.controls.cancelActiveTool();\n\t            var jsObj = this._canvas.canvas.toObject(['lockMovementX', 'lockMovementY', 'lockRotation', 'lockScalingX', 'lockScalingY', 'lockUniScaling', 'hasControls', 'hasRotatingPoint', 'selectable', 'fill', 'padding']);\n\t\n\t            if (!includeImage) {\n\t                delete jsObj.backgroundImage;\n\t            }\n\t            return JSON.stringify(jsObj);\n\t        }\n\t\n\t        /**\n\t         * Resets image and loads content from provided json.\n\t         * @access public\n\t         * @param {string} jsonRepresentation - to provide as current state of the canvas.\n\t         */\n\t\n\t    }, {\n\t        key: 'fromJson',\n\t        value: function fromJson(jsonRepresentation) {\n\t            this._canvas.loadFromJSON(jsonRepresentation);\n\t        }\n\t\n\t        /**\n\t         * Tells whether or not any objects are present in the canvas, i.e. arrows, boxes other than the image itself.\n\t         * @access public\n\t         * @returns {boolean} true if there are obejcts, i.e.\n\t         */\n\t\n\t    }, {\n\t        key: 'isEmpty',\n\t        value: function isEmpty() {\n\t            return this._canvas.getAllObjects().length === 0;\n\t        }\n\t    }, {\n\t        key: 'isDirty',\n\t        value: function isDirty() {\n\t            return true;\n\t        }\n\t\n\t        /**\n\t         * Returns the canvas representation, as is from Fabric.js\n\t         * @access public\n\t         * @returns {Object} canvas, see http://fabricjs.com/.\n\t         */\n\t\n\t    }, {\n\t        key: 'getCanvas',\n\t        value: function getCanvas() {\n\t            return this._canvas.canvas;\n\t        }\n\t    }, {\n\t        key: 'on',\n\t        value: function on(topic, callbackFn, subscriberId, scope) {\n\t            this.events.subscribeTo(topic, 'cx-' + subscriberId, callbackFn, scope);\n\t        }\n\t    }, {\n\t        key: 'off',\n\t        value: function off(topic, subscriberId) {\n\t            this.events.unsubscribeTo(topic, 'cx-' + subscriberId);\n\t        }\n\t\n\t        /**\n\t         * Initializes all selected tools.\n\t         * @param {EventAggregator} events - used for all mediated communications.\n\t         * @param {Object} options - settings for all tools.\n\t         */\n\t\n\t    }, {\n\t        key: 'initializeTools',\n\t        value: function initializeTools(events, options) {\n\t            var localToolSettings = {};\n\t            options.toolSettings = options.toolSettings || {};\n\t            var toolsInUse = getToolsFromUserSettings(redrawNs.tools, options);\n\t\n\t            for (var toolName in toolsInUse) {\n\t                var passedProps = overwriteProps(redrawNs.tools, options.toolSettings, options, toolName);\n\t\n\t                redrawNs.tools[toolName].options = passedProps;\n\t\n\t                new redrawNs.tools[toolName].toolFn(this._canvas, events, passedProps);\n\t            }\n\t            var controls = new _controlsDispatcher2.default(events, options);\n\t            controls.setupTools(toolsInUse, this._canvas.canvasContainer, options);\n\t            return controls;\n\t        }\n\t    }]);\n\t\n\t    return Redraw;\n\t}();\n\t\n\tredrawNs.Annotation = Redraw;\n\t/**\n\t * Used by tools to register themselves to be available for usage.\n\t * @access public\n\t * @param {string} _name - name of tool.\n\t * @param {function(canvas: CanvasWrapper, events: EventAggregator, passedProps: Object)} _toolFn - callback function, invoked upon initialization of the tools.\n\t * @param {Object} _options - options, to be used as default ones.\n\t */\n\tredrawNs.registerTool = function (_name, _toolFn, _options) {\n\t    redrawNs.tools[_name] = {\n\t        address: _name,\n\t        toolFn: _toolFn,\n\t        options: _options\n\t    };\n\t    // buttonCss is an attribute that applies to all tools\n\t    redrawNs.tools[_name].options.buttonCss = redrawNs.tools[_name].options.buttonCss || '';\n\t};\n\t\n\tnew _browserApi2.default().appendToWindow('redraw', redrawNs);\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar isBrowser = typeof window !== 'undefined';\n\t\n\t/**\n\t * Facade of the browser apis. The main purpose id to facilitate testing.\n\t */\n\t\n\tvar Browser = function () {\n\t    /**\n\t     * Contructor that determines if there is a browser present.\n\t     * @constructor\n\t     */\n\t\n\t    function Browser() {\n\t        _classCallCheck(this, Browser);\n\t\n\t        this.document = isBrowser ? document : {};\n\t        this.window = isBrowser ? window : {};\n\t    }\n\t\n\t    /**\n\t     * Appends property to the browser window object.\n\t     * @param {string} attributeName - Name of the property to create/assign.\n\t     * @param {Object} obj - value to set.\n\t     */\n\t\n\t\n\t    _createClass(Browser, [{\n\t        key: 'appendToWindow',\n\t        value: function appendToWindow(attributeName, obj) {\n\t\n\t            if (isBrowser) {\n\t                window[attributeName] = obj;\n\t                return true;\n\t            }\n\t            return false;\n\t        }\n\t\n\t        /**\n\t         * Use to retrieve property from the browser window object.\n\t         * @param {string} attributeName - Name of the property to create/assign.\n\t         * @returns {Object} obj - retrieved value, or mock if not browser.\n\t         */\n\t\n\t    }, {\n\t        key: 'getFromWindow',\n\t        value: function getFromWindow(attributeName) {\n\t            if (window) {\n\t                return window[attributeName];\n\t            }\n\t            return {\n\t                getFromWindow: function getFromWindow() {},\n\t                tools: [] };\n\t        }\n\t    }]);\n\t\n\t    return Browser;\n\t}();\n\n\texports.default = Browser;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t* Gets the scroll position of a dom element.\n\t* @access private\n\t* @param {Object} elem - target element.\n\t*/\n\tfunction scrollPosition(elem) {\n\t    var left = 0,\n\t        top = 0;\n\t\n\t    do {\n\t        left += elem.scrollLeft;\n\t        top += elem.scrollTop;\n\t    } while (elem = elem.offsetParent);\n\t\n\t    return [left, top];\n\t}\n\t\n\t/**\n\t * Canvas object that facilitates\n\t */\n\t\n\tvar Canvas = function () {\n\t    /**\n\t    * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t    * @constructor\n\t    * @param {Object} imgElement - dom element that will be replaced and\n\t    * used as background for canvas.\n\t    * @param {EventAggregator} eventAggregator - Event mediator.\n\t    * @param {Object} options - parameters used to setup looks and all tools preferences.\n\t    */\n\t\n\t    function Canvas(imgElement, eventAggregator, options) {\n\t        _classCallCheck(this, Canvas);\n\t\n\t        this.options = options;\n\t        this.eventAggregator = eventAggregator;\n\t        var parent = imgElement.parentNode;\n\t        var redrawWrapper = document.createElement('div');\n\t        redrawWrapper.className = _canvasConst2.default.CSS.PARENT;\n\t        this.scale = 1;\n\t        parent.insertBefore(redrawWrapper, imgElement);\n\t        parent.removeChild(imgElement);\n\t\n\t        var canvasElem = document.createElement('canvas');\n\t        var canvasWrapper = document.createElement('div');\n\t        canvasWrapper.className = _canvasConst2.default.CSS.CANVAS_WRAPPER;\n\t        canvasWrapper.appendChild(canvasElem);\n\t        redrawWrapper.appendChild(canvasWrapper);\n\t\n\t        this.canvasElem = canvasElem;\n\t\n\t        this.canvasContainer = redrawWrapper;\n\t        this.canvasLeft = canvasElem.offsetLeft;\n\t        this.canvas = new fabric.Canvas(canvasElem);\n\t        this.imgElement = imgElement;\n\t\n\t        /* wait until the image is surely loaded to make the setup */\n\t        var theCanvas = this;\n\t        var delayedSetup = function delayedSetup() {\n\t            theCanvas.setupImage();\n\t        };\n\t        var tmp = new Image();\n\t        tmp.addEventListener('load', delayedSetup, false);\n\t        tmp.src = this.imgElement.src;\n\t    }\n\t\n\t    _createClass(Canvas, [{\n\t        key: 'setupImage',\n\t        value: function setupImage() {\n\t            this.image = new fabric.Image(this.imgElement);\n\t            if (this.options.maxWidth && this.options.maxWidth < this.image.width) {\n\t                this.scale = this.options.maxWidth / this.image.width;\n\t            }\n\t            if (this.options.maxHeight && this.options.maxHeight < this.image.height) {\n\t                var scaleY = this.options.maxHeight / this.image.height;\n\t                if (this.scale > scaleY) {\n\t                    this.scale = scaleY;\n\t                }\n\t            }\n\t\n\t            this.width = this.scale * this.imgElement.width;\n\t            this.height = this.scale * this.imgElement.height;\n\t\n\t            this.canvas.setDimensions({\n\t                width: this.width,\n\t                height: this.height\n\t            });\n\t\n\t            this.image.setScaleX(this.scale);\n\t            this.image.setScaleY(this.scale);\n\t            var event = this.eventAggregator;\n\t            function getBinder(_canvas) {\n\t                return function () {\n\t                    _canvas.renderAll();\n\t                    event.notify('canvas-loaded', 'CANVAS');\n\t                };\n\t            }\n\t            this.canvas.setBackgroundImage(this.image, getBinder(this.canvas), {});\n\t\n\t            if (this.options.maxWidth && this.options.maxWidth < this.image.width) {\n\t                this.scale = this.options.maxWidth / this.image.width;\n\t            }\n\t            if (this.options.maxHeight && this.options.maxHeight < this.image.height) {\n\t                var _scaleY = this.options.maxHeight / this.image.height;\n\t                if (this.scale > _scaleY) {\n\t                    this.scale = _scaleY;\n\t                }\n\t            }\n\t\n\t            this.eventAggregator.subscribeTo('TOOL_USAGE', 'toolbar', function (subscriptionId, sender, status) {\n\t                if (status === 'active') {\n\t                    this.canvas.defaultCursor = 'crosshair';\n\t                } else {\n\t                    this.canvas.defaultCursor = 'default';\n\t                }\n\t            }, this);\n\t        }\n\t    }, {\n\t        key: 'loadFromJSON',\n\t        value: function loadFromJSON(jsonContent) {\n\t            this.canvas.clear();\n\t            this.canvas.loadFromJSON(jsonContent, this.canvas.renderAll.bind(this.canvas));\n\t        }\n\t\n\t        /**\n\t         * Gets the top position of the canvas dom element.\n\t         * @access public\n\t         * @returns {number} position in pixels?\n\t         */\n\t\n\t    }, {\n\t        key: 'getCanvasTop',\n\t        value: function getCanvasTop() {\n\t            return this.canvasContainer.offsetTop;\n\t        }\n\t\n\t        /**\n\t         * Gets the array of all objects of the canvas.\n\t         * @access public\n\t         * @returns {Array} with canvas object, or undefined if empty.\n\t         */\n\t\n\t    }, {\n\t        key: 'getAllObjects',\n\t        value: function getAllObjects() {\n\t            return this.canvas.getObjects();\n\t        }\n\t\n\t        /**\n\t         * Set/unset whether or not it is possible to select objects of the canvas.\n\t         * @access pulic\n\t         * @param {boolean} isEnabled - true if selection is enabled, false otherwise.\n\t         */\n\t\n\t    }, {\n\t        key: 'enableSelection',\n\t        value: function enableSelection(isEnabled) {\n\t            this.canvas.selection = isEnabled; // Restore fabricjs selection-box\n\t            this.canvas.forEachObject(function (o) {\n\t                o.selectable = isEnabled;\n\t            });\n\t        }\n\t    }]);\n\t\n\t    return Canvas;\n\t}();\n\n\texports.default = Canvas;\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.default = {\n\t\tTOOL: {\n\t\t\tARROW: 'arrow',\n\t\t\tBOX: 'box',\n\t\t\tPIXELATE: 'pixel',\n\t\t\tCLEAR: 'clear',\n\t\t\tDUMP: 'dump',\n\t\t\tHLINE: 'hline',\n\t\t\tREMOVE: 'delete',\n\t\t\tTEXT: 'text'\n\t\t},\n\t\tDEFAULT_COLOR: '#33e',\n\t\tCSS: {\n\t\t\tPARENT: 'redraw_parent',\n\t\t\tCANVAS_WRAPPER: 'redraw_canvas',\n\t\t\tTOOLBAR: 'redraw_toolbar',\n\t\t\tBUTTON: 'redraw_btn',\n\t\t\tACTIVE_BUTTON: 'active'\n\t\t}\n\t};\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t* Mediator for events.\n\t*/\n\t\n\tvar EventAggregator = function () {\n\t    /**\n\t     * Contructor that initializes internal stuff.\n\t     * @constructor\n\t     */\n\t\n\t    function EventAggregator() {\n\t        _classCallCheck(this, EventAggregator);\n\t\n\t        this.subscriptionsByTopic = {};\n\t    }\n\t\n\t    /**\n\t     * Registers a subscriber for a specific event topic.\n\t     * @param {string} topic - name of the event type / topic.\n\t     * @param {string} subscriberId - id the subscriber, must be unique.\n\t     * @param {function(topic: string, sender: string, payload: Object)} onNotifyFn - callback\n\t     * invoked upon when upon notification.\n\t     * @param {Object} [_invokationScope] - scope to be used when invoking callback.\n\t     */\n\t\n\t\n\t    _createClass(EventAggregator, [{\n\t        key: \"subscribeTo\",\n\t        value: function subscribeTo(topic, subscriberId, onNotifyFn, _invokationScope) {\n\t            if (!this.subscriptionsByTopic[topic]) {\n\t                this.subscriptionsByTopic[topic] = [];\n\t            }\n\t\n\t            this.subscriptionsByTopic[topic].push({ subscriber: subscriberId, callbackFn: onNotifyFn, invokationScope: _invokationScope });\n\t        }\n\t\n\t        // ToDo needs test\n\t        /**\n\t         * Unregisters a subscriber from a specific event topic.\n\t         * @param {string} topic - name of the event type / topic.\n\t         * @param {string} _subscriber - id the unique subscriber.\n\t         */\n\t\n\t    }, {\n\t        key: \"unsubscribeTo\",\n\t        value: function unsubscribeTo(topic, _subscriber) {\n\t            for (var j in this.subscriptionsByTopic[topic]) {\n\t                if (this.subscriptionsByTopic[topic][j].subscriber === _subscriber) {\n\t                    this.subscriptionsByTopic[topic].splice(j, 1);\n\t                }\n\t            }\n\t        }\n\t\n\t        /**\n\t         * Called to notify all subscribers of this topic\n\t         * @param {string} topic - name of the event type / topic.\n\t         * @param {string} sender - address of the sender.\n\t         * @param {Object} payload - any data to pass to the subscriber.\n\t         */\n\t\n\t    }, {\n\t        key: \"notify\",\n\t        value: function notify(topic, sender, payload) {\n\t            for (var s2 in this.subscriptionsByTopic[topic]) {\n\t                var scope = undefined;\n\t                if (this.subscriptionsByTopic[topic][s2].invokationScope) {\n\t                    scope = this.subscriptionsByTopic[topic][s2].invokationScope;\n\t                }\n\t                this.subscriptionsByTopic[topic][s2].callbackFn.apply(scope, [topic, sender, payload]);\n\t            }\n\t        }\n\t    }]);\n\t\n\t    return EventAggregator;\n\t}();\n\n\texports.default = EventAggregator;\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * Css class for all buttons of the toolbar.\n\t */\n\tvar BUTTON_CLASS = 'redraw_btn';\n\t\n\t/**\n\t * Adds a class to the array of classes.\n\t * @private\n\t */\n\tfunction addClasses(btnObj, classes) {\n\t    if (!classes) return;\n\t    var allClasses = classes.split(' ');\n\t\n\t    allClasses.forEach(function (clazz) {\n\t        btnObj.classList.add(clazz);\n\t    });\n\t}\n\t\n\t/**\n\t * Main manager for the toolbar.\n\t */\n\t\n\tvar ControlsDispatcher =\n\t/**\n\t * Controls contructor. Is provided with canvas-wrapper and options to initialize to toolbar.\n\t * @constructor\n\t * @param {EventAggregator} eventAggregator - Event mediator.\n\t * @param {Object} options - from user.\n\t */\n\tfunction ControlsDispatcher(eventAggregator, options) {\n\t    _classCallCheck(this, ControlsDispatcher);\n\t\n\t    this.toolsInUse = {};\n\t    var activeTool, delBtn;\n\t\n\t    function notifyActive(topic) {\n\t        return function () {\n\t            if (activeTool) {\n\t                eventAggregator.notify(activeTool, 'toolbar', 'toolbar-deactivate');\n\t            }\n\t            if (activeTool !== topic) {\n\t                activeTool = topic;\n\t                eventAggregator.notify(topic, 'toolbar', 'toolbar-click');\n\t            } else {\n\t                activeTool = undefined;\n\t            }\n\t        };\n\t    }\n\t\n\t    this.cancelActiveTool = function () {\n\t\n\t        if (activeTool) {\n\t            eventAggregator.notify(activeTool, 'toolbar', 'toolbar-deactivate');\n\t            activeTool = undefined;\n\t        }\n\t    };\n\t\n\t    var manageKeys = function manageKeys(e) {\n\t        if (e.keyCode === 46 || e.keyCode === 27) {\n\t            eventAggregator.notify('keydown', 'toolbar', e.keyCode);\n\t        }\n\t    };\n\t\n\t    window.addEventListener('keydown', manageKeys, false);\n\t\n\t    this.setupTools = function (tools, domParent, mainOptions) {\n\t        var container = document.createElement('div');\n\t\n\t        addClasses(container, _canvasConst2.default.CSS.TOOLBAR);\n\t        addClasses(container, options.toolbarCss);\n\t\n\t        if (mainOptions.toolbarFirst === true) {\n\t            domParent.insertBefore(container, domParent.firstChild);\n\t        } else {\n\t            domParent.appendChild(container);\n\t        }\n\t\n\t        for (var toolName in tools) {\n\t            var btn = document.createElement('button');\n\t            btn.innerHTML = tools[toolName].options.label;\n\t\n\t            btn.classList.add(_canvasConst2.default.CSS.BUTTON);\n\t\n\t            addClasses(btn, mainOptions.buttonCss);\n\t            addClasses(btn, tools[toolName].options.buttonCss);\n\t\n\t            btn.onclick = notifyActive(tools[toolName].address);\n\t            this.toolsInUse[tools[toolName].address] = btn;\n\t            container.appendChild(btn);\n\t        }\n\t\n\t        var btnActiveCss = mainOptions.buttonActiveCss || _canvasConst2.default.CSS.ACTIVE_BUTTON;\n\t\n\t        eventAggregator.subscribeTo('TOOL_USAGE', 'toolbar', function (subscriptionId, sender, status) {\n\t            var currTool = this.toolsInUse[sender];\n\t\n\t            if (status !== 'active') {\n\t                if (sender === activeTool) {\n\t                    activeTool = undefined;\n\t                }\n\t                currTool.classList.remove(btnActiveCss);\n\t            } else {\n\t                currTool.classList.add(btnActiveCss);\n\t            }\n\t        }, this);\n\t\n\t        eventAggregator.subscribeTo('tool-enabled', 'toolbar', function (subscriptionId, sender, isEnabled) {\n\t            if (isEnabled) {\n\t                this.toolsInUse[sender].classList.remove('disabled');\n\t            } else {\n\t                this.toolsInUse[sender].classList.add('disabled');\n\t            }\n\t        }, this);\n\t    };\n\t};\n\t\n\texports.default = ControlsDispatcher;\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/** length of arrow head */\n\tvar indicationLength = 8;\n\t/** line used during drag n drop */\n\tvar line;\n\t\n\t/**\n\t * A tool to paint arrows.\n\t */\n\t\n\tvar ArrowTool = function () {\n\t    /**\n\t     * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t     * @constructor\n\t     * @param {Canvas} canvasWrapper - Canvas.\n\t     * @param {EventAggregator} eventAggregator - Event mediator.\n\t     */\n\t\n\t    function ArrowTool(canvasWrapper, eventAggregator, toolOptions, fabric) {\n\t        _classCallCheck(this, ArrowTool);\n\t\n\t        /** eventAggregator for madiated cummunications */\n\t        this.eventAggregator = eventAggregator;\n\t        /** main api to use for canvas manipulation */\n\t        this.canvasWrapper = canvasWrapper;\n\t        /** coords for the elements of the arrow */\n\t        this.arrow = this.canvas = this.start = this.end = undefined;\n\t        /** options */\n\t        this.options = toolOptions;\n\t\n\t        var callee = this;\n\t\n\t        this.eventAggregator.subscribeTo(_canvasConst2.default.TOOL.ARROW, 'ArrowTool', function () {\n\t            callee.initListeners.apply(callee, arguments);\n\t        });\n\t        /** shorthand to canvas */\n\t        this.canvas = canvasWrapper.canvas;\n\t\n\t        this.moveFn = function (options) {\n\t            callee.onMove(options);\n\t        };\n\t        this.downFn = function (options) {\n\t            callee.onMouseDown(options);\n\t        };\n\t        this.upFn = function (options) {\n\t            callee.onMUP(options);\n\t        };\n\t        this.notify = function (message) {\n\t            this.eventAggregator.notify('TOOL_USAGE', _canvasConst2.default.TOOL.ARROW, message);\n\t        };\n\t\n\t        this.done = function () {\n\t            this.canvasWrapper.enableSelection(true);\n\t            this.removeCanvasListeners();\n\t            this.notify('inactive');\n\t        };\n\t    }\n\t\n\t    /**\n\t     * Move the head of the arrow.\n\t     * Cred for http://stackoverflow.com/questions/29890294/arrow-shape-using-fabricjs\n\t     * @private\n\t     * @param {Object} points - 4d.\n\t     */\n\t\n\t\n\t    _createClass(ArrowTool, [{\n\t        key: 'moveArrowIndicator',\n\t        value: function moveArrowIndicator(points) {\n\t            var x1 = points[0],\n\t                y1 = points[1],\n\t                x2 = points[2],\n\t                y2 = points[3],\n\t                dx = x2 - x1,\n\t                dy = y2 - y1,\n\t                angle = Math.atan2(dy, dx);\n\t\n\t            angle *= 180 / Math.PI;\n\t            angle += 90;\n\t            if (this.arrow) {\n\t                this.canvas.remove(this.arrow);\n\t            }\n\t            this.arrow = new fabric.Triangle({\n\t                angle: angle,\n\t                fill: this.options.activeColor,\n\t                top: y2,\n\t                left: x2,\n\t                height: this.options.size,\n\t                width: this.options.size,\n\t                originX: 'center',\n\t                originY: 'center',\n\t                selectable: false\n\t            });\n\t\n\t            this.canvas.add(this.arrow);\n\t        }\n\t\n\t        /**\n\t         * Cancels this paint operation, i.e. removes any ongoing paint-objects och de-registers listeners.\n\t         * @private\n\t         */\n\t\n\t    }, {\n\t        key: 'abort',\n\t        value: function abort() {\n\t            if (this.arrow) {\n\t                this.canvas.remove(this.arrow);\n\t                this.arrow = undefined;\n\t            }\n\t            if (line) {\n\t                this.canvas.remove(line);\n\t                line = undefined;\n\t            }\n\t            this.eventAggregator.unsubscribeTo('keydown', 'ArrowTool');\n\t            this.done();\n\t        }\n\t\n\t        /**\n\t         * Function callback, invoked when mouse moves, even before mouse has been pressed.\n\t         * @private\n\t         * @param {Object} options - for the event.\n\t         */\n\t\n\t    }, {\n\t        key: 'onMove',\n\t        value: function onMove(options) {\n\t\n\t            if (this.start && !this.end) {\n\t                var pointer = this.canvas.getPointer(options.e);\n\t\n\t                line.set({\n\t                    'x2': pointer.x\n\t                });\n\t                line.set({\n\t                    'y2': pointer.y\n\t                });\n\t\n\t                this.moveArrowIndicator([this.start.left, this.start.top, pointer.x, pointer.y]);\n\t            }\n\t\n\t            this.canvas.renderAll();\n\t        }\n\t\n\t        /**\n\t         * Function callback, invoked on mouse up.\n\t         * @private\n\t         * @param {Object} options - for the event.\n\t         */\n\t\n\t    }, {\n\t        key: 'onMUP',\n\t        value: function onMUP(options) {\n\t            var pointer = this.canvas.getPointer(options.e);\n\t            this.end = {\n\t                top: pointer.y,\n\t                left: pointer.x\n\t            };\n\t\n\t            var perimeter = Math.abs(this.end.top - this.start.top) + Math.abs(this.end.left - this.start.left);\n\t\n\t            if (perimeter > 10) {\n\t                if (this.arrow) {\n\t                    this.arrow.fill = this.options.color;\n\t                }\n\t                var group = new fabric.Group([line, this.arrow], {\n\t                    hasControls: false,\n\t                    hasBorders: true,\n\t                    selectable: false,\n\t                    fill: this.options.color\n\t                });\n\t                line.stroke = this.options.color;\n\t\n\t                this.canvas.add(group);\n\t            }\n\t\n\t            this.canvas.remove(line);\n\t            this.canvas.remove(this.arrow);\n\t            this.arrow = line = this.start = this.end = undefined;\n\t            this.canvas.renderAll();\n\t        }\n\t\n\t        /**\n\t         * Function callback, invoked on mouse down.\n\t         * @private\n\t         * @param {Object} options - for the event.\n\t         */\n\t\n\t    }, {\n\t        key: 'onMouseDown',\n\t        value: function onMouseDown(options) {\n\t            var pointer = this.canvas.getPointer(options.e);\n\t            this.start = {\n\t                top: pointer.y,\n\t                left: pointer.x\n\t            };\n\t\n\t            line = new fabric.Line([this.start.left, this.start.top, this.start.left, this.start.top], {\n\t                strokeWidth: this.options.lineWidth,\n\t                stroke: this.options.activeColor,\n\t                originX: 'center',\n\t                originY: 'center',\n\t                hasControls: false,\n\t                hasBorders: true,\n\t                selectable: true\n\t            });\n\t\n\t            this.canvas.add(line);\n\t        }\n\t\n\t        /**\n\t         * Function callback, invoked when toolbar is clicked.\n\t         * @private\n\t         * @param {string} topic - .\n\t         * @param {string} sender - .\n\t         * @param {string} payload - value shold be \"toolbar-deactivate\" if tool is active.\n\t         */\n\t\n\t    }, {\n\t        key: 'initListeners',\n\t        value: function initListeners(topic, sender, payload) {\n\t            if (payload === 'toolbar-deactivate') {\n\t                this.abort();\n\t                return;\n\t            }\n\t            var me = this;\n\t\n\t            this.eventAggregator.subscribeTo('keydown', 'ArrowTool', function (topic, sender, keyCode) {\n\t\n\t                if (keyCode === 27) {\n\t                    me.abort.apply(me);\n\t                }\n\t            });\n\t            this.start = this.end = undefined;\n\t\n\t            this.canvasWrapper.enableSelection(false);\n\t\n\t            this.notify('active');\n\t\n\t            this.canvas.on('mouse:down', this.downFn);\n\t            this.canvas.on('mouse:move', this.moveFn);\n\t            this.canvas.on('mouse:up', this.upFn);\n\t        }\n\t        /**\n\t         * Removes listeners.\n\t         * @private\n\t         */\n\t\n\t    }, {\n\t        key: 'removeCanvasListeners',\n\t        value: function removeCanvasListeners() {\n\t            this.canvas.off('mouse:down', this.downFn);\n\t            this.canvas.off('mouse:move', this.moveFn);\n\t            this.canvas.off('mouse:up', this.upFn);\n\t        }\n\t    }]);\n\t\n\t    return ArrowTool;\n\t}();\n\n\texports.default = ArrowTool;\n\n/***/ },\n/* 8 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/** used during drag n drop */\n\tvar rect;\n\t/**\n\t * A tool to paint boxes.\n\t */\n\t\n\tvar BoxTool =\n\t/**\n\t * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t * @constructor\n\t * @param {Canvas} canvasWrapper - Canvas.\n\t * @param {EventAggregator} eventAggregator - Event mediator.\n\t */\n\tfunction BoxTool(canvasWrapper, eventAggregator, toolOptions) {\n\t    _classCallCheck(this, BoxTool);\n\t\n\t    eventAggregator.subscribeTo(_canvasConst2.default.TOOL.BOX, 'BoxTool', attachBoxListener);\n\t    var callbackCtx = this;\n\t    var canvas = canvasWrapper.canvas;\n\t\n\t    function notify(message) {\n\t        eventAggregator.notify('TOOL_USAGE', _canvasConst2.default.TOOL.BOX, message);\n\t    }\n\t\n\t    function done() {\n\t        notify('inactive');\n\t        detachBoxListener();\n\t        canvasWrapper.enableSelection(true);\n\t    }\n\t\n\t    function detachBoxListener() {\n\t        canvas.off('mouse:down', mouseDown);\n\t        canvas.off('mouse:move', drawBox);\n\t        canvas.off('mouse:up', drawBoxDone);\n\t\n\t        rect = undefined;\n\t        eventAggregator.unsubscribeTo('keydown', 'BoxTool');\n\t    }\n\t\n\t    var currWidth, currHeight;\n\t\n\t    function drawBox(options) {\n\t        if (rect) {\n\t            var pointer = canvas.getPointer(options.e);\n\t\n\t            currWidth = pointer.x - startLeft;\n\t            currHeight = pointer.y - startTop;\n\t\n\t            rect.set({\n\t                'width': currWidth\n\t            });\n\t            rect.set({\n\t                'height': currHeight\n\t            });\n\t            rect.setCoords();\n\t            canvas.renderAll();\n\t        }\n\t    }\n\t    function drawBoxDone(options) {\n\t        canvas.off('mouse:move', drawBox);\n\t        canvas.off('mouse:up', drawBoxDone);\n\t\n\t        if (Math.abs(currWidth) < 5 && Math.abs(currHeight) < 5) {\n\t            canvas.remove(rect);\n\t            return;\n\t        }\n\t\n\t        rect.set({ opacity: 0.5 });\n\t        canvas.renderAll();\n\t    }\n\t\n\t    var currWidth, currHeight, startTop, startLeft;\n\t\n\t    function mouseDown(options) {\n\t        var pointer = canvas.getPointer(options.e);\n\t        currWidth = currHeight = 0;\n\t\n\t        startTop = pointer.y;\n\t        startLeft = pointer.x;\n\t\n\t        rect = new fabric.Rect({\n\t            left: startLeft,\n\t            top: startTop,\n\t            width: 4,\n\t            borderColor: toolOptions.color,\n\t            height: 4,\n\t            fill: toolOptions.color,\n\t            opacity: 0.3,\n\t            hasControls: true,\n\t            hasRotatingPoint: false,\n\t            originX: 'left',\n\t            originY: 'top',\n\t            selectable: false\n\t        });\n\t\n\t        canvas.add(rect);\n\t        rect.setCoords();\n\t        canvas.renderAll();\n\t        canvas.on('mouse:move', drawBox);\n\t        canvas.on('mouse:up', drawBoxDone);\n\t    }\n\t\n\t    function attachBoxListener(topic, sender, payload) {\n\t        if (payload === 'toolbar-deactivate') {\n\t            done();\n\t            return;\n\t        }\n\t        eventAggregator.subscribeTo('keydown', 'BoxTool', function (topic, sender, keyCode) {\n\t            if (keyCode === 27) {\n\t                done();\n\t            }\n\t        }, callbackCtx);\n\t        canvasWrapper.enableSelection(false);\n\t        notify('active');\n\t\n\t        canvas.on('mouse:down', mouseDown);\n\t    }\n\t};\n\t\n\texports.default = BoxTool;\n\n/***/ },\n/* 9 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * A tool to pixelate areas.\n\t */\n\t\n\tvar PixelateTool =\n\t/**\n\t * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t * @constructor\n\t * @param {Canvas} canvasWrapper - Canvas.\n\t * @param {EventAggregator} eventAggregator - Event mediator.\n\t */\n\tfunction PixelateTool(canvasWrapper, eventAggregator, toolOptions) {\n\t    _classCallCheck(this, PixelateTool);\n\t\n\t    eventAggregator.subscribeTo(_canvasConst2.default.TOOL.PIXELATE, 'PixelateTool', attachBoxListener);\n\t    var rect = void 0,\n\t        callbackCtx = this;\n\t    var startTop = void 0,\n\t        startLeft = void 0;\n\t    var canvas = canvasWrapper.canvas;\n\t\n\t    function notify(message) {\n\t        eventAggregator.notify('TOOL_USAGE', _canvasConst2.default.TOOL.PIXELATE, message);\n\t    }\n\t\n\t    function done() {\n\t        notify('inactive');\n\t        detachBoxListener();\n\t        canvasWrapper.enableSelection(true);\n\t    }\n\t\n\t    function detachBoxListener() {\n\t        canvas.off('mouse:down', mouseDown);\n\t        canvas.off('mouse:move', drawBox);\n\t        canvas.off('mouse:up', drawBoxDone);\n\t\n\t        rect = undefined;\n\t        eventAggregator.unsubscribeTo('keydown', 'PixelateTool');\n\t    }\n\t\n\t    function drawBox(options) {\n\t        if (rect) {\n\t            var pointer = canvas.getPointer(options.e);\n\t\n\t            var currWidth = pointer.x - startLeft;\n\t            var currHeight = pointer.y - startTop;\n\t\n\t            rect.set({\n\t                'width': currWidth,\n\t                'height': currHeight\n\t            });\n\t\n\t            rect.setCoords();\n\t            canvas.renderAll();\n\t        }\n\t    }\n\t\n\t    function applyFilter(index, filter, obj) {\n\t        obj.filters[index] = filter;\n\t        obj.applyFilters(canvas.renderAll.bind(canvas));\n\t    }\n\t\n\t    function drawBoxDone(options) {\n\t        canvas.off('mouse:move', drawBox);\n\t        canvas.off('mouse:up', drawBoxDone);\n\t        canvas.remove(rect);\n\t\n\t        var pointer = canvas.getPointer(options.e);\n\t        var currWidth = pointer.x - startLeft;\n\t        var currHeight = pointer.y - startTop;\n\t\n\t        if (Math.abs(currWidth) > 0 && Math.abs(currHeight) > 0) {\n\t            var pixels = canvas.getContext().getImageData(pointer.x, pointer.y, currWidth, currHeight);\n\t\n\t            var object = fabric.util.object.clone(canvasWrapper.image);\n\t\n\t            object.set({\n\t                originX: 'left',\n\t                originY: 'top',\n\t                left: 0,\n\t                top: 0,\n\t                lockMovementX: true,\n\t                lockMovementY: true\n\t            });\n\t            var x = rect;\n\t\n\t            rect.left = rect.left - object.width / 2;\n\t            rect.top = rect.top - object.height / 2;\n\t\n\t            object.clipTo = function (ctx) {\n\t                x.render(ctx);\n\t            };\n\t\n\t            var f = fabric.Image.filters;\n\t            applyFilter(0, new f.Pixelate({\n\t                blocksize: 5\n\t            }), object);\n\t\n\t            canvas.add(object);\n\t            canvas.sendToBack(object);\n\t        }\n\t        canvas.renderAll();\n\t\n\t        rect = undefined;\n\t    }\n\t\n\t    function mouseDown(options) {\n\t        var pointer = canvas.getPointer(options.e);\n\t\n\t        startTop = pointer.y;\n\t        startLeft = pointer.x;\n\t\n\t        rect = new fabric.Rect({\n\t            left: startLeft,\n\t            top: startTop,\n\t            width: 4,\n\t            borderColor: toolOptions.color,\n\t            height: 4,\n\t            fill: toolOptions.color,\n\t            opacity: 0.3,\n\t            hasControls: true,\n\t            hasRotatingPoint: false,\n\t            originX: 'left',\n\t            originY: 'top',\n\t            selectable: false\n\t        });\n\t\n\t        canvas.add(rect);\n\t        rect.setCoords();\n\t        canvas.renderAll();\n\t        canvas.on('mouse:move', drawBox);\n\t        canvas.on('mouse:up', drawBoxDone);\n\t    }\n\t\n\t    function attachBoxListener(topic, sender, payload) {\n\t        if (payload === 'toolbar-deactivate') {\n\t            done();\n\t            return;\n\t        }\n\t        eventAggregator.subscribeTo('keydown', 'PixelateTool', function (topic, sender, keyCode) {\n\t            if (keyCode === 27) {\n\t                done();\n\t            }\n\t        }, callbackCtx);\n\t        canvasWrapper.enableSelection(false);\n\t        notify('active');\n\t\n\t        canvas.on('mouse:down', mouseDown);\n\t    }\n\t};\n\t\n\texports.default = PixelateTool;\n\n/***/ },\n/* 10 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * A tool to reset the canvas, i.e. remove all objects.\n\t */\n\t\n\tvar ResetTool =\n\t/**\n\t * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t * @constructor\n\t * @param {Canvas} canvasWrapper - Canvas.\n\t * @param {EventAggregator} eventAggregator - Event mediator.\n\t */\n\tfunction ResetTool(canvasWrapper, eventAggregator) {\n\t\t_classCallCheck(this, ResetTool);\n\t\n\t\teventAggregator.subscribeTo(_canvasConst2.default.TOOL.CLEAR, 'ResetTool', initClear);\n\t\tfunction initClear(topic, sender, payload) {\n\t\t\tif (payload !== 'toolbar-deactivate' && confirm('This will restore your image to its default state.\\nAll your modifications will be deleted.\\nDo you want to continue?')) {\n\t\t\t\tclearAllElements();\n\t\t\t}\n\t\t\teventAggregator.notify('TOOL_USAGE', _canvasConst2.default.TOOL.CLEAR, 'inactive');\n\t\t}\n\t\n\t\tfunction clearAllElements() {\n\t\t\tvar c = canvasWrapper.canvas;\n\t\t\tvar all = c.getObjects();\n\t\t\tfor (var i = all.length - 1; i >= 0; i--) {\n\t\t\t\tc.remove(all[i]);\n\t\t\t}\n\t\t}\n\t};\n\t\n\texports.default = ResetTool;\n\n/***/ },\n/* 11 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * A tool to create horizontal lines.\n\t */\n\t\n\tvar HorizontalLineTool =\n\t/**\n\t * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t * @constructor\n\t * @param {Canvas} canvasWrapper - Canvas.\n\t * @param {EventAggregator} eventAggregator - Event mediator.\n\t */\n\tfunction HorizontalLineTool(canvasWrapper, eventAggregator, toolOptions) {\n\t    _classCallCheck(this, HorizontalLineTool);\n\t\n\t    var canvas = canvasWrapper.canvas;\n\t    var horizontalLine;\n\t    eventAggregator.subscribeTo(_canvasConst2.default.TOOL.HLINE, 'HorizontalLineTool', _HorizontalLineTool);\n\t\n\t    function notify(message) {\n\t        eventAggregator.notify('TOOL_USAGE', _canvasConst2.default.TOOL.HLINE, message);\n\t    }\n\t\n\t    function createHorizontalLine() {\n\t\n\t        return new fabric.Line([0, 0, canvas.width, 0], {\n\t            left: 0,\n\t            top: 1,\n\t            hasControls: false,\n\t            lockMovementX: true,\n\t            opacity: 0.7,\n\t            padding: 4,\n\t            stroke: toolOptions.color,\n\t            strokeWidth: 2\n\t        });\n\t    }\n\t\n\t    function _HorizontalLineTool(addr, sender, action) {\n\t        if (action !== 'toolbar-click') {\n\t            abort();\n\t            return;\n\t        }\n\t\n\t        notify('active');\n\t\n\t        horizontalLine = createHorizontalLine();\n\t        canvas.add(horizontalLine);\n\t\n\t        eventAggregator.subscribeTo('keydown', 'HorizontalLine', function (topic, sender, keyCode) {\n\t            if (keyCode === 27) {\n\t                abort();\n\t            }\n\t        });\n\t\n\t        function abort() {\n\t            canvas.remove(horizontalLine);\n\t            horizontalLine = undefined;\n\t            // TODO unsubscribe\n\t\n\t            detachHorizontalLineListener();\n\t            notify('inactive');\n\t        }\n\t\n\t        var onMouseMove = function onMouseMove(options) {\n\t            if (horizontalLine) {\n\t                horizontalLine.set({\n\t                    'top': canvas.getPointer(options.e).y\n\t                });\n\t\n\t                horizontalLine.setCoords();\n\t                canvas.renderAll();\n\t            }\n\t        };\n\t        canvas.on('mouse:move', onMouseMove);\n\t\n\t        var onMouseUp = function onMouseUp(options) {\n\t            horizontalLine = createHorizontalLine();\n\t            canvas.add(horizontalLine);\n\t        };\n\t        canvas.on('mouse:up', onMouseUp);\n\t\n\t        function detachHorizontalLineListener() {\n\t            canvas.off('mouse:move', onMouseMove);\n\t            canvas.off('mouse:up', onMouseUp);\n\t        }\n\t    };\n\t};\n\t\n\texports.default = HorizontalLineTool;\n\n/***/ },\n/* 12 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } } /**\n\t                                                                                                                                                           * A tool to remove selected elements from canvas!\n\t                                                                                                                                                           */\n\t\n\t\n\t/**\n\t * A tool to remove selected elements from canvas.\n\t */\n\t\n\tvar RemoveTool =\n\t/**\n\t * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t * @constructor\n\t * @param {Canvas} canvasWrapper - Canvas.\n\t * @param {EventAggregator} eventAggregator - Event mediator.\n\t */\n\tfunction RemoveTool(canvasWrapper, eventAggregator) {\n\t    _classCallCheck(this, RemoveTool);\n\t\n\t    eventAggregator.notify('tool-enabled', _canvasConst2.default.TOOL.REMOVE, false);\n\t    /**\n\t    * Called upon removal.\n\t    */\n\t    var remove = function remove() {\n\t        var c = canvasWrapper.canvas;\n\t        if (c.getActiveObject()) {\n\t            c.remove(c.getActiveObject());\n\t        }\n\t        eventAggregator.notify('TOOL_USAGE', _canvasConst2.default.TOOL.REMOVE, 'inactive');\n\t    };\n\t\n\t    eventAggregator.subscribeTo(_canvasConst2.default.TOOL.REMOVE, 'RemoveTool', remove);\n\t\n\t    eventAggregator.subscribeTo('keydown', 'RemoveTool', function (topic, sender, keyCode) {\n\t        if (keyCode === 46) {\n\t            remove();\n\t        }\n\t    });\n\t\n\t    canvasWrapper.canvas.on('object:selected', function (o) {\n\t        eventAggregator.notify('tool-enabled', _canvasConst2.default.TOOL.REMOVE, true);\n\t    });\n\t    canvasWrapper.canvas.on('selection:cleared', function (o) {\n\t        eventAggregator.notify('tool-enabled', _canvasConst2.default.TOOL.REMOVE, false);\n\t    });\n\t};\n\t\n\texports.default = RemoveTool;\n\n/***/ },\n/* 13 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar editorHeight = 30;\n\t\n\t/**\n\t * A tool to create a text editor in the canvas.\n\t */\n\t\n\tvar TextTool =\n\t/**\n\t * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t * @constructor\n\t * @param {Canvas} canvasWrapper - Canvas.\n\t * @param {EventAggregator} eventAggregator - Event mediator.\n\t */\n\tfunction TextTool(canvasWrapper, eventAggregator, toolOptions) {\n\t    _classCallCheck(this, TextTool);\n\t\n\t    var canvas = canvasWrapper.canvas;\n\t    var editor;\n\t    eventAggregator.subscribeTo(_canvasConst2.default.TOOL.TEXT, 'TextTool', textTool);\n\t    eventAggregator.subscribeTo('keydown', 'TextTool', function (topic, sender, keyCode) {\n\t        if (keyCode === 27) {\n\t            abort();\n\t        }\n\t    });\n\t\n\t    function notify(message) {\n\t        eventAggregator.notify('TOOL_USAGE', _canvasConst2.default.TOOL.TEXT, message);\n\t    }\n\t\n\t    function abort() {\n\t        if (editor) {\n\t            canvas.remove(editor);\n\t            editor = undefined;\n\t            notify('inactive');\n\t        }\n\t    }\n\t    function textTool(topic, sender, payload) {\n\t        if (payload !== 'toolbar-click') {\n\t            abort();\n\t            return;\n\t        }\n\t        notify('active');\n\t        editor = new fabric.IText('Click to leave a comment', {\n\t            fontFamily: toolOptions.fontFamily,\n\t            fontSize: toolOptions.fontSize,\n\t            left: 100,\n\t            top: -40,\n\t            fill: toolOptions.color,\n\t            hasControls: false\n\t        });\n\t\n\t        canvas.add(editor);\n\t\n\t        var onMove = function onMove(options) {\n\t            if (editor) {\n\t                var pointer = canvas.getPointer(options.e);\n\t                editor.set({\n\t                    'top': pointer.y,\n\t                    'left': pointer.x\n\t                });\n\t                editor.setCoords();\n\t                canvas.renderAll();\n\t            }\n\t        };\n\t        canvas.on('mouse:move', onMove);\n\t\n\t        function detachTextListener() {\n\t            if (editor) {\n\t                canvas.off('mouse:move', onMove);\n\t                canvas.off('mouse:up', detachTextListener);\n\t                editor.setCoords();\n\t                editor = undefined;\n\t                canvas.renderAll();\n\t                notify('inactive');\n\t            }\n\t        }\n\t        canvas.on('mouse:up', detachTextListener);\n\t    }\n\t};\n\t\n\texports.default = TextTool;\n\n/***/ },\n/* 14 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _arrow = __webpack_require__(7);\n\t\n\tvar _arrow2 = _interopRequireDefault(_arrow);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/** Default options for arrow tools initialization */\n\tvar defaultToolProps = {\n\t    label: 'Arrow',\n\t    color: _canvasConst2.default.DEFAULT_COLOR,\n\t    activeColor: '#55f',\n\t    size: 15,\n\t    lineWidth: 4\n\t};\n\tnew _browserApi2.default().getFromWindow('redraw').registerTool(_canvasConst2.default.TOOL.ARROW, _arrow2.default, defaultToolProps);\n\n/***/ },\n/* 15 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _box = __webpack_require__(8);\n\t\n\tvar _box2 = _interopRequireDefault(_box);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/**\n\t * Default options.\n\t */\n\tvar defaultToolProps = {\n\t  label: 'Box',\n\t  color: _canvasConst2.default.DEFAULT_COLOR\n\t};\n\t\n\tnew _browserApi2.default().getFromWindow('redraw').registerTool(_canvasConst2.default.TOOL.BOX, _box2.default, defaultToolProps);\n\n/***/ },\n/* 16 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _pixelate = __webpack_require__(9);\n\t\n\tvar _pixelate2 = _interopRequireDefault(_pixelate);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/**\n\t * Default pixelate options.\n\t */\n\tvar defaultToolProps = {\n\t  label: 'Pixelate',\n\t  color: _canvasConst2.default.DEFAULT_COLOR\n\t};\n\t\n\tnew _browserApi2.default().getFromWindow('redraw').registerTool(_canvasConst2.default.TOOL.PIXELATE, _pixelate2.default, defaultToolProps);\n\n/***/ },\n/* 17 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _clearTool = __webpack_require__(10);\n\t\n\tvar _clearTool2 = _interopRequireDefault(_clearTool);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar toolProps = {\n\t    label: 'Clear'\n\t};\n\t\n\tnew _browserApi2.default().getFromWindow('redraw').registerTool(_canvasConst2.default.TOOL.CLEAR, _clearTool2.default, toolProps);\n\n/***/ },\n/* 18 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _horizontalLineTool = __webpack_require__(11);\n\t\n\tvar _horizontalLineTool2 = _interopRequireDefault(_horizontalLineTool);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar toolProps = {\n\t    label: 'Limit line',\n\t    color: _canvasConst2.default.DEFAULT_COLOR,\n\t    activeColor: '#55f'\n\t};\n\t\n\tnew _browserApi2.default().getFromWindow('redraw').registerTool(_canvasConst2.default.TOOL.HLINE, _horizontalLineTool2.default, toolProps);\n\n/***/ },\n/* 19 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _removeTool = __webpack_require__(12);\n\t\n\tvar _removeTool2 = _interopRequireDefault(_removeTool);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar toolProps = {\n\t    label: 'Delete'\n\t};\n\t\n\tnew _browserApi2.default().getFromWindow('redraw').registerTool(_canvasConst2.default.TOOL.REMOVE, _removeTool2.default, toolProps);\n\n/***/ },\n/* 20 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _text = __webpack_require__(13);\n\t\n\tvar _text2 = _interopRequireDefault(_text);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/**\n\t * Default options for text tools initialization.\n\t */\n\tvar toolProps = {\n\t    label: 'Text',\n\t    fontFamily: 'arial',\n\t    fontSize: 18,\n\t    color: _canvasConst2.default.DEFAULT_COLOR\n\t};\n\tnew _browserApi2.default().getFromWindow('redraw').registerTool(_canvasConst2.default.TOOL.TEXT, _text2.default, toolProps);\n\n/***/ }\n/******/ ])\n});\n;\n//# sourceMappingURL=redraw.js.map"],"sourceRoot":"/source/"}