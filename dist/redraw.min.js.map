{"version":3,"sources":["redraw.min.js"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","dataURItoBlob","encodedData","decodedData","atob","split","array","i","length","push","charCodeAt","Blob","Uint8Array","type","getToolsFromUserSettings","allTools","options","tools","definedTools","t","toolName","overwriteProps","allProps","precedenceProps","globalOptions","results","hasOwnProperty","globalOverrides","indexOf","_createClass","defineProperties","target","props","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","_browserApi","_browserApi2","_canvasWrapper","_canvasWrapper2","_eventAggregator","_eventAggregator2","_controlsDispatcher","_controlsDispatcher2","redrawNs","Redraw","imgElement","events","_canvas","jsonContent","loadFromJSON","controls","initializeTools","value","canvas","deactivateAllWithDispatch","toDataURL","format","multiplier","scale","getDataUrlForExport","includeImage","cancelActiveTool","jsObj","toObject","backgroundImage","JSON","stringify","jsonRepresentation","getAllObjects","topic","callbackFn","subscriberId","scope","subscribeTo","unsubscribeTo","toolSettings","toolsInUse","passedProps","toolFn","setupTools","canvasContainer","Annotation","registerTool","_name","_toolFn","_options","address","buttonCss","appendToWindow","isBrowser","window","Browser","document","attributeName","getFromWindow","_canvasConst","_canvasConst2","Canvas","eventAggregator","parent","parentNode","redrawWrapper","createElement","className","CSS","PARENT","insertBefore","removeChild","canvasElem","canvasWrapper","CANVAS_WRAPPER","appendChild","canvasLeft","offsetLeft","fabric","theCanvas","delayedSetup","setupImage","tmp","Image","addEventListener","src","getBinder","renderAll","event","notify","image","maxWidth","width","maxHeight","height","scaleY","setDimensions","setScaleX","setScaleY","setBackgroundImage","_scaleY","subscriptionId","sender","status","defaultCursor","clear","bind","offsetTop","getObjects","isEnabled","selection","forEachObject","o","selectable","TOOL","ARROW","DELETE","HORIZONTAL_LINE","PIXELATE","RECTANGLE","RESET","TEXT","DEFAULT_COLOR","ACTIVE_BUTTON","BUTTON","TOOLBAR","EventAggregator","subscriptionsByTopic","onNotifyFn","_invokationScope","subscriber","invokationScope","_subscriber","j","splice","payload","s2","undefined","apply","addClasses","btnObj","classes","allClasses","forEach","clazz","classList","add","ControlsDispatcher","notifyActive","activeTool","manageKeys","e","keyCode","domParent","mainOptions","container","toolbarCss","toolbarFirst","firstChild","btn","innerHTML","label","onclick","btnActiveCss","buttonActiveCss","currTool","remove","line","ArrowTool","toolOptions","arrow","start","end","callee","initListeners","arguments","moveFn","onMove","downFn","onMouseDown","upFn","onMUP","message","done","enableSelection","removeCanvasListeners","points","x1","y1","x2","y2","dx","dy","angle","Math","atan2","PI","Triangle","fill","activeColor","top","left","size","originX","originY","pointer","getPointer","set","x","y","moveArrowIndicator","perimeter","abs","color","group","Group","hasControls","hasBorders","stroke","Line","strokeWidth","lineWidth","abort","me","on","off","DeleteTool","getActiveObject","HorizontalLineTool","createHorizontalLine","lockMovementX","opacity","padding","_HorizontalLineTool","addr","action","horizontalLine","detachHorizontalLineListener","onMouseMove","onMouseUp","setCoords","PixelateTool","detachRectangleListener","mouseDown","drawRectangle","drawRectangleDone","rect","currWidth","startLeft","currHeight","startTop","applyFilter","index","filter","filters","applyFilters","object","util","clone","croppedDomImage","userRect","onload","lockMovementY","f","Pixelate","blocksize","sendToBack","Rect","borderColor","hasRotatingPoint","attachRectangleListener","callbackCtx","RectangleTool","startX","startY","ResetTool","initClear","confirm","clearAllElements","all","TextTool","editor","textTool","detachTextListener","IText","fontFamily","fontSize","_arrowTool","_arrowTool2","defaultToolProps","_deleteTool","_deleteTool2","_horizontalLineTool","_horizontalLineTool2","_pixelateTool","_pixelateTool2","_rectangleTool","_rectangleTool2","_resetTool","_resetTool2","_textTool","_textTool2"],"mappings":"CAAA,SAA2CA,EAAMC,GAC1B,gBAAZC,UAA0C,gBAAXC,QACxCA,OAAOD,QAAUD,IACQ,kBAAXG,SAAyBA,OAAOC,IAC9CD,UAAWH,GACe,gBAAZC,SACdA,QAAkB,SAAID,IAEtBD,EAAe,SAAIC,KAClBK,KAAM,WACT,MAAgB,UAAUC,GAKhB,QAASC,GAAoBC,GAG5B,GAAGC,EAAiBD,GACnB,MAAOC,GAAiBD,GAAUP,OAGnC,IAAIC,GAASO,EAAiBD,IAC7BP,WACAS,GAAIF,EACJG,QAAQ,EAUT,OANAL,GAAQE,GAAUI,KAAKV,EAAOD,QAASC,EAAQA,EAAOD,QAASM,GAG/DL,EAAOS,QAAS,EAGTT,EAAOD,QAvBf,GAAIQ,KAqCJ,OATAF,GAAoBM,EAAIP,EAGxBC,EAAoBO,EAAIL,EAGxBF,EAAoBQ,EAAI,GAGjBR,EAAoB,KAK/B,SAASL,EAAQD,EAASM,GAE/BA,EAAoB,GACpBA,EAAoB,GACpBA,EAAoB,GACpBA,EAAoB,GACpBA,EAAoB,IACpBA,EAAoB,IACpBA,EAAoB,IACpBA,EAAoB,IACpBA,EAAoB,IACpBA,EAAoB,IACpBA,EAAoB,IACpBA,EAAoB,IACpBA,EAAoB,IACpBA,EAAoB,IACpBL,EAAOD,QAAUM,EAAoB,KAKhC,SAASL,EAAQD,EAASM,GAE/B,YAoBA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAgBhH,QAASC,GAAcC,GAGnB,IAAK,GAFDC,GAAcC,KAAKF,EAAYG,MAAM,KAAK,IAC1CC,KACKC,EAAI,EAAGA,EAAIJ,EAAYK,OAAQD,IACpCD,EAAMG,KAAKN,EAAYO,WAAWH,GAEtC,OAAO,IAAII,OAAM,GAAIC,YAAWN,KAC5BO,KAAM,cAYd,QAASC,GAAyBC,EAAUC,GAExC,GAAIA,GAAWA,EAAQC,MAAO,CAC1B,GAAIC,KACJ,KAAK,GAAIC,KAAKH,GAAQC,MAAO,CACzB,GAAIG,GAAWJ,EAAQC,MAAME,EAC7BD,GAAaE,GAAYL,EAASK,GAEtC,MAAOF,GAEP,MAAOH,GAqBf,QAASM,GAAeC,EAAUC,EAAiBC,EAAeJ,GAC9D,GAAIK,KAEJ,KAAK,GAAIjC,KAAK8B,GAASF,GAAUJ,QACzBM,EAASF,GAAUJ,QAAQU,eAAelC,KACtC+B,EAAgBH,IAAaG,EAAgBH,IAAaG,EAAgBH,GAAUM,eAAelC,GACnGiC,EAAQjC,GAAK+B,EAAgBH,GAAU5B,GAChCmC,EAAgBC,QAAQpC,GAAK,IAAMgC,EAAcE,eAAelC,GACvEiC,EAAQjC,GAAKgC,EAAchC,GAE3BiC,EAAQjC,GAAK8B,EAASF,GAAUJ,QAAQxB,GAIpD,OAAOiC,GApGX,GAAII,GAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIzB,GAAI,EAAGA,EAAIyB,EAAMxB,OAAQD,IAAK,CAAE,GAAI0B,GAAaD,EAAMzB,EAAI0B,GAAWC,WAAaD,EAAWC,aAAc,EAAOD,EAAWE,cAAe,EAAU,SAAWF,KAAYA,EAAWG,UAAW,GAAMC,OAAOC,eAAeP,EAAQE,EAAWM,IAAKN,IAAiB,MAAO,UAAUlC,EAAayC,EAAYC,GAAiJ,MAA9HD,IAAYV,EAAiB/B,EAAY2C,UAAWF,GAAiBC,GAAaX,EAAiB/B,EAAa0C,GAAqB1C,MAE5hB4C,EAAc3D,EAAoB,GAElC4D,EAAenD,EAAuBkD,GAEtCE,EAAiB7D,EAAoB,GAErC8D,EAAkBrD,EAAuBoD,GAEzCE,EAAmB/D,EAAoB,GAEvCgE,EAAoBvD,EAAuBsD,GAE3CE,EAAsBjE,EAAoB,GAE1CkE,EAAuBzD,EAAuBwD,GAU9CE,GACAlC,UA8CAU,GAAmB,QAAS,eAmC5ByB,EAAS,WAQT,QAASA,GAAOC,EAAYrC,GACxBnB,EAAgBf,KAAMsE,GAEtBtE,KAAKwE,OAAS,GAAIN,GAAAA,WAClBhC,EAAUA,MACVlC,KAAKyE,QAAU,GAAIT,GAAAA,WAAwBO,EAAYvE,KAAKwE,OAAQtC,GAEhEA,EAAQwC,aACR1E,KAAKyE,QAAQE,aAAazC,EAAQwC,aAGtC1E,KAAK4E,SAAW5E,KAAK6E,gBAAgB7E,KAAKwE,OAAQtC,GA2ItD,MAlIAa,GAAauB,IACTb,IAAK,sBACLqB,MAAO,WAEH,MADA9E,MAAKyE,QAAQM,OAAOC,4BACbhF,KAAKyE,QAAQM,OAAOE,WACvBC,OAAQ,MACRC,WAAY,EAAInF,KAAKyE,QAAQW,WAWrC3B,IAAK,cACLqB,MAAO,WACH,MAAO9E,MAAKqF,yBAUhB5B,IAAK,aACLqB,MAAO,WACH,MAAO3D,GAAcnB,KAAKqF,0BAW9B5B,IAAK,SACLqB,MAAO,SAAgBQ,GACnBtF,KAAK4E,SAASW,kBACd,IAAIC,GAAQxF,KAAKyE,QAAQM,OAAOU,UAAU,gBAAiB,gBAAiB,eAAgB,eAAgB,eAAgB,iBAAkB,cAAe,mBAAoB,aAAc,OAAQ,WAKvM,OAHKH,UACME,GAAME,gBAEVC,KAAKC,UAAUJ,MAU1B/B,IAAK,WACLqB,MAAO,SAAkBe,GACrB7F,KAAKyE,QAAQE,aAAakB,MAU9BpC,IAAK,UACLqB,MAAO,WACH,MAA+C,KAAxC9E,KAAKyE,QAAQqB,gBAAgBpE,UAGxC+B,IAAK,UACLqB,MAAO,WACH,OAAO,KAUXrB,IAAK,YACLqB,MAAO,WACH,MAAO9E,MAAKyE,QAAQM,UAGxBtB,IAAK,KACLqB,MAAO,SAAYiB,EAAOC,EAAYC,EAAcC,GAChDlG,KAAKwE,OAAO2B,YAAYJ,EAAO,MAAQE,EAAcD,EAAYE,MAGrEzC,IAAK,MACLqB,MAAO,SAAaiB,EAAOE,GACvBjG,KAAKwE,OAAO4B,cAAcL,EAAO,MAAQE,MAU7CxC,IAAK,kBACLqB,MAAO,SAAyBN,EAAQtC,GAEpCA,EAAQmE,aAAenE,EAAQmE,gBAC/B,IAAIC,GAAatE,EAAyBqC,EAASlC,MAAOD,EAE1D,KAAK,GAAII,KAAYgE,GAAY,CAC7B,GAAIC,GAAchE,EAAe8B,EAASlC,MAAOD,EAAQmE,aAAcnE,EAASI,EAEhF+B,GAASlC,MAAMG,GAAUJ,QAAUqE,EAEnC,GAAIlC,GAASlC,MAAMG,GAAUkE,OAAOxG,KAAKyE,QAASD,EAAQ+B,GAE9D,GAAI3B,GAAW,GAAIR,GAAAA,WAA6BI,EAAQtC,EAExD,OADA0C,GAAS6B,WAAWH,EAAYtG,KAAKyE,QAAQiC,gBAAiBxE,GACvD0C,MAIRN,IAGXD,GAASsC,WAAarC,EAQtBD,EAASuC,aAAe,SAAUC,EAAOC,EAASC,GAC9C1C,EAASlC,MAAM0E,IACXG,QAASH,EACTL,OAAQM,EACR5E,QAAS6E,GAGb1C,EAASlC,MAAM0E,GAAO3E,QAAQ+E,UAAY5C,EAASlC,MAAM0E,GAAO3E,QAAQ+E,WAAa,KAGzF,GAAInD,GAAAA,YAAuBoD,eAAe,SAAU7C,IAI/C,SAASxE,EAAQD,GAEtB,YAQA,SAASmB,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCANhHqC,OAAOC,eAAe5D,EAAS,cAC3BkF,OAAO,GAGX,IAAI/B,GAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIzB,GAAI,EAAGA,EAAIyB,EAAMxB,OAAQD,IAAK,CAAE,GAAI0B,GAAaD,EAAMzB,EAAI0B,GAAWC,WAAaD,EAAWC,aAAc,EAAOD,EAAWE,cAAe,EAAU,SAAWF,KAAYA,EAAWG,UAAW,GAAMC,OAAOC,eAAeP,EAAQE,EAAWM,IAAKN,IAAiB,MAAO,UAAUlC,EAAayC,EAAYC,GAAiJ,MAA9HD,IAAYV,EAAiB/B,EAAY2C,UAAWF,GAAiBC,GAAaX,EAAiB/B,EAAa0C,GAAqB1C,MAI5hBkG,EAA8B,mBAAXC,QAMnBC,EAAU,WAMV,QAASA,KACLtG,EAAgBf,KAAMqH,GAEtBrH,KAAKsH,SAAWH,EAAYG,YAC5BtH,KAAKoH,OAASD,EAAYC,UAuC9B,MA7BArE,GAAasE,IACT5D,IAAK,iBACLqB,MAAO,SAAwByC,EAAe3G,GAE1C,MAAIuG,IACAC,OAAOG,GAAiB3G,GACjB,IAEJ,KAUX6C,IAAK,gBACLqB,MAAO,SAAuByC,GAC1B,MAAIH,QACOA,OAAOG,IAGdC,cAAe,aACfrF,cAILkF,IAGXzH,GAAAA,WAAkByH,GAIb,SAASxH,EAAQD,EAASM,GAE/B,YAYA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAZhHqC,OAAOC,eAAe5D,EAAS,cAC3BkF,OAAO,GAGX,IAAI/B,GAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIzB,GAAI,EAAGA,EAAIyB,EAAMxB,OAAQD,IAAK,CAAE,GAAI0B,GAAaD,EAAMzB,EAAI0B,GAAWC,WAAaD,EAAWC,aAAc,EAAOD,EAAWE,cAAe,EAAU,SAAWF,KAAYA,EAAWG,UAAW,GAAMC,OAAOC,eAAeP,EAAQE,EAAWM,IAAKN,IAAiB,MAAO,UAAUlC,EAAayC,EAAYC,GAAiJ,MAA9HD,IAAYV,EAAiB/B,EAAY2C,UAAWF,GAAiBC,GAAaX,EAAiB/B,EAAa0C,GAAqB1C,MAE5hBwG,EAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GA2BvCE,EAAS,WAUT,QAASA,GAAOpD,EAAYqD,EAAiB1F,GACzCnB,EAAgBf,KAAM2H,GAEtB3H,KAAKkC,QAAUA,EACflC,KAAK4H,gBAAkBA,CACvB,IAAIC,GAAStD,EAAWuD,WACpBC,EAAgBT,SAASU,cAAc,MAC3CD,GAAcE,UAAYP,EAAAA,WAAsBQ,IAAIC,OACpDnI,KAAKoF,MAAQ,EACbyC,EAAOO,aAAaL,EAAexD,GACnCsD,EAAOQ,YAAY9D,EAEnB,IAAI+D,GAAahB,SAASU,cAAc,UACpCO,EAAgBjB,SAASU,cAAc,MAC3CO,GAAcN,UAAYP,EAAAA,WAAsBQ,IAAIM,eACpDD,EAAcE,YAAYH,GAC1BP,EAAcU,YAAYF,GAE1BvI,KAAKsI,WAAaA,EAElBtI,KAAK0G,gBAAkBqB,EACvB/H,KAAK0I,WAAaJ,EAAWK,WAC7B3I,KAAK+E,OAAS,GAAI6D,QAAOjB,OAAOW,GAChCtI,KAAKuE,WAAaA,CAGlB,IAAIsE,GAAY7I,KACZ8I,EAAe,WACfD,EAAUE,cAEVC,EAAM,GAAIC,MACdD,GAAIE,iBAAiB,OAAQJ,GAAc,GAC3CE,EAAIG,IAAMnJ,KAAKuE,WAAW4E,IAqG9B,MAlGApG,GAAa4E,IACTlE,IAAK,aACLqB,MAAO,WAuBH,QAASsE,GAAU3E,GACf,MAAO,YACHA,EAAQ4E,YACRC,EAAMC,OAAO,gBAAiB,WArBtC,GAJAvJ,KAAKwJ,MAAQ,GAAIZ,QAAOK,MAAMjJ,KAAKuE,YAC/BvE,KAAKkC,QAAQuH,UAAYzJ,KAAKkC,QAAQuH,SAAWzJ,KAAKwJ,MAAME,QAC5D1J,KAAKoF,MAAQpF,KAAKkC,QAAQuH,SAAWzJ,KAAKwJ,MAAME,OAEhD1J,KAAKkC,QAAQyH,WAAa3J,KAAKkC,QAAQyH,UAAY3J,KAAKwJ,MAAMI,OAAQ,CACtE,GAAIC,GAAS7J,KAAKkC,QAAQyH,UAAY3J,KAAKwJ,MAAMI,MAC7C5J,MAAKoF,MAAQyE,IACb7J,KAAKoF,MAAQyE,GAIrB7J,KAAK0J,MAAQ1J,KAAKoF,MAAQpF,KAAKuE,WAAWmF,MAC1C1J,KAAK4J,OAAS5J,KAAKoF,MAAQpF,KAAKuE,WAAWqF,OAE3C5J,KAAK+E,OAAO+E,eACRJ,MAAO1J,KAAK0J,MACZE,OAAQ5J,KAAK4J,SAGjB5J,KAAKwJ,MAAMO,UAAU/J,KAAKoF,OAC1BpF,KAAKwJ,MAAMQ,UAAUhK,KAAKoF,MAC1B,IAAIkE,GAAQtJ,KAAK4H,eAYjB,IALA5H,KAAK+E,OAAOkF,mBAAmBjK,KAAKwJ,MAAOJ,EAAUpJ,KAAK+E,YAEtD/E,KAAKkC,QAAQuH,UAAYzJ,KAAKkC,QAAQuH,SAAWzJ,KAAKwJ,MAAME,QAC5D1J,KAAKoF,MAAQpF,KAAKkC,QAAQuH,SAAWzJ,KAAKwJ,MAAME,OAEhD1J,KAAKkC,QAAQyH,WAAa3J,KAAKkC,QAAQyH,UAAY3J,KAAKwJ,MAAMI,OAAQ,CACtE,GAAIM,GAAUlK,KAAKkC,QAAQyH,UAAY3J,KAAKwJ,MAAMI,MAC9C5J,MAAKoF,MAAQ8E,IACblK,KAAKoF,MAAQ8E,GAIrBlK,KAAK4H,gBAAgBzB,YAAY,aAAc,UAAW,SAAUgE,EAAgBC,EAAQC,GACzE,WAAXA,EACArK,KAAK+E,OAAOuF,cAAgB,YAE5BtK,KAAK+E,OAAOuF,cAAgB,WAEjCtK,SAGPyD,IAAK,eACLqB,MAAO,SAAsBJ,GACzB1E,KAAK+E,OAAOwF,QACZvK,KAAK+E,OAAOJ,aAAaD,EAAa1E,KAAK+E,OAAOsE,UAAUmB,KAAKxK,KAAK+E,YAU1EtB,IAAK,eACLqB,MAAO,WACH,MAAO9E,MAAK0G,gBAAgB+D,aAUhChH,IAAK,gBACLqB,MAAO,WACH,MAAO9E,MAAK+E,OAAO2F,gBAUvBjH,IAAK,kBACLqB,MAAO,SAAyB6F,GAC5B3K,KAAK+E,OAAO6F,UAAYD,EACxB3K,KAAK+E,OAAO8F,cAAc,SAAUC,GAChCA,EAAEC,WAAaJ,QAKpBhD,IAGX/H,GAAAA,WAAkB+H,GAIb,SAAS9H,EAAQD,GAEtB,YAEA2D,QAAOC,eAAe5D,EAAS,cAC9BkF,OAAO,IAERlF,EAAAA,YACCoL,MACCC,MAAO,QACPC,OAAQ,SACRC,gBAAiB,kBACjBC,SAAU,WACVC,UAAW,YACXC,MAAO,QACPC,KAAM,QAEPC,cAAe,OACftD,KACCuD,cAAe,SACfC,OAAQ,aACRvD,OAAQ,gBACRwD,QAAS,iBACTnD,eAAgB,mBAMb,SAAS3I,EAAQD,GAEtB,YAQA,SAASmB,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCANhHqC,OAAOC,eAAe5D,EAAS,cAC3BkF,OAAO,GAGX,IAAI/B,GAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIzB,GAAI,EAAGA,EAAIyB,EAAMxB,OAAQD,IAAK,CAAE,GAAI0B,GAAaD,EAAMzB,EAAI0B,GAAWC,WAAaD,EAAWC,aAAc,EAAOD,EAAWE,cAAe,EAAU,SAAWF,KAAYA,EAAWG,UAAW,GAAMC,OAAOC,eAAeP,EAAQE,EAAWM,IAAKN,IAAiB,MAAO,UAAUlC,EAAayC,EAAYC,GAAiJ,MAA9HD,IAAYV,EAAiB/B,EAAY2C,UAAWF,GAAiBC,GAAaX,EAAiB/B,EAAa0C,GAAqB1C,MAQ5hB2K,EAAkB,WAMlB,QAASA,KACL7K,EAAgBf,KAAM4L,GAEtB5L,KAAK6L,wBA4DT,MA/CA9I,GAAa6I,IACTnI,IAAK,cACLqB,MAAO,SAAqBiB,EAAOE,EAAc6F,EAAYC,GACpD/L,KAAK6L,qBAAqB9F,KAC3B/F,KAAK6L,qBAAqB9F,OAG9B/F,KAAK6L,qBAAqB9F,GAAOpE,MAAOqK,WAAY/F,EAAcD,WAAY8F,EAAYG,gBAAiBF,OAW/GtI,IAAK,gBACLqB,MAAO,SAAuBiB,EAAOmG,GACjC,IAAK,GAAIC,KAAKnM,MAAK6L,qBAAqB9F,GAChC/F,KAAK6L,qBAAqB9F,GAAOoG,GAAGH,aAAeE,GACnDlM,KAAK6L,qBAAqB9F,GAAOqG,OAAOD,EAAG,MAavD1I,IAAK,SACLqB,MAAO,SAAgBiB,EAAOqE,EAAQiC,GAClC,IAAK,GAAIC,KAAMtM,MAAK6L,qBAAqB9F,GAAQ,CAC7C,GAAIG,GAAQqG,MACRvM,MAAK6L,qBAAqB9F,GAAOuG,GAAIL,kBACrC/F,EAAQlG,KAAK6L,qBAAqB9F,GAAOuG,GAAIL,iBAEjDjM,KAAK6L,qBAAqB9F,GAAOuG,GAAItG,WAAWwG,MAAMtG,GAAQH,EAAOqE,EAAQiC,SAKlFT,IAGXhM,GAAAA,WAAkBgM,GAIb,SAAS/L,EAAQD,EAASM,GAE/B,YAUA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAMhH,QAASuL,GAAWC,EAAQC,GACxB,GAAKA,EAAL,CACA,GAAIC,GAAaD,EAAQpL,MAAM,IAE/BqL,GAAWC,QAAQ,SAAUC,GACzBJ,EAAOK,UAAUC,IAAIF,MArB7BvJ,OAAOC,eAAe5D,EAAS,cAC3BkF,OAAO,GAGX,IAAI2C,GAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GAuBvCwF,EAOJ,QAASA,GAAmBrF,EAAiB1F,GAMzC,QAASgL,GAAanH,GAClB,MAAO,YACCoH,GACAvF,EAAgB2B,OAAO4D,EAAY,UAAW,sBAE9CA,IAAepH,GACfoH,EAAapH,EACb6B,EAAgB2B,OAAOxD,EAAO,UAAW,kBAEzCoH,EAAaZ,QAdzBxL,EAAgBf,KAAMiN,GAEtBjN,KAAKsG,aACL,IAAI6G,EAgBJnN,MAAKuF,iBAAmB,WAEhB4H,IACAvF,EAAgB2B,OAAO4D,EAAY,UAAW,sBAC9CA,EAAaZ,QAIrB,IAAIa,GAAa,SAAoBC,GACf,KAAdA,EAAEC,SAAgC,KAAdD,EAAEC,SACtB1F,EAAgB2B,OAAO,UAAW,UAAW8D,EAAEC,SAIvDlG,QAAO8B,iBAAiB,UAAWkE,GAAY,GAE/CpN,KAAKyG,WAAa,SAAUtE,EAAOoL,EAAWC,GAC1C,GAAIC,GAAYnG,SAASU,cAAc,MAEvCyE,GAAWgB,EAAW/F,EAAAA,WAAsBQ,IAAIyD,SAChDc,EAAWgB,EAAWvL,EAAQwL,YAE1BF,EAAYG,gBAAiB,EAC7BJ,EAAUnF,aAAaqF,EAAWF,EAAUK,YAE5CL,EAAU9E,YAAYgF,EAG1B,KAAK,GAAInL,KAAYH,GAAO,CACxB,GAAI0L,GAAMvG,SAASU,cAAc,SACjC6F,GAAIC,UAAY3L,EAAMG,GAAUJ,QAAQ6L,MAExCF,EAAId,UAAUC,IAAItF,EAAAA,WAAsBQ,IAAIwD,QAE5Ce,EAAWoB,EAAKL,EAAYvG,WAC5BwF,EAAWoB,EAAK1L,EAAMG,GAAUJ,QAAQ+E,WAExC4G,EAAIG,QAAUd,EAAa/K,EAAMG,GAAU0E,SAC3ChH,KAAKsG,WAAWnE,EAAMG,GAAU0E,SAAW6G,EAC3CJ,EAAUhF,YAAYoF,GAG1B,GAAII,GAAeT,EAAYU,iBAAmBxG,EAAAA,WAAsBQ,IAAIuD,aAE5E7D,GAAgBzB,YAAY,aAAc,UAAW,SAAUgE,EAAgBC,EAAQC,GACnF,GAAI8D,GAAWnO,KAAKsG,WAAW8D,EAEhB,YAAXC,GACID,IAAW+C,IACXA,EAAaZ,QAEjB4B,EAASpB,UAAUqB,OAAOH,IAE1BE,EAASpB,UAAUC,IAAIiB,IAE5BjO,MAEH4H,EAAgBzB,YAAY,eAAgB,UAAW,SAAUgE,EAAgBC,EAAQO,GACjFA,EACA3K,KAAKsG,WAAW8D,GAAQ2C,UAAUqB,OAAO,YAEzCpO,KAAKsG,WAAW8D,GAAQ2C,UAAUC,IAAI,aAE3ChN,OAIXJ,GAAAA,WAAkBqN,GAIb,SAASpN,EAAQD,EAASM,GAE/B,YAgBA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAhBhHqC,OAAOC,eAAe5D,EAAS,cAC3BkF,OAAO,GAGX,IAiBIuJ,GAjBAtL,EAAe,WAAc,QAASC,GAAiBC,EAAQC,GAAS,IAAK,GAAIzB,GAAI,EAAGA,EAAIyB,EAAMxB,OAAQD,IAAK,CAAE,GAAI0B,GAAaD,EAAMzB,EAAI0B,GAAWC,WAAaD,EAAWC,aAAc,EAAOD,EAAWE,cAAe,EAAU,SAAWF,KAAYA,EAAWG,UAAW,GAAMC,OAAOC,eAAeP,EAAQE,EAAWM,IAAKN,IAAiB,MAAO,UAAUlC,EAAayC,EAAYC,GAAiJ,MAA9HD,IAAYV,EAAiB/B,EAAY2C,UAAWF,GAAiBC,GAAaX,EAAiB/B,EAAa0C,GAAqB1C,MAE5hBwG,EAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GAEvC5D,EAAc3D,EAAoB,GAiBlCoO,GAfe3N,EAAuBkD,GAe1B,WAQZ,QAASyK,GAAU/F,EAAeX,EAAiB2G,EAAa3F,GAC5D7H,EAAgBf,KAAMsO,GAGtBtO,KAAK4H,gBAAkBA,EAEvB5H,KAAKuI,cAAgBA,EAErBvI,KAAKwO,MAAQxO,KAAK+E,OAAS/E,KAAKyO,MAAQzO,KAAK0O,IAAMnC,OAEnDvM,KAAKkC,QAAUqM,CAEf,IAAII,GAAS3O,IAEbA,MAAK4H,gBAAgBzB,YAAYuB,EAAAA,WAAsBsD,KAAKC,MAAO,YAAa,WAC5E0D,EAAOC,cAAcpC,MAAMmC,EAAQE,aAGvC7O,KAAK+E,OAASwD,EAAcxD,OAE5B/E,KAAK8O,OAAS,SAAU5M,GACpByM,EAAOI,OAAO7M,IAElBlC,KAAKgP,OAAS,SAAU9M,GACpByM,EAAOM,YAAY/M,IAEvBlC,KAAKkP,KAAO,SAAUhN,GAClByM,EAAOQ,MAAMjN,IAEjBlC,KAAKuJ,OAAS,SAAU6F,GACpBpP,KAAK4H,gBAAgB2B,OAAO,aAAc7B,EAAAA,WAAsBsD,KAAKC,MAAOmE,IAGhFpP,KAAKqP,KAAO,WACRrP,KAAKuI,cAAc+G,iBAAgB,GACnCtP,KAAKuP,wBACLvP,KAAKuJ,OAAO,aA0MpB,MA9LAxG,GAAauL,IACT7K,IAAK,qBACLqB,MAAO,SAA4B0K,GAC/B,GAAIC,GAAKD,EAAO,GACZE,EAAKF,EAAO,GACZG,EAAKH,EAAO,GACZI,EAAKJ,EAAO,GACZK,EAAKF,EAAKF,EACVK,EAAKF,EAAKF,EACVK,EAAQC,KAAKC,MAAMH,EAAID,EAE3BE,IAAS,IAAMC,KAAKE,GACpBH,GAAS,GACL/P,KAAKwO,OACLxO,KAAK+E,OAAOqJ,OAAOpO,KAAKwO,OAE5BxO,KAAKwO,MAAQ,GAAI5F,QAAOuH,UACpBJ,MAAOA,EACPK,KAAMpQ,KAAKkC,QAAQmO,YACnBC,IAAKV,EACLW,KAAMZ,EACN/F,OAAQ5J,KAAKkC,QAAQsO,KACrB9G,MAAO1J,KAAKkC,QAAQsO,KACpBC,QAAS,SACTC,QAAS,SACT3F,YAAY,IAGhB/K,KAAK+E,OAAOiI,IAAIhN,KAAKwO,UASzB/K,IAAK,QACLqB,MAAO,WACC9E,KAAKwO,QACLxO,KAAK+E,OAAOqJ,OAAOpO,KAAKwO,OACxBxO,KAAKwO,MAAQjC,QAEb8B,IACArO,KAAK+E,OAAOqJ,OAAOC,GACnBA,EAAO9B,QAEXvM,KAAK4H,gBAAgBxB,cAAc,UAAW,aAC9CpG,KAAKqP,UAUT5L,IAAK,SACLqB,MAAO,SAAgB5C,GAEnB,GAAIlC,KAAKyO,QAAUzO,KAAK0O,IAAK,CACzB,GAAIiC,GAAU3Q,KAAK+E,OAAO6L,WAAW1O,EAAQmL,EAE7CgB,GAAKwC,KACDlB,GAAMgB,EAAQG,IAElBzC,EAAKwC,KACDjB,GAAMe,EAAQI,IAGlB/Q,KAAKgR,oBAAoBhR,KAAKyO,MAAM8B,KAAMvQ,KAAKyO,MAAM6B,IAAKK,EAAQG,EAAGH,EAAQI,IAGjF/Q,KAAK+E,OAAOsE,eAUhB5F,IAAK,QACLqB,MAAO,SAAe5C,GAClB,GAAIyO,GAAU3Q,KAAK+E,OAAO6L,WAAW1O,EAAQmL,EAC7CrN,MAAK0O,KACD4B,IAAKK,EAAQI,EACbR,KAAMI,EAAQG,EAGlB,IAAIG,GAAYjB,KAAKkB,IAAIlR,KAAK0O,IAAI4B,IAAMtQ,KAAKyO,MAAM6B,KAAON,KAAKkB,IAAIlR,KAAK0O,IAAI6B,KAAOvQ,KAAKyO,MAAM8B,KAE9F,IAAIU,EAAY,GAAI,CACZjR,KAAKwO,QACLxO,KAAKwO,MAAM4B,KAAOpQ,KAAKkC,QAAQiP,MAEnC,IAAIC,GAAQ,GAAIxI,QAAOyI,OAAOhD,EAAMrO,KAAKwO,QACrC8C,aAAa,EACbC,YAAY,EACZxG,YAAY,EACZqF,KAAMpQ,KAAKkC,QAAQiP,OAEvB9C,GAAKmD,OAASxR,KAAKkC,QAAQiP,MAE3BnR,KAAK+E,OAAOiI,IAAIoE,GAGpBpR,KAAK+E,OAAOqJ,OAAOC,GACnBrO,KAAK+E,OAAOqJ,OAAOpO,KAAKwO,OACxBxO,KAAKwO,MAAQH,EAAOrO,KAAKyO,MAAQzO,KAAK0O,IAAMnC,OAC5CvM,KAAK+E,OAAOsE,eAUhB5F,IAAK,cACLqB,MAAO,SAAqB5C,GACxB,GAAIyO,GAAU3Q,KAAK+E,OAAO6L,WAAW1O,EAAQmL,EAC7CrN,MAAKyO,OACD6B,IAAKK,EAAQI,EACbR,KAAMI,EAAQG,GAGlBzC,EAAO,GAAIzF,QAAO6I,MAAMzR,KAAKyO,MAAM8B,KAAMvQ,KAAKyO,MAAM6B,IAAKtQ,KAAKyO,MAAM8B,KAAMvQ,KAAKyO,MAAM6B,MACjFoB,YAAa1R,KAAKkC,QAAQyP,UAC1BH,OAAQxR,KAAKkC,QAAQmO,YACrBI,QAAS,SACTC,QAAS,SACTY,aAAa,EACbC,YAAY,EACZxG,YAAY,IAGhB/K,KAAK+E,OAAOiI,IAAIqB,MAYpB5K,IAAK,gBACLqB,MAAO,SAAuBiB,EAAOqE,EAAQiC,GACzC,GAAgB,uBAAZA,EAEA,WADArM,MAAK4R,OAGT,IAAIC,GAAK7R,IAETA,MAAK4H,gBAAgBzB,YAAY,UAAW,YAAa,SAAUJ,EAAOqE,EAAQkD,GAE9D,KAAZA,GACAuE,EAAGD,MAAMpF,MAAMqF,KAGvB7R,KAAKyO,MAAQzO,KAAK0O,IAAMnC,OAExBvM,KAAKuI,cAAc+G,iBAAgB,GAEnCtP,KAAKuJ,OAAO,UAEZvJ,KAAK+E,OAAO+M,GAAG,aAAc9R,KAAKgP,QAClChP,KAAK+E,OAAO+M,GAAG,aAAc9R,KAAK8O,QAClC9O,KAAK+E,OAAO+M,GAAG,WAAY9R,KAAKkP,SAQpCzL,IAAK,wBACLqB,MAAO,WACH9E,KAAK+E,OAAOgN,IAAI,aAAc/R,KAAKgP,QACnChP,KAAK+E,OAAOgN,IAAI,aAAc/R,KAAK8O,QACnC9O,KAAK+E,OAAOgN,IAAI,WAAY/R,KAAKkP,UAIlCZ,KAGX1O,GAAAA,WAAkB0O,GAIb,SAASzO,EAAQD,EAASM,GAE/B,YAcA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAdhHqC,OAAOC,eAAe5D,EAAS,cAC3BkF,OAAO,GAGX,IAAI2C,GAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GAEvC5D,EAAc3D,EAAoB,GAYlC8R,GAVerR,EAAuBkD,GAiB1C,QAASmO,GAAWzJ,EAAeX,GAC/B7G,EAAgBf,KAAMgS,GAEtBpK,EAAgB2B,OAAO,eAAgB7B,EAAAA,WAAsBsD,KAAKE,QAAQ,EAI1E,IAAIkD,GAAS,WACT,GAAI3N,GAAI8H,EAAcxD,MAClBtE,GAAEwR,mBACFxR,EAAE2N,OAAO3N,EAAEwR,mBAEfrK,EAAgB2B,OAAO,aAAc7B,EAAAA,WAAsBsD,KAAKE,OAAQ,YAG5EtD,GAAgBzB,YAAYuB,EAAAA,WAAsBsD,KAAKE,OAAQ,aAAckD,GAE7ExG,EAAgBzB,YAAY,UAAW,aAAc,SAAUJ,EAAOqE,EAAQkD,GAC1D,KAAZA,GACAc,MAIR7F,EAAcxD,OAAO+M,GAAG,kBAAmB,SAAUhH,GACjDlD,EAAgB2B,OAAO,eAAgB7B,EAAAA,WAAsBsD,KAAKE,QAAQ,KAE9E3C,EAAcxD,OAAO+M,GAAG,oBAAqB,SAAUhH,GACnDlD,EAAgB2B,OAAO,eAAgB7B,EAAAA,WAAsBsD,KAAKE,QAAQ,MAIlFtL,GAAAA,WAAkBoS,GAIb,SAASnS,EAAQD,EAASM,GAE/B,YAcA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAdhHqC,OAAOC,eAAe5D,EAAS,cAC3BkF,OAAO,GAGX,IAAI2C,GAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GAEvC5D,EAAc3D,EAAoB,GAYlCgS,GAVevR,EAAuBkD,GAiB1C,QAASqO,GAAmB3J,EAAeX,EAAiB2G,GAOxD,QAAShF,GAAO6F,GACZxH,EAAgB2B,OAAO,aAAc7B,EAAAA,WAAsBsD,KAAKG,gBAAiBiE,GAGrF,QAAS+C,KAEL,MAAO,IAAIvJ,QAAO6I,MAAM,EAAG,EAAG1M,EAAO2E,MAAO,IACxC6G,KAAM,EACND,IAAK,EACLgB,aAAa,EACbc,eAAe,EACfC,QAAS,GACTC,QAAS,EACTd,OAAQjD,EAAY4C,MACpBO,YAAa,IAIrB,QAASa,GAAoBC,EAAMpI,EAAQqI,GAiBvC,QAASb,KACL7M,EAAOqJ,OAAOsE,GACdA,EAAiBnG,OAGjBoG,IACApJ,EAAO,YAqBX,QAASoJ,KACL5N,EAAOgN,IAAI,aAAca,GACzB7N,EAAOgN,IAAI,WAAYc,GA7C3B,GAAe,kBAAXJ,EAEA,WADAb,IAIJrI,GAAO,UAEPmJ,EAAiBP,IACjBpN,EAAOiI,IAAI0F,GAEX9K,EAAgBzB,YAAY,UAAW,iBAAkB,SAAUJ,EAAOqE,EAAQkD,GAC9D,KAAZA,GACAsE,KAaR,IAAIgB,GAAc,SAAqB1Q,GAC/BwQ,IACAA,EAAe7B,KACXP,IAAOvL,EAAO6L,WAAW1O,EAAQmL,GAAG0D,IAGxC2B,EAAeI,YACf/N,EAAOsE,aAGftE,GAAO+M,GAAG,aAAcc,EAExB,IAAIC,GAAY,SAAmB3Q,GAC/BwQ,EAAiBP,IACjBpN,EAAOiI,IAAI0F,GAEf3N,GAAO+M,GAAG,WAAYe,GAlE1B9R,EAAgBf,KAAMkS,EAEtB,IACIQ,GADA3N,EAASwD,EAAcxD,MAE3B6C,GAAgBzB,YAAYuB,EAAAA,WAAsBsD,KAAKG,gBAAiB,qBAAsBoH,IAuElG3S,GAAAA,WAAkBsS,GAIb,SAASrS,EAAQD,EAASM,GAE/B,YAcA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAdhHqC,OAAOC,eAAe5D,EAAS,cAC3BkF,OAAO,GAGX,IAAI2C,GAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GAEvC5D,EAAc3D,EAAoB,GAYlC6S,GAVepS,EAAuBkD,GAiB1C,QAASkP,GAAaxK,EAAeX,EAAiB2G,GAUlD,QAAShF,GAAO6F,GACZxH,EAAgB2B,OAAO,aAAc7B,EAAAA,WAAsBsD,KAAKI,SAAUgE,GAG9E,QAASC,KACL9F,EAAO,YACPyJ,IACAzK,EAAc+G,iBAAgB,GAGlC,QAAS0D,KACLjO,EAAOgN,IAAI,aAAckB,GACzBlO,EAAOgN,IAAI,aAAcmB,GACzBnO,EAAOgN,IAAI,WAAYoB,GAEvBC,EAAO7G,OACP3E,EAAgBxB,cAAc,UAAW,gBAG7C,QAAS8M,GAAchR,GAEnB,GAAIyO,GAAU5L,EAAO6L,WAAW1O,EAAQmL,GAEpCiD,EAAM,OACNC,EAAO,OACP8C,EAAY1C,EAAQG,EAAIwC,EACxBC,EAAa5C,EAAQI,EAAIyC,CAEzBjD,GADY,EAAZ8C,EACO1C,EAAQG,EAERwC,EAIPhD,EADa,EAAbiD,EACM5C,EAAQI,EAERyC,EAGVJ,EAAKvC,KACDP,IAAOA,EACPC,KAAQA,EACR7G,MAASsG,KAAKkB,IAAImC,GAClBzJ,OAAUoG,KAAKkB,IAAIqC,KAGvBH,EAAKN,YACL/N,EAAOsE,YAGX,QAASoK,GAAYC,EAAOC,EAAQ/S,GAChCA,EAAIgT,QAAQF,GAASC,EACrB/S,EAAIiT,aAAa9O,EAAOsE,UAAUmB,KAAKzF,IAG3C,QAASoO,GAAkBjR,GACvB6C,EAAOgN,IAAI,aAAcmB,GACzBnO,EAAOgN,IAAI,WAAYoB,GACvBpO,EAAOqJ,OAAOgF,EAEd,IAAIzC,GAAU5L,EAAO6L,WAAW1O,EAAQmL,GACpCgG,EAAY1C,EAAQG,EAAIwC,EACxBC,EAAa5C,EAAQI,EAAIyC,CAEzBxD,MAAKkB,IAAImC,GAAa,GAAKrD,KAAKkB,IAAIqC,GAAc,IAClD,WACI,GAAIO,GAASlL,OAAOmL,KAAKD,OAAOE,MAAMzL,EAAciB,OAEhDyK,EAAkB,GAAIhL,MAC1BgL,GAAgB9K,IAAM2K,EAAO7O,WACzBsL,KAAM6C,EAAK7C,KACXD,IAAK8C,EAAK9C,IACV5G,MAAO0J,EAAK1J,MACZE,OAAQwJ,EAAKxJ,QAEjB,IAAIsK,GAAWd,CACfa,GAAgBE,OAAS,WACrB,GAAI3K,GAAQ,GAAIZ,QAAOK,MAAMgL,EAE7BzK,GAAMqH,KACFN,KAAM2D,EAAS3D,KACfD,IAAK4D,EAAS5D,IACd5G,MAAOwK,EAASxK,MAChBE,OAAQsK,EAAStK,OACjB0H,aAAa,EACbc,eAAe,EACfgC,eAAe,GAGnB,IAAIC,GAAIzL,OAAOK,MAAM2K,OACrBH,GAAY,EAAG,GAAIY,GAAEC,UACjBC,UAAWhG,EAAYgG,YACvB/K,GAEJA,EAAMsJ,YACN/N,EAAOiI,IAAIxD,GACXzE,EAAOyP,WAAWhL,GAClBzE,EAAOsE,gBAInBtE,EAAOsE,YAEP+J,EAAO7G,OAGX,QAAS0G,GAAU/Q,GACf,GAAIyO,GAAU5L,EAAO6L,WAAW1O,EAAQmL,EAExCmG,GAAW7C,EAAQI,EACnBuC,EAAY3C,EAAQG,EAEpBsC,EAAO,GAAIxK,QAAO6L,MACdlE,KAAM+C,EACNhD,IAAKkD,EACL9J,MAAO,EACPgL,YAAanG,EAAY4C,MACzBvH,OAAQ,EACRwG,KAAM7B,EAAY4C,MAClBkB,QAAS,GACTf,aAAa,EACbqD,kBAAkB,EAClBlE,QAAS,OACTC,QAAS,MACT3F,YAAY,IAGhBhG,EAAOiI,IAAIoG,GACXA,EAAKN,YACL/N,EAAOsE,YACPtE,EAAO+M,GAAG,aAAcoB,GACxBnO,EAAO+M,GAAG,WAAYqB,GAG1B,QAASyB,GAAwB7O,EAAOqE,EAAQiC,GAC5C,MAAgB,uBAAZA,MACAgD,MAGJzH,EAAgBzB,YAAY,UAAW,eAAgB,SAAUJ,EAAOqE,EAAQkD,GAC5D,KAAZA,GACA+B,KAELwF,GACHtM,EAAc+G,iBAAgB,GAC9B/F,EAAO,cAEPxE,GAAO+M,GAAG,aAAcmB,IA5J5BlS,EAAgBf,KAAM+S,GAEtBnL,EAAgBzB,YAAYuB,EAAAA,WAAsBsD,KAAKI,SAAU,eAAgBwJ,EACjF,IAAIxB,GAAO,OACPyB,EAAc7U,KACdwT,EAAW,OACXF,EAAY,OACZvO,EAASwD,EAAcxD,QAyJ/BnF,GAAAA,WAAkBmT,GAIb,SAASlT,EAAQD,EAASM,GAE/B,YAcA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAdhHqC,OAAOC,eAAe5D,EAAS,cAC3BkF,OAAO,GAGX,IAaIsO,GAbA3L,EAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GAEvC5D,EAAc3D,EAAoB,GAelC4U,GAbenU,EAAuBkD,GAoB1C,QAASiR,GAAcvM,EAAeX,EAAiB2G,GASnD,QAAShF,GAAO6F,GACZxH,EAAgB2B,OAAO,aAAc7B,EAAAA,WAAsBsD,KAAKK,UAAW+D,GAG/E,QAASC,KACL9F,EAAO,YACPyJ,IACAzK,EAAc+G,iBAAgB,GAGlC,QAAS0D,KACLjO,EAAOgN,IAAI,aAAckB,GACzBlO,EAAOgN,IAAI,aAAcmB,GACzBnO,EAAOgN,IAAI,WAAYoB,GAEvBC,EAAO7G,OACP3E,EAAgBxB,cAAc,UAAW,iBAG7C,QAAS8M,GAAchR,GAEnB,GAAIyO,GAAU5L,EAAO6L,WAAW1O,EAAQmL,GAEpCiD,EAAM,OACNC,EAAO,OACP7G,EAAQiH,EAAQG,EAAIiE,EACpBnL,EAAS+G,EAAQI,EAAIiE,CACzBzB,GAAavD,KAAKkB,IAAItH,GACtByJ,EAAYrD,KAAKkB,IAAIxH,GAGjB6G,EADQ,EAAR7G,EACOiH,EAAQG,EAERiE,EAIPzE,EADS,EAAT1G,EACM+G,EAAQI,EAERiE,EAGV5B,EAAKvC,KACDP,IAAOA,EACPC,KAAQA,EACR7G,MAAS2J,EACTzJ,OAAU2J,IAGdH,EAAKN,YACL/N,EAAOsE,YAEX,QAAS8J,GAAkBjR,GAIvB,MAHA6C,GAAOgN,IAAI,aAAcmB,GACzBnO,EAAOgN,IAAI,WAAYoB,GAEnBnD,KAAKkB,IAAImC,GAAa,GAAKrD,KAAKkB,IAAIqC,GAAc,MAClDxO,GAAOqJ,OAAOgF,IAIlBA,EAAKvC,KAAMwB,QAAS,SACpBtN,GAAOsE,aAGX,QAAS4J,GAAU/Q,GACf,GAAIyO,GAAU5L,EAAO6L,WAAW1O,EAAQmL,EACxCgG,GAAYE,EAAa,EAEzByB,EAASrE,EAAQI,EACjBgE,EAASpE,EAAQG,EAEjBsC,EAAO,GAAIxK,QAAO6L,MACdlE,KAAMwE,EACNzE,IAAK0E,EACLtL,MAAO,EACPgL,YAAanG,EAAY4C,MACzBvH,OAAQ,EACRwG,KAAM7B,EAAY4C,MAClBkB,QAAS,GACTf,aAAa,EACbqD,kBAAkB,EAClBlE,QAAS,OACTC,QAAS,MACT3F,YAAY,IAGhBhG,EAAOiI,IAAIoG,GACXA,EAAKN,YACL/N,EAAOsE,YACPtE,EAAO+M,GAAG,aAAcoB,GACxBnO,EAAO+M,GAAG,WAAYqB,GAG1B,QAASyB,GAAwB7O,EAAOqE,EAAQiC,GAC5C,MAAgB,uBAAZA,MACAgD,MAGJzH,EAAgBzB,YAAY,UAAW,gBAAiB,SAAUJ,EAAOqE,EAAQkD,GAC7D,KAAZA,GACA+B,KAELwF,GACHtM,EAAc+G,iBAAgB,GAC9B/F,EAAO,cAEPxE,GAAO+M,GAAG,aAAcmB,IAnH5BlS,EAAgBf,KAAM8U,EAEtB,IAAIzB,GAAWE,EAAYyB,EAAQD,CAEnCnN,GAAgBzB,YAAYuB,EAAAA,WAAsBsD,KAAKK,UAAW,gBAAiBuJ,EACnF,IAAIC,GAAc7U,KACd+E,EAASwD,EAAcxD,QAiH/BnF,GAAAA,WAAkBkV,GAIb,SAASjV,EAAQD,EAASM,GAE/B,YAcA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAdhHqC,OAAOC,eAAe5D,EAAS,cAC9BkF,OAAO,GAGR,IAAI2C,GAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GAEvC5D,EAAc3D,EAAoB,GAYlC+U,GAVetU,EAAuBkD,GAiB1C,QAASoR,GAAU1M,EAAeX,GAIjC,QAASsN,GAAUnP,EAAOqE,EAAQiC,GACjB,uBAAZA,GAAoC8I,QAAQ,0HAC/CC,IAEDxN,EAAgB2B,OAAO,aAAc7B,EAAAA,WAAsBsD,KAAKM,MAAO,YAGxE,QAAS8J,KAGR,IAAK,GAFD3U,GAAI8H,EAAcxD,OAClBsQ,EAAM5U,EAAEiK,aACHjJ,EAAI4T,EAAI3T,OAAS,EAAGD,GAAK,EAAGA,IACpChB,EAAE2N,OAAOiH,EAAI5T,IAdfV,EAAgBf,KAAMiV,GAEtBrN,EAAgBzB,YAAYuB,EAAAA,WAAsBsD,KAAKM,MAAO,YAAa4J,IAiB5EtV,GAAAA,WAAkBqV,GAIb,SAASpV,EAAQD,EAASM,GAE/B,YAcA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAEvF,QAASG,GAAgBC,EAAUC,GAAe,KAAMD,YAAoBC,IAAgB,KAAM,IAAIC,WAAU,qCAdhHqC,OAAOC,eAAe5D,EAAS,cAC3BkF,OAAO,GAGX,IAAI2C,GAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GAEvC5D,EAAc3D,EAAoB,GAclCoV,GAZe3U,EAAuBkD,GAmB1C,QAASyR,GAAS/M,EAAeX,EAAiB2G,GAY9C,QAAShF,GAAO6F,GACZxH,EAAgB2B,OAAO,aAAc7B,EAAAA,WAAsBsD,KAAKO,KAAM6D,GAG1E,QAASwC,KACD2D,IACAxQ,EAAOqJ,OAAOmH,GACdA,EAAShJ,OACThD,EAAO,aAGf,QAASiM,GAASzP,EAAOqE,EAAQiC,GA8B7B,QAASoJ,KACDF,IACAxQ,EAAOgN,IAAI,aAAchD,GACzBhK,EAAOgN,IAAI,WAAY0D,GACvBF,EAAOzC,YACPyC,EAAShJ,OACTxH,EAAOsE,YACPE,EAAO,aApCf,GAAgB,kBAAZ8C,EAEA,WADAuF,IAGJrI,GAAO,UACPgM,EAAS,GAAI3M,QAAO8M,MAAM,4BACtBC,WAAYpH,EAAYoH,WACxBC,SAAUrH,EAAYqH,SACtBrF,KAAM,IACND,IAAK,IACLF,KAAM7B,EAAY4C,MAClBG,aAAa,IAGjBvM,EAAOiI,IAAIuI,EAEX,IAAIxG,GAAS,SAAgB7M,GACzB,GAAIqT,EAAQ,CACR,GAAI5E,GAAU5L,EAAO6L,WAAW1O,EAAQmL,EACxCkI,GAAO1E,KACHP,IAAOK,EAAQI,EACfR,KAAQI,EAAQG,IAEpByE,EAAOzC,YACP/N,EAAOsE,aAGftE,GAAO+M,GAAG,aAAc/C,GAYxBhK,EAAO+M,GAAG,WAAY2D,GA9D1B1U,EAAgBf,KAAMsV,EAEtB,IACIC,GADAxQ,EAASwD,EAAcxD,MAE3B6C,GAAgBzB,YAAYuB,EAAAA,WAAsBsD,KAAKO,KAAM,WAAYiK,GACzE5N,EAAgBzB,YAAY,UAAW,WAAY,SAAUJ,EAAOqE,EAAQkD,GACxD,KAAZA,GACAsE,OA2DZhS,GAAAA,WAAkB0V,GAIb,SAASzV,EAAQD,EAASM,GAE/B,YAcA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAZvF,GAAI6G,GAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GAEvC5D,EAAc3D,EAAoB,GAElC4D,EAAenD,EAAuBkD,GAEtCgS,EAAa3V,EAAoB,GAEjC4V,EAAcnV,EAAuBkV,GAOrCE,GACFhI,MAAO,QACPoD,MAAOzJ,EAAAA,WAAsB8D,cAC7B6E,YAAa,OACbG,KAAM,GACNmB,UAAW,IAGb,GAAI7N,GAAAA,YAAuB0D,cAAc,UAAUZ,aAAac,EAAAA,WAAsBsD,KAAKC,MAAO6K,EAAAA,WAAqBC,IAIlH,SAASlW,EAAQD,EAASM,GAE/B,YAcA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAZvF,GAAI6G,GAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GAEvC5D,EAAc3D,EAAoB,GAElC4D,EAAenD,EAAuBkD,GAEtCmS,EAAc9V,EAAoB,GAElC+V,EAAetV,EAAuBqV,GAOtCD,GACFhI,MAAO,WAGT,GAAIjK,GAAAA,YAAuB0D,cAAc,UAAUZ,aAAac,EAAAA,WAAsBsD,KAAKE,OAAQ+K,EAAAA,WAAsBF,IAIpH,SAASlW,EAAQD,EAASM,GAE/B,YAcA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAZvF,GAAI6G,GAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GAEvC5D,EAAc3D,EAAoB,GAElC4D,EAAenD,EAAuBkD,GAEtCqS,EAAsBhW,EAAoB,GAE1CiW,EAAuBxV,EAAuBuV,GAO9CH,GACFhI,MAAO,kBACPoD,MAAOzJ,EAAAA,WAAsB8D,cAC7B6E,YAAa,SAGf,GAAIvM,GAAAA,YAAuB0D,cAAc,UAAUZ,aAAac,EAAAA,WAAsBsD,KAAKG,gBAAiBgL,EAAAA,WAA8BJ,IAIrI,SAASlW,EAAQD,EAASM,GAE/B,YAcA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAZvF,GAAI6G,GAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GAEvC5D,EAAc3D,EAAoB,GAElC4D,EAAenD,EAAuBkD,GAEtCuS,EAAgBlW,EAAoB,IAEpCmW,EAAiB1V,EAAuByV,GAOxCL,GACFhI,MAAO,WACPoD,MAAOzJ,EAAAA,WAAsB8D,cAC7B+I,UAAW,IAGb,GAAIzQ,GAAAA,YAAuB0D,cAAc,UAAUZ,aAAac,EAAAA,WAAsBsD,KAAKI,SAAUiL,EAAAA,WAAwBN,IAIxH,SAASlW,EAAQD,EAASM,GAE/B,YAcA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAZvF,GAAI6G,GAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GAEvC5D,EAAc3D,EAAoB,GAElC4D,EAAenD,EAAuBkD,GAEtCyS,EAAiBpW,EAAoB,IAErCqW,EAAkB5V,EAAuB2V,GAOzCP,GACFhI,MAAO,YACPoD,MAAOzJ,EAAAA,WAAsB8D,gBAG/B,GAAI1H,GAAAA,YAAuB0D,cAAc,UAAUZ,aAAac,EAAAA,WAAsBsD,KAAKK,UAAWkL,EAAAA,WAAyBR,IAI1H,SAASlW,EAAQD,EAASM,GAE/B,YAcA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAZvF,GAAI6G,GAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GAEvC5D,EAAc3D,EAAoB,GAElC4D,EAAenD,EAAuBkD,GAEtC2S,EAAatW,EAAoB,IAEjCuW,EAAc9V,EAAuB6V,GAOrCT,GACFhI,MAAO,UAGT,GAAIjK,GAAAA,YAAuB0D,cAAc,UAAUZ,aAAac,EAAAA,WAAsBsD,KAAKM,MAAOmL,EAAAA,WAAqBV,IAIlH,SAASlW,EAAQD,EAASM,GAE/B,YAcA,SAASS,GAAuBC,GAAO,MAAOA,IAAOA,EAAIC,WAAaD,GAAQE,UAASF,GAZvF,GAAI6G,GAAevH,EAAoB,GAEnCwH,EAAgB/G,EAAuB8G,GAEvC5D,EAAc3D,EAAoB,GAElC4D,EAAenD,EAAuBkD,GAEtC6S,EAAYxW,EAAoB,IAEhCyW,EAAahW,EAAuB+V,GAOpCX,GACFhI,MAAO,OACP4H,WAAY,QACZC,SAAU,GACVzE,MAAOzJ,EAAAA,WAAsB8D,gBAG/B,GAAI1H,GAAAA,YAAuB0D,cAAc,UAAUZ,aAAac,EAAAA,WAAsBsD,KAAKO,KAAMoL,EAAAA,WAAoBZ","file":"redraw.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"chartpen\"] = factory();\n\telse\n\t\troot[\"chartpen\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t__webpack_require__(1);\n\t__webpack_require__(7);\n\t__webpack_require__(8);\n\t__webpack_require__(9);\n\t__webpack_require__(10);\n\t__webpack_require__(11);\n\t__webpack_require__(12);\n\t__webpack_require__(13);\n\t__webpack_require__(14);\n\t__webpack_require__(15);\n\t__webpack_require__(16);\n\t__webpack_require__(17);\n\t__webpack_require__(18);\n\t__webpack_require__(19);\n\tmodule.exports = __webpack_require__(20);\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _canvasWrapper = __webpack_require__(3);\n\t\n\tvar _canvasWrapper2 = _interopRequireDefault(_canvasWrapper);\n\t\n\tvar _eventAggregator = __webpack_require__(5);\n\t\n\tvar _eventAggregator2 = _interopRequireDefault(_eventAggregator);\n\t\n\tvar _controlsDispatcher = __webpack_require__(6);\n\t\n\tvar _controlsDispatcher2 = _interopRequireDefault(_controlsDispatcher);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * Namespace-root, that will be set to window-Object.\n\t * @access private\n\t */\n\tvar redrawNs = {\n\t    tools: {}\n\t};\n\t\n\t/**\n\t * Makes a blob from eg base64-string.\n\t * @access private\n\t * @param data {string} encodedData - to encode\n\t * @returns {Blob} results\n\t */\n\tfunction dataURItoBlob(encodedData) {\n\t    var decodedData = atob(encodedData.split(',')[1]);\n\t    var array = []; // 8-bit unsigned array\n\t    for (var i = 0; i < decodedData.length; i++) {\n\t        array.push(decodedData.charCodeAt(i));\n\t    }\n\t    return new Blob([new Uint8Array(array)], {\n\t        type: 'image/png'\n\t    });\n\t}\n\t\n\t/**\n\t * If the user has defined the options.tools, then use this to\n\t * extract the sepcified subset from allTools.\n\t * @access private\n\t * @param {Object[]} allTools - should be tools to pick from.\n\t * @param {Object} options - with or without property tools.\n\t * @returns {Object} containing all or the selected tools.\n\t */\n\tfunction getToolsFromUserSettings(allTools, options) {\n\t\n\t    if (options && options.tools) {\n\t        var definedTools = {};\n\t        for (var t in options.tools) {\n\t            var toolName = options.tools[t];\n\t            definedTools[toolName] = allTools[toolName];\n\t        }\n\t        return definedTools;\n\t    } else {\n\t        return allTools;\n\t    }\n\t}\n\t\n\t/**\n\t * Defines the options-properties allowed to infect all tools-settings.\n\t * @access private\n\t */\n\tvar globalOverrides = ['color', 'activeColor'];\n\t\n\t/**\n\t * Figures out which options should be applied for a particular toolName.\n\t * @access private\n\t * @param {Object} allProps - already defined options, that shold not be lost, but perhaps\n\t * replaced if defined in precedenceProps or globalOptions.\n\t * @param {Object} precedenceProps - that may have a property named toolName, that will\n\t * replace options from allProps.\n\t * @param {Object} globalOptions - top-level options that will overwrite allProp but not precedenceProps\n\t * @param {string} toolName - name of the tool, which options is processed\n\t * @returns {Object} with tool applies options\n\t */\n\tfunction overwriteProps(allProps, precedenceProps, globalOptions, toolName) {\n\t    var results = {};\n\t\n\t    for (var p in allProps[toolName].options) {\n\t        if (allProps[toolName].options.hasOwnProperty(p)) {\n\t            if (precedenceProps[toolName] && precedenceProps[toolName] && precedenceProps[toolName].hasOwnProperty(p)) {\n\t                results[p] = precedenceProps[toolName][p];\n\t            } else if (globalOverrides.indexOf(p) > -1 && globalOptions.hasOwnProperty(p)) {\n\t                results[p] = globalOptions[p];\n\t            } else {\n\t                results[p] = allProps[toolName].options[p];\n\t            }\n\t        }\n\t    }\n\t    return results;\n\t}\n\t\n\t/**\n\t * Main module, and the only public api for usage.\n\t * @module redraw\n\t */\n\t\n\tvar Redraw = function () {\n\t    /**\n\t     * Redraw constructor. Bootstraps the canvas and tools.\n\t     * @constructor\n\t     * @param {Object} imgElement - The dom element that holds the image.\n\t     * @param {Object} options - Options.\n\t     */\n\t\n\t    function Redraw(imgElement, options) {\n\t        _classCallCheck(this, Redraw);\n\t\n\t        this.events = new _eventAggregator2.default();\n\t        options = options || {};\n\t        this._canvas = new _canvasWrapper2.default(imgElement, this.events, options); // Needs defactor\n\t\n\t        if (options.jsonContent) {\n\t            this._canvas.loadFromJSON(options.jsonContent);\n\t        }\n\t\n\t        this.controls = this.initializeTools(this.events, options);\n\t    }\n\t    /**\n\t     * Get the png-representation of the canvas.\n\t     * @access public\n\t     * @returns {string} with base64 encoded png.\n\t     */\n\t\n\t\n\t    _createClass(Redraw, [{\n\t        key: 'getDataUrlForExport',\n\t        value: function getDataUrlForExport() {\n\t            this._canvas.canvas.deactivateAllWithDispatch();\n\t            return this._canvas.canvas.toDataURL({\n\t                format: 'png',\n\t                multiplier: 1 / this._canvas.scale\n\t            });\n\t        }\n\t\n\t        /**\n\t         * Get the base64-encoded png-representation of the canvas.\n\t         * @access public\n\t         * @returns {string} with base64 encoded png.\n\t         */\n\t\n\t    }, {\n\t        key: 'toBase64URL',\n\t        value: function toBase64URL() {\n\t            return this.getDataUrlForExport();\n\t        }\n\t\n\t        /**\n\t         * Get the binary png-representation of the canvas.\n\t         * @access public\n\t         * @returns {Blob} with canvas as png.\n\t         */\n\t\n\t    }, {\n\t        key: 'toDataBlob',\n\t        value: function toDataBlob() {\n\t            return dataURItoBlob(this.getDataUrlForExport());\n\t        }\n\t\n\t        /**\n\t         * Get the json-representation of the canvas.\n\t         * @access public\n\t         * @param {boolean} includeImage - true if background-image should be included in the json.\n\t         * @returns {string} with json.\n\t         */\n\t\n\t    }, {\n\t        key: 'toJson',\n\t        value: function toJson(includeImage) {\n\t            this.controls.cancelActiveTool();\n\t            var jsObj = this._canvas.canvas.toObject(['lockMovementX', 'lockMovementY', 'lockRotation', 'lockScalingX', 'lockScalingY', 'lockUniScaling', 'hasControls', 'hasRotatingPoint', 'selectable', 'fill', 'padding']);\n\t\n\t            if (!includeImage) {\n\t                delete jsObj.backgroundImage;\n\t            }\n\t            return JSON.stringify(jsObj);\n\t        }\n\t\n\t        /**\n\t         * Resets image and loads content from provided json.\n\t         * @access public\n\t         * @param {string} jsonRepresentation - to provide as current state of the canvas.\n\t         */\n\t\n\t    }, {\n\t        key: 'fromJson',\n\t        value: function fromJson(jsonRepresentation) {\n\t            this._canvas.loadFromJSON(jsonRepresentation);\n\t        }\n\t\n\t        /**\n\t         * Tells whether or not any objects are present in the canvas, i.e. arrows, rectangles other than the image itself.\n\t         * @access public\n\t         * @returns {boolean} true if there are obejcts, i.e.\n\t         */\n\t\n\t    }, {\n\t        key: 'isEmpty',\n\t        value: function isEmpty() {\n\t            return this._canvas.getAllObjects().length === 0;\n\t        }\n\t    }, {\n\t        key: 'isDirty',\n\t        value: function isDirty() {\n\t            return true;\n\t        }\n\t\n\t        /**\n\t         * Returns the canvas representation, as is from Fabric.js\n\t         * @access public\n\t         * @returns {Object} canvas, see http://fabricjs.com/.\n\t         */\n\t\n\t    }, {\n\t        key: 'getCanvas',\n\t        value: function getCanvas() {\n\t            return this._canvas.canvas;\n\t        }\n\t    }, {\n\t        key: 'on',\n\t        value: function on(topic, callbackFn, subscriberId, scope) {\n\t            this.events.subscribeTo(topic, 'cx-' + subscriberId, callbackFn, scope);\n\t        }\n\t    }, {\n\t        key: 'off',\n\t        value: function off(topic, subscriberId) {\n\t            this.events.unsubscribeTo(topic, 'cx-' + subscriberId);\n\t        }\n\t\n\t        /**\n\t         * Initializes all selected tools.\n\t         * @param {EventAggregator} events - used for all mediated communications.\n\t         * @param {Object} options - settings for all tools.\n\t         */\n\t\n\t    }, {\n\t        key: 'initializeTools',\n\t        value: function initializeTools(events, options) {\n\t            var localToolSettings = {};\n\t            options.toolSettings = options.toolSettings || {};\n\t            var toolsInUse = getToolsFromUserSettings(redrawNs.tools, options);\n\t\n\t            for (var toolName in toolsInUse) {\n\t                var passedProps = overwriteProps(redrawNs.tools, options.toolSettings, options, toolName);\n\t\n\t                redrawNs.tools[toolName].options = passedProps;\n\t\n\t                new redrawNs.tools[toolName].toolFn(this._canvas, events, passedProps);\n\t            }\n\t            var controls = new _controlsDispatcher2.default(events, options);\n\t            controls.setupTools(toolsInUse, this._canvas.canvasContainer, options);\n\t            return controls;\n\t        }\n\t    }]);\n\t\n\t    return Redraw;\n\t}();\n\t\n\tredrawNs.Annotation = Redraw;\n\t/**\n\t * Used by tools to register themselves to be available for usage.\n\t * @access public\n\t * @param {string} _name - name of tool.\n\t * @param {function(canvas: CanvasWrapper, events: EventAggregator, passedProps: Object)} _toolFn - callback function, invoked upon initialization of the tools.\n\t * @param {Object} _options - options, to be used as default ones.\n\t */\n\tredrawNs.registerTool = function (_name, _toolFn, _options) {\n\t    redrawNs.tools[_name] = {\n\t        address: _name,\n\t        toolFn: _toolFn,\n\t        options: _options\n\t    };\n\t    // buttonCss is an attribute that applies to all tools\n\t    redrawNs.tools[_name].options.buttonCss = redrawNs.tools[_name].options.buttonCss || '';\n\t};\n\t\n\tnew _browserApi2.default().appendToWindow('redraw', redrawNs);\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar isBrowser = typeof window !== 'undefined';\n\t\n\t/**\n\t * Facade of the browser apis. The main purpose id to facilitate testing.\n\t */\n\t\n\tvar Browser = function () {\n\t    /**\n\t     * Contructor that determines if there is a browser present.\n\t     * @constructor\n\t     */\n\t\n\t    function Browser() {\n\t        _classCallCheck(this, Browser);\n\t\n\t        this.document = isBrowser ? document : {};\n\t        this.window = isBrowser ? window : {};\n\t    }\n\t\n\t    /**\n\t     * Appends property to the browser window object.\n\t     * @param {string} attributeName - Name of the property to create/assign.\n\t     * @param {Object} obj - value to set.\n\t     */\n\t\n\t\n\t    _createClass(Browser, [{\n\t        key: 'appendToWindow',\n\t        value: function appendToWindow(attributeName, obj) {\n\t\n\t            if (isBrowser) {\n\t                window[attributeName] = obj;\n\t                return true;\n\t            }\n\t            return false;\n\t        }\n\t\n\t        /**\n\t         * Use to retrieve property from the browser window object.\n\t         * @param {string} attributeName - Name of the property to create/assign.\n\t         * @returns {Object} obj - retrieved value, or mock if not browser.\n\t         */\n\t\n\t    }, {\n\t        key: 'getFromWindow',\n\t        value: function getFromWindow(attributeName) {\n\t            if (window) {\n\t                return window[attributeName];\n\t            }\n\t            return {\n\t                getFromWindow: function getFromWindow() {},\n\t                tools: [] };\n\t        }\n\t    }]);\n\t\n\t    return Browser;\n\t}();\n\n\texports.default = Browser;\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t* Gets the scroll position of a dom element.\n\t* @access private\n\t* @param {Object} elem - target element.\n\t*/\n\tfunction scrollPosition(elem) {\n\t    var left = 0,\n\t        top = 0;\n\t\n\t    do {\n\t        left += elem.scrollLeft;\n\t        top += elem.scrollTop;\n\t    } while (elem = elem.offsetParent);\n\t\n\t    return [left, top];\n\t}\n\t\n\t/**\n\t * Canvas object that facilitates\n\t */\n\t\n\tvar Canvas = function () {\n\t    /**\n\t    * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t    * @constructor\n\t    * @param {Object} imgElement - dom element that will be replaced and\n\t    * used as background for canvas.\n\t    * @param {EventAggregator} eventAggregator - Event mediator.\n\t    * @param {Object} options - parameters used to setup looks and all tools preferences.\n\t    */\n\t\n\t    function Canvas(imgElement, eventAggregator, options) {\n\t        _classCallCheck(this, Canvas);\n\t\n\t        this.options = options;\n\t        this.eventAggregator = eventAggregator;\n\t        var parent = imgElement.parentNode;\n\t        var redrawWrapper = document.createElement('div');\n\t        redrawWrapper.className = _canvasConst2.default.CSS.PARENT;\n\t        this.scale = 1;\n\t        parent.insertBefore(redrawWrapper, imgElement);\n\t        parent.removeChild(imgElement);\n\t\n\t        var canvasElem = document.createElement('canvas');\n\t        var canvasWrapper = document.createElement('div');\n\t        canvasWrapper.className = _canvasConst2.default.CSS.CANVAS_WRAPPER;\n\t        canvasWrapper.appendChild(canvasElem);\n\t        redrawWrapper.appendChild(canvasWrapper);\n\t\n\t        this.canvasElem = canvasElem;\n\t\n\t        this.canvasContainer = redrawWrapper;\n\t        this.canvasLeft = canvasElem.offsetLeft;\n\t        this.canvas = new fabric.Canvas(canvasElem);\n\t        this.imgElement = imgElement;\n\t\n\t        /* wait until the image is surely loaded to make the setup */\n\t        var theCanvas = this;\n\t        var delayedSetup = function delayedSetup() {\n\t            theCanvas.setupImage();\n\t        };\n\t        var tmp = new Image();\n\t        tmp.addEventListener('load', delayedSetup, false);\n\t        tmp.src = this.imgElement.src;\n\t    }\n\t\n\t    _createClass(Canvas, [{\n\t        key: 'setupImage',\n\t        value: function setupImage() {\n\t            this.image = new fabric.Image(this.imgElement);\n\t            if (this.options.maxWidth && this.options.maxWidth < this.image.width) {\n\t                this.scale = this.options.maxWidth / this.image.width;\n\t            }\n\t            if (this.options.maxHeight && this.options.maxHeight < this.image.height) {\n\t                var scaleY = this.options.maxHeight / this.image.height;\n\t                if (this.scale > scaleY) {\n\t                    this.scale = scaleY;\n\t                }\n\t            }\n\t\n\t            this.width = this.scale * this.imgElement.width;\n\t            this.height = this.scale * this.imgElement.height;\n\t\n\t            this.canvas.setDimensions({\n\t                width: this.width,\n\t                height: this.height\n\t            });\n\t\n\t            this.image.setScaleX(this.scale);\n\t            this.image.setScaleY(this.scale);\n\t            var event = this.eventAggregator;\n\t            function getBinder(_canvas) {\n\t                return function () {\n\t                    _canvas.renderAll();\n\t                    event.notify('canvas-loaded', 'CANVAS');\n\t                };\n\t            }\n\t            this.canvas.setBackgroundImage(this.image, getBinder(this.canvas), {});\n\t\n\t            if (this.options.maxWidth && this.options.maxWidth < this.image.width) {\n\t                this.scale = this.options.maxWidth / this.image.width;\n\t            }\n\t            if (this.options.maxHeight && this.options.maxHeight < this.image.height) {\n\t                var _scaleY = this.options.maxHeight / this.image.height;\n\t                if (this.scale > _scaleY) {\n\t                    this.scale = _scaleY;\n\t                }\n\t            }\n\t\n\t            this.eventAggregator.subscribeTo('TOOL_USAGE', 'toolbar', function (subscriptionId, sender, status) {\n\t                if (status === 'active') {\n\t                    this.canvas.defaultCursor = 'crosshair';\n\t                } else {\n\t                    this.canvas.defaultCursor = 'default';\n\t                }\n\t            }, this);\n\t        }\n\t    }, {\n\t        key: 'loadFromJSON',\n\t        value: function loadFromJSON(jsonContent) {\n\t            this.canvas.clear();\n\t            this.canvas.loadFromJSON(jsonContent, this.canvas.renderAll.bind(this.canvas));\n\t        }\n\t\n\t        /**\n\t         * Gets the top position of the canvas dom element.\n\t         * @access public\n\t         * @returns {number} position in pixels?\n\t         */\n\t\n\t    }, {\n\t        key: 'getCanvasTop',\n\t        value: function getCanvasTop() {\n\t            return this.canvasContainer.offsetTop;\n\t        }\n\t\n\t        /**\n\t         * Gets the array of all objects of the canvas.\n\t         * @access public\n\t         * @returns {Array} with canvas object, or undefined if empty.\n\t         */\n\t\n\t    }, {\n\t        key: 'getAllObjects',\n\t        value: function getAllObjects() {\n\t            return this.canvas.getObjects();\n\t        }\n\t\n\t        /**\n\t         * Set/unset whether or not it is possible to select objects of the canvas.\n\t         * @access pulic\n\t         * @param {boolean} isEnabled - true if selection is enabled, false otherwise.\n\t         */\n\t\n\t    }, {\n\t        key: 'enableSelection',\n\t        value: function enableSelection(isEnabled) {\n\t            this.canvas.selection = isEnabled; // Restore fabricjs selection-box\n\t            this.canvas.forEachObject(function (o) {\n\t                o.selectable = isEnabled;\n\t            });\n\t        }\n\t    }]);\n\t\n\t    return Canvas;\n\t}();\n\n\texports.default = Canvas;\n\n/***/ },\n/* 4 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\texports.default = {\n\t\tTOOL: {\n\t\t\tARROW: 'arrow',\n\t\t\tDELETE: 'delete',\n\t\t\tHORIZONTAL_LINE: 'horizontal_line',\n\t\t\tPIXELATE: 'pixelate',\n\t\t\tRECTANGLE: 'rectangle',\n\t\t\tRESET: 'reset',\n\t\t\tTEXT: 'text'\n\t\t},\n\t\tDEFAULT_COLOR: '#33e',\n\t\tCSS: {\n\t\t\tACTIVE_BUTTON: 'active',\n\t\t\tBUTTON: 'redraw_btn',\n\t\t\tPARENT: 'redraw_parent',\n\t\t\tTOOLBAR: 'redraw_toolbar',\n\t\t\tCANVAS_WRAPPER: 'redraw_canvas'\n\t\t}\n\t};\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t* Mediator for events.\n\t*/\n\t\n\tvar EventAggregator = function () {\n\t    /**\n\t     * Contructor that initializes internal stuff.\n\t     * @constructor\n\t     */\n\t\n\t    function EventAggregator() {\n\t        _classCallCheck(this, EventAggregator);\n\t\n\t        this.subscriptionsByTopic = {};\n\t    }\n\t\n\t    /**\n\t     * Registers a subscriber for a specific event topic.\n\t     * @param {string} topic - name of the event type / topic.\n\t     * @param {string} subscriberId - id the subscriber, must be unique.\n\t     * @param {function(topic: string, sender: string, payload: Object)} onNotifyFn - callback\n\t     * invoked upon when upon notification.\n\t     * @param {Object} [_invokationScope] - scope to be used when invoking callback.\n\t     */\n\t\n\t\n\t    _createClass(EventAggregator, [{\n\t        key: \"subscribeTo\",\n\t        value: function subscribeTo(topic, subscriberId, onNotifyFn, _invokationScope) {\n\t            if (!this.subscriptionsByTopic[topic]) {\n\t                this.subscriptionsByTopic[topic] = [];\n\t            }\n\t\n\t            this.subscriptionsByTopic[topic].push({ subscriber: subscriberId, callbackFn: onNotifyFn, invokationScope: _invokationScope });\n\t        }\n\t\n\t        // ToDo needs test\n\t        /**\n\t         * Unregisters a subscriber from a specific event topic.\n\t         * @param {string} topic - name of the event type / topic.\n\t         * @param {string} _subscriber - id the unique subscriber.\n\t         */\n\t\n\t    }, {\n\t        key: \"unsubscribeTo\",\n\t        value: function unsubscribeTo(topic, _subscriber) {\n\t            for (var j in this.subscriptionsByTopic[topic]) {\n\t                if (this.subscriptionsByTopic[topic][j].subscriber === _subscriber) {\n\t                    this.subscriptionsByTopic[topic].splice(j, 1);\n\t                }\n\t            }\n\t        }\n\t\n\t        /**\n\t         * Called to notify all subscribers of this topic\n\t         * @param {string} topic - name of the event type / topic.\n\t         * @param {string} sender - address of the sender.\n\t         * @param {Object} payload - any data to pass to the subscriber.\n\t         */\n\t\n\t    }, {\n\t        key: \"notify\",\n\t        value: function notify(topic, sender, payload) {\n\t            for (var s2 in this.subscriptionsByTopic[topic]) {\n\t                var scope = undefined;\n\t                if (this.subscriptionsByTopic[topic][s2].invokationScope) {\n\t                    scope = this.subscriptionsByTopic[topic][s2].invokationScope;\n\t                }\n\t                this.subscriptionsByTopic[topic][s2].callbackFn.apply(scope, [topic, sender, payload]);\n\t            }\n\t        }\n\t    }]);\n\t\n\t    return EventAggregator;\n\t}();\n\n\texports.default = EventAggregator;\n\n/***/ },\n/* 6 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * Adds a class to the array of classes.\n\t * @private\n\t */\n\tfunction addClasses(btnObj, classes) {\n\t    if (!classes) return;\n\t    var allClasses = classes.split(' ');\n\t\n\t    allClasses.forEach(function (clazz) {\n\t        btnObj.classList.add(clazz);\n\t    });\n\t}\n\t\n\t/**\n\t * Main manager for the toolbar.\n\t */\n\t\n\tvar ControlsDispatcher =\n\t/**\n\t * Controls contructor. Is provided with canvas-wrapper and options to initialize to toolbar.\n\t * @constructor\n\t * @param {EventAggregator} eventAggregator - Event mediator.\n\t * @param {Object} options - from user.\n\t */\n\tfunction ControlsDispatcher(eventAggregator, options) {\n\t    _classCallCheck(this, ControlsDispatcher);\n\t\n\t    this.toolsInUse = {};\n\t    var activeTool, delBtn;\n\t\n\t    function notifyActive(topic) {\n\t        return function () {\n\t            if (activeTool) {\n\t                eventAggregator.notify(activeTool, 'toolbar', 'toolbar-deactivate');\n\t            }\n\t            if (activeTool !== topic) {\n\t                activeTool = topic;\n\t                eventAggregator.notify(topic, 'toolbar', 'toolbar-click');\n\t            } else {\n\t                activeTool = undefined;\n\t            }\n\t        };\n\t    }\n\t\n\t    this.cancelActiveTool = function () {\n\t\n\t        if (activeTool) {\n\t            eventAggregator.notify(activeTool, 'toolbar', 'toolbar-deactivate');\n\t            activeTool = undefined;\n\t        }\n\t    };\n\t\n\t    var manageKeys = function manageKeys(e) {\n\t        if (e.keyCode === 46 || e.keyCode === 27) {\n\t            eventAggregator.notify('keydown', 'toolbar', e.keyCode);\n\t        }\n\t    };\n\t\n\t    window.addEventListener('keydown', manageKeys, false);\n\t\n\t    this.setupTools = function (tools, domParent, mainOptions) {\n\t        var container = document.createElement('div');\n\t\n\t        addClasses(container, _canvasConst2.default.CSS.TOOLBAR);\n\t        addClasses(container, options.toolbarCss);\n\t\n\t        if (mainOptions.toolbarFirst === true) {\n\t            domParent.insertBefore(container, domParent.firstChild);\n\t        } else {\n\t            domParent.appendChild(container);\n\t        }\n\t\n\t        for (var toolName in tools) {\n\t            var btn = document.createElement('button');\n\t            btn.innerHTML = tools[toolName].options.label;\n\t\n\t            btn.classList.add(_canvasConst2.default.CSS.BUTTON);\n\t\n\t            addClasses(btn, mainOptions.buttonCss);\n\t            addClasses(btn, tools[toolName].options.buttonCss);\n\t\n\t            btn.onclick = notifyActive(tools[toolName].address);\n\t            this.toolsInUse[tools[toolName].address] = btn;\n\t            container.appendChild(btn);\n\t        }\n\t\n\t        var btnActiveCss = mainOptions.buttonActiveCss || _canvasConst2.default.CSS.ACTIVE_BUTTON;\n\t\n\t        eventAggregator.subscribeTo('TOOL_USAGE', 'toolbar', function (subscriptionId, sender, status) {\n\t            var currTool = this.toolsInUse[sender];\n\t\n\t            if (status !== 'active') {\n\t                if (sender === activeTool) {\n\t                    activeTool = undefined;\n\t                }\n\t                currTool.classList.remove(btnActiveCss);\n\t            } else {\n\t                currTool.classList.add(btnActiveCss);\n\t            }\n\t        }, this);\n\t\n\t        eventAggregator.subscribeTo('tool-enabled', 'toolbar', function (subscriptionId, sender, isEnabled) {\n\t            if (isEnabled) {\n\t                this.toolsInUse[sender].classList.remove('disabled');\n\t            } else {\n\t                this.toolsInUse[sender].classList.add('disabled');\n\t            }\n\t        }, this);\n\t    };\n\t};\n\t\n\texports.default = ControlsDispatcher;\n\n/***/ },\n/* 7 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/** length of arrow head */\n\tvar indicationLength = 8;\n\t/** line used during drag n drop */\n\tvar line;\n\t\n\t/**\n\t * A tool to paint arrows.\n\t */\n\t\n\tvar ArrowTool = function () {\n\t    /**\n\t     * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t     * @constructor\n\t     * @param {Canvas} canvasWrapper - Canvas.\n\t     * @param {EventAggregator} eventAggregator - Event mediator.\n\t     */\n\t\n\t    function ArrowTool(canvasWrapper, eventAggregator, toolOptions, fabric) {\n\t        _classCallCheck(this, ArrowTool);\n\t\n\t        /** eventAggregator for madiated cummunications */\n\t        this.eventAggregator = eventAggregator;\n\t        /** main api to use for canvas manipulation */\n\t        this.canvasWrapper = canvasWrapper;\n\t        /** coords for the elements of the arrow */\n\t        this.arrow = this.canvas = this.start = this.end = undefined;\n\t        /** options */\n\t        this.options = toolOptions;\n\t\n\t        var callee = this;\n\t\n\t        this.eventAggregator.subscribeTo(_canvasConst2.default.TOOL.ARROW, 'ArrowTool', function () {\n\t            callee.initListeners.apply(callee, arguments);\n\t        });\n\t        /** shorthand to canvas */\n\t        this.canvas = canvasWrapper.canvas;\n\t\n\t        this.moveFn = function (options) {\n\t            callee.onMove(options);\n\t        };\n\t        this.downFn = function (options) {\n\t            callee.onMouseDown(options);\n\t        };\n\t        this.upFn = function (options) {\n\t            callee.onMUP(options);\n\t        };\n\t        this.notify = function (message) {\n\t            this.eventAggregator.notify('TOOL_USAGE', _canvasConst2.default.TOOL.ARROW, message);\n\t        };\n\t\n\t        this.done = function () {\n\t            this.canvasWrapper.enableSelection(true);\n\t            this.removeCanvasListeners();\n\t            this.notify('inactive');\n\t        };\n\t    }\n\t\n\t    /**\n\t     * Move the head of the arrow.\n\t     * Cred for http://stackoverflow.com/questions/29890294/arrow-shape-using-fabricjs\n\t     * @private\n\t     * @param {Object} points - 4d.\n\t     */\n\t\n\t\n\t    _createClass(ArrowTool, [{\n\t        key: 'moveArrowIndicator',\n\t        value: function moveArrowIndicator(points) {\n\t            var x1 = points[0],\n\t                y1 = points[1],\n\t                x2 = points[2],\n\t                y2 = points[3],\n\t                dx = x2 - x1,\n\t                dy = y2 - y1,\n\t                angle = Math.atan2(dy, dx);\n\t\n\t            angle *= 180 / Math.PI;\n\t            angle += 90;\n\t            if (this.arrow) {\n\t                this.canvas.remove(this.arrow);\n\t            }\n\t            this.arrow = new fabric.Triangle({\n\t                angle: angle,\n\t                fill: this.options.activeColor,\n\t                top: y2,\n\t                left: x2,\n\t                height: this.options.size,\n\t                width: this.options.size,\n\t                originX: 'center',\n\t                originY: 'center',\n\t                selectable: false\n\t            });\n\t\n\t            this.canvas.add(this.arrow);\n\t        }\n\t\n\t        /**\n\t         * Cancels this paint operation, i.e. removes any ongoing paint-objects och de-registers listeners.\n\t         * @private\n\t         */\n\t\n\t    }, {\n\t        key: 'abort',\n\t        value: function abort() {\n\t            if (this.arrow) {\n\t                this.canvas.remove(this.arrow);\n\t                this.arrow = undefined;\n\t            }\n\t            if (line) {\n\t                this.canvas.remove(line);\n\t                line = undefined;\n\t            }\n\t            this.eventAggregator.unsubscribeTo('keydown', 'ArrowTool');\n\t            this.done();\n\t        }\n\t\n\t        /**\n\t         * Function callback, invoked when mouse moves, even before mouse has been pressed.\n\t         * @private\n\t         * @param {Object} options - for the event.\n\t         */\n\t\n\t    }, {\n\t        key: 'onMove',\n\t        value: function onMove(options) {\n\t\n\t            if (this.start && !this.end) {\n\t                var pointer = this.canvas.getPointer(options.e);\n\t\n\t                line.set({\n\t                    'x2': pointer.x\n\t                });\n\t                line.set({\n\t                    'y2': pointer.y\n\t                });\n\t\n\t                this.moveArrowIndicator([this.start.left, this.start.top, pointer.x, pointer.y]);\n\t            }\n\t\n\t            this.canvas.renderAll();\n\t        }\n\t\n\t        /**\n\t         * Function callback, invoked on mouse up.\n\t         * @private\n\t         * @param {Object} options - for the event.\n\t         */\n\t\n\t    }, {\n\t        key: 'onMUP',\n\t        value: function onMUP(options) {\n\t            var pointer = this.canvas.getPointer(options.e);\n\t            this.end = {\n\t                top: pointer.y,\n\t                left: pointer.x\n\t            };\n\t\n\t            var perimeter = Math.abs(this.end.top - this.start.top) + Math.abs(this.end.left - this.start.left);\n\t\n\t            if (perimeter > 10) {\n\t                if (this.arrow) {\n\t                    this.arrow.fill = this.options.color;\n\t                }\n\t                var group = new fabric.Group([line, this.arrow], {\n\t                    hasControls: false,\n\t                    hasBorders: true,\n\t                    selectable: false,\n\t                    fill: this.options.color\n\t                });\n\t                line.stroke = this.options.color;\n\t\n\t                this.canvas.add(group);\n\t            }\n\t\n\t            this.canvas.remove(line);\n\t            this.canvas.remove(this.arrow);\n\t            this.arrow = line = this.start = this.end = undefined;\n\t            this.canvas.renderAll();\n\t        }\n\t\n\t        /**\n\t         * Function callback, invoked on mouse down.\n\t         * @private\n\t         * @param {Object} options - for the event.\n\t         */\n\t\n\t    }, {\n\t        key: 'onMouseDown',\n\t        value: function onMouseDown(options) {\n\t            var pointer = this.canvas.getPointer(options.e);\n\t            this.start = {\n\t                top: pointer.y,\n\t                left: pointer.x\n\t            };\n\t\n\t            line = new fabric.Line([this.start.left, this.start.top, this.start.left, this.start.top], {\n\t                strokeWidth: this.options.lineWidth,\n\t                stroke: this.options.activeColor,\n\t                originX: 'center',\n\t                originY: 'center',\n\t                hasControls: false,\n\t                hasBorders: true,\n\t                selectable: true\n\t            });\n\t\n\t            this.canvas.add(line);\n\t        }\n\t\n\t        /**\n\t         * Function callback, invoked when toolbar is clicked.\n\t         * @private\n\t         * @param {string} topic - .\n\t         * @param {string} sender - .\n\t         * @param {string} payload - value shold be \"toolbar-deactivate\" if tool is active.\n\t         */\n\t\n\t    }, {\n\t        key: 'initListeners',\n\t        value: function initListeners(topic, sender, payload) {\n\t            if (payload === 'toolbar-deactivate') {\n\t                this.abort();\n\t                return;\n\t            }\n\t            var me = this;\n\t\n\t            this.eventAggregator.subscribeTo('keydown', 'ArrowTool', function (topic, sender, keyCode) {\n\t\n\t                if (keyCode === 27) {\n\t                    me.abort.apply(me);\n\t                }\n\t            });\n\t            this.start = this.end = undefined;\n\t\n\t            this.canvasWrapper.enableSelection(false);\n\t\n\t            this.notify('active');\n\t\n\t            this.canvas.on('mouse:down', this.downFn);\n\t            this.canvas.on('mouse:move', this.moveFn);\n\t            this.canvas.on('mouse:up', this.upFn);\n\t        }\n\t        /**\n\t         * Removes listeners.\n\t         * @private\n\t         */\n\t\n\t    }, {\n\t        key: 'removeCanvasListeners',\n\t        value: function removeCanvasListeners() {\n\t            this.canvas.off('mouse:down', this.downFn);\n\t            this.canvas.off('mouse:move', this.moveFn);\n\t            this.canvas.off('mouse:up', this.upFn);\n\t        }\n\t    }]);\n\t\n\t    return ArrowTool;\n\t}();\n\n\texports.default = ArrowTool;\n\n/***/ },\n/* 8 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * A tool to remove selected elements from canvas.\n\t */\n\t\n\tvar DeleteTool =\n\t/**\n\t * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t * @constructor\n\t * @param {Canvas} canvasWrapper - Canvas.\n\t * @param {EventAggregator} eventAggregator - Event mediator.\n\t */\n\tfunction DeleteTool(canvasWrapper, eventAggregator) {\n\t    _classCallCheck(this, DeleteTool);\n\t\n\t    eventAggregator.notify('tool-enabled', _canvasConst2.default.TOOL.DELETE, false);\n\t    /**\n\t    * Called upon removal.\n\t    */\n\t    var remove = function remove() {\n\t        var c = canvasWrapper.canvas;\n\t        if (c.getActiveObject()) {\n\t            c.remove(c.getActiveObject());\n\t        }\n\t        eventAggregator.notify('TOOL_USAGE', _canvasConst2.default.TOOL.DELETE, 'inactive');\n\t    };\n\t\n\t    eventAggregator.subscribeTo(_canvasConst2.default.TOOL.DELETE, 'DeleteTool', remove);\n\t\n\t    eventAggregator.subscribeTo('keydown', 'DeleteTool', function (topic, sender, keyCode) {\n\t        if (keyCode === 46) {\n\t            remove();\n\t        }\n\t    });\n\t\n\t    canvasWrapper.canvas.on('object:selected', function (o) {\n\t        eventAggregator.notify('tool-enabled', _canvasConst2.default.TOOL.DELETE, true);\n\t    });\n\t    canvasWrapper.canvas.on('selection:cleared', function (o) {\n\t        eventAggregator.notify('tool-enabled', _canvasConst2.default.TOOL.DELETE, false);\n\t    });\n\t};\n\t\n\texports.default = DeleteTool;\n\n/***/ },\n/* 9 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * A tool to create horizontal lines.\n\t */\n\t\n\tvar HorizontalLineTool =\n\t/**\n\t * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t * @constructor\n\t * @param {Canvas} canvasWrapper - Canvas.\n\t * @param {EventAggregator} eventAggregator - Event mediator.\n\t */\n\tfunction HorizontalLineTool(canvasWrapper, eventAggregator, toolOptions) {\n\t    _classCallCheck(this, HorizontalLineTool);\n\t\n\t    var canvas = canvasWrapper.canvas;\n\t    var horizontalLine;\n\t    eventAggregator.subscribeTo(_canvasConst2.default.TOOL.HORIZONTAL_LINE, 'HorizontalLineTool', _HorizontalLineTool);\n\t\n\t    function notify(message) {\n\t        eventAggregator.notify('TOOL_USAGE', _canvasConst2.default.TOOL.HORIZONTAL_LINE, message);\n\t    }\n\t\n\t    function createHorizontalLine() {\n\t\n\t        return new fabric.Line([0, 0, canvas.width, 0], {\n\t            left: 0,\n\t            top: 1,\n\t            hasControls: false,\n\t            lockMovementX: true,\n\t            opacity: 0.7,\n\t            padding: 4,\n\t            stroke: toolOptions.color,\n\t            strokeWidth: 2\n\t        });\n\t    }\n\t\n\t    function _HorizontalLineTool(addr, sender, action) {\n\t        if (action !== 'toolbar-click') {\n\t            abort();\n\t            return;\n\t        }\n\t\n\t        notify('active');\n\t\n\t        horizontalLine = createHorizontalLine();\n\t        canvas.add(horizontalLine);\n\t\n\t        eventAggregator.subscribeTo('keydown', 'HorizontalLine', function (topic, sender, keyCode) {\n\t            if (keyCode === 27) {\n\t                abort();\n\t            }\n\t        });\n\t\n\t        function abort() {\n\t            canvas.remove(horizontalLine);\n\t            horizontalLine = undefined;\n\t            // TODO unsubscribe\n\t\n\t            detachHorizontalLineListener();\n\t            notify('inactive');\n\t        }\n\t\n\t        var onMouseMove = function onMouseMove(options) {\n\t            if (horizontalLine) {\n\t                horizontalLine.set({\n\t                    'top': canvas.getPointer(options.e).y\n\t                });\n\t\n\t                horizontalLine.setCoords();\n\t                canvas.renderAll();\n\t            }\n\t        };\n\t        canvas.on('mouse:move', onMouseMove);\n\t\n\t        var onMouseUp = function onMouseUp(options) {\n\t            horizontalLine = createHorizontalLine();\n\t            canvas.add(horizontalLine);\n\t        };\n\t        canvas.on('mouse:up', onMouseUp);\n\t\n\t        function detachHorizontalLineListener() {\n\t            canvas.off('mouse:move', onMouseMove);\n\t            canvas.off('mouse:up', onMouseUp);\n\t        }\n\t    };\n\t};\n\t\n\texports.default = HorizontalLineTool;\n\n/***/ },\n/* 10 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * A tool to pixelate areas.\n\t */\n\t\n\tvar PixelateTool =\n\t/**\n\t * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t * @constructor\n\t * @param {Canvas} canvasWrapper - Canvas.\n\t * @param {EventAggregator} eventAggregator - Event mediator.\n\t */\n\tfunction PixelateTool(canvasWrapper, eventAggregator, toolOptions) {\n\t    _classCallCheck(this, PixelateTool);\n\t\n\t    eventAggregator.subscribeTo(_canvasConst2.default.TOOL.PIXELATE, 'PixelateTool', attachRectangleListener);\n\t    var rect = void 0,\n\t        callbackCtx = this;\n\t    var startTop = void 0,\n\t        startLeft = void 0;\n\t    var canvas = canvasWrapper.canvas;\n\t\n\t    function notify(message) {\n\t        eventAggregator.notify('TOOL_USAGE', _canvasConst2.default.TOOL.PIXELATE, message);\n\t    }\n\t\n\t    function done() {\n\t        notify('inactive');\n\t        detachRectangleListener();\n\t        canvasWrapper.enableSelection(true);\n\t    }\n\t\n\t    function detachRectangleListener() {\n\t        canvas.off('mouse:down', mouseDown);\n\t        canvas.off('mouse:move', drawRectangle);\n\t        canvas.off('mouse:up', drawRectangleDone);\n\t\n\t        rect = undefined;\n\t        eventAggregator.unsubscribeTo('keydown', 'PixelateTool');\n\t    }\n\t\n\t    function drawRectangle(options) {\n\t\n\t        var pointer = canvas.getPointer(options.e);\n\t\n\t        var top = void 0,\n\t            left = void 0,\n\t            currWidth = pointer.x - startLeft,\n\t            currHeight = pointer.y - startTop;\n\t        if (currWidth < 0) {\n\t            left = pointer.x;\n\t        } else {\n\t            left = startLeft;\n\t        }\n\t\n\t        if (currHeight < 0) {\n\t            top = pointer.y;\n\t        } else {\n\t            top = startTop;\n\t        }\n\t\n\t        rect.set({\n\t            'top': top,\n\t            'left': left,\n\t            'width': Math.abs(currWidth),\n\t            'height': Math.abs(currHeight)\n\t        });\n\t\n\t        rect.setCoords();\n\t        canvas.renderAll();\n\t    }\n\t\n\t    function applyFilter(index, filter, obj) {\n\t        obj.filters[index] = filter;\n\t        obj.applyFilters(canvas.renderAll.bind(canvas));\n\t    }\n\t\n\t    function drawRectangleDone(options) {\n\t        canvas.off('mouse:move', drawRectangle);\n\t        canvas.off('mouse:up', drawRectangleDone);\n\t        canvas.remove(rect);\n\t\n\t        var pointer = canvas.getPointer(options.e);\n\t        var currWidth = pointer.x - startLeft;\n\t        var currHeight = pointer.y - startTop;\n\t\n\t        if (Math.abs(currWidth) > 0 && Math.abs(currHeight) > 0) {\n\t            (function () {\n\t                var object = fabric.util.object.clone(canvasWrapper.image);\n\t\n\t                var croppedDomImage = new Image();\n\t                croppedDomImage.src = object.toDataURL({\n\t                    left: rect.left,\n\t                    top: rect.top,\n\t                    width: rect.width,\n\t                    height: rect.height\n\t                });\n\t                var userRect = rect;\n\t                croppedDomImage.onload = function () {\n\t                    var image = new fabric.Image(croppedDomImage);\n\t\n\t                    image.set({\n\t                        left: userRect.left,\n\t                        top: userRect.top,\n\t                        width: userRect.width,\n\t                        height: userRect.height,\n\t                        hasControls: false,\n\t                        lockMovementX: true,\n\t                        lockMovementY: true\n\t                    });\n\t\n\t                    var f = fabric.Image.filters;\n\t                    applyFilter(0, new f.Pixelate({\n\t                        blocksize: toolOptions.blocksize\n\t                    }), image);\n\t\n\t                    image.setCoords();\n\t                    canvas.add(image);\n\t                    canvas.sendToBack(image);\n\t                    canvas.renderAll();\n\t                };\n\t            })();\n\t        }\n\t        canvas.renderAll();\n\t\n\t        rect = undefined;\n\t    }\n\t\n\t    function mouseDown(options) {\n\t        var pointer = canvas.getPointer(options.e);\n\t\n\t        startTop = pointer.y;\n\t        startLeft = pointer.x;\n\t\n\t        rect = new fabric.Rect({\n\t            left: startLeft,\n\t            top: startTop,\n\t            width: 4,\n\t            borderColor: toolOptions.color,\n\t            height: 4,\n\t            fill: toolOptions.color,\n\t            opacity: 0.3,\n\t            hasControls: true,\n\t            hasRotatingPoint: false,\n\t            originX: 'left',\n\t            originY: 'top',\n\t            selectable: false\n\t        });\n\t\n\t        canvas.add(rect);\n\t        rect.setCoords();\n\t        canvas.renderAll();\n\t        canvas.on('mouse:move', drawRectangle);\n\t        canvas.on('mouse:up', drawRectangleDone);\n\t    }\n\t\n\t    function attachRectangleListener(topic, sender, payload) {\n\t        if (payload === 'toolbar-deactivate') {\n\t            done();\n\t            return;\n\t        }\n\t        eventAggregator.subscribeTo('keydown', 'PixelateTool', function (topic, sender, keyCode) {\n\t            if (keyCode === 27) {\n\t                done();\n\t            }\n\t        }, callbackCtx);\n\t        canvasWrapper.enableSelection(false);\n\t        notify('active');\n\t\n\t        canvas.on('mouse:down', mouseDown);\n\t    }\n\t};\n\t\n\texports.default = PixelateTool;\n\n/***/ },\n/* 11 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/** used during drag n drop */\n\tvar rect;\n\t\n\t/**\n\t * A tool to paint rectangles.\n\t */\n\t\n\tvar RectangleTool =\n\t/**\n\t * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t * @constructor\n\t * @param {Canvas} canvasWrapper - Canvas.\n\t * @param {EventAggregator} eventAggregator - Event mediator.\n\t */\n\tfunction RectangleTool(canvasWrapper, eventAggregator, toolOptions) {\n\t    _classCallCheck(this, RectangleTool);\n\t\n\t    var currWidth, currHeight, startY, startX;\n\t\n\t    eventAggregator.subscribeTo(_canvasConst2.default.TOOL.RECTANGLE, 'RectangleTool', attachRectangleListener);\n\t    var callbackCtx = this;\n\t    var canvas = canvasWrapper.canvas;\n\t\n\t    function notify(message) {\n\t        eventAggregator.notify('TOOL_USAGE', _canvasConst2.default.TOOL.RECTANGLE, message);\n\t    }\n\t\n\t    function done() {\n\t        notify('inactive');\n\t        detachRectangleListener();\n\t        canvasWrapper.enableSelection(true);\n\t    }\n\t\n\t    function detachRectangleListener() {\n\t        canvas.off('mouse:down', mouseDown);\n\t        canvas.off('mouse:move', drawRectangle);\n\t        canvas.off('mouse:up', drawRectangleDone);\n\t\n\t        rect = undefined;\n\t        eventAggregator.unsubscribeTo('keydown', 'RectangleTool');\n\t    }\n\t\n\t    function drawRectangle(options) {\n\t\n\t        var pointer = canvas.getPointer(options.e);\n\t\n\t        var top = void 0,\n\t            left = void 0,\n\t            width = pointer.x - startX,\n\t            height = pointer.y - startY;\n\t        currHeight = Math.abs(height);\n\t        currWidth = Math.abs(width);\n\t\n\t        if (width < 0) {\n\t            left = pointer.x;\n\t        } else {\n\t            left = startX;\n\t        }\n\t\n\t        if (height < 0) {\n\t            top = pointer.y;\n\t        } else {\n\t            top = startY;\n\t        }\n\t\n\t        rect.set({\n\t            'top': top,\n\t            'left': left,\n\t            'width': currWidth,\n\t            'height': currHeight\n\t        });\n\t\n\t        rect.setCoords();\n\t        canvas.renderAll();\n\t    }\n\t    function drawRectangleDone(options) {\n\t        canvas.off('mouse:move', drawRectangle);\n\t        canvas.off('mouse:up', drawRectangleDone);\n\t\n\t        if (Math.abs(currWidth) < 5 && Math.abs(currHeight) < 5) {\n\t            canvas.remove(rect);\n\t            return;\n\t        }\n\t\n\t        rect.set({ opacity: 0.5 });\n\t        canvas.renderAll();\n\t    }\n\t\n\t    function mouseDown(options) {\n\t        var pointer = canvas.getPointer(options.e);\n\t        currWidth = currHeight = 0;\n\t\n\t        startY = pointer.y;\n\t        startX = pointer.x;\n\t\n\t        rect = new fabric.Rect({\n\t            left: startX,\n\t            top: startY,\n\t            width: 4,\n\t            borderColor: toolOptions.color,\n\t            height: 4,\n\t            fill: toolOptions.color,\n\t            opacity: 0.3,\n\t            hasControls: true,\n\t            hasRotatingPoint: false,\n\t            originX: 'left',\n\t            originY: 'top',\n\t            selectable: false\n\t        });\n\t\n\t        canvas.add(rect);\n\t        rect.setCoords();\n\t        canvas.renderAll();\n\t        canvas.on('mouse:move', drawRectangle);\n\t        canvas.on('mouse:up', drawRectangleDone);\n\t    }\n\t\n\t    function attachRectangleListener(topic, sender, payload) {\n\t        if (payload === 'toolbar-deactivate') {\n\t            done();\n\t            return;\n\t        }\n\t        eventAggregator.subscribeTo('keydown', 'RectangleTool', function (topic, sender, keyCode) {\n\t            if (keyCode === 27) {\n\t                done();\n\t            }\n\t        }, callbackCtx);\n\t        canvasWrapper.enableSelection(false);\n\t        notify('active');\n\t\n\t        canvas.on('mouse:down', mouseDown);\n\t    }\n\t};\n\t\n\texports.default = RectangleTool;\n\n/***/ },\n/* 12 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t\tvalue: true\n\t});\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\t/**\n\t * A tool to reset the canvas, i.e. remove all objects.\n\t */\n\t\n\tvar ResetTool =\n\t/**\n\t * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t * @constructor\n\t * @param {Canvas} canvasWrapper - Canvas.\n\t * @param {EventAggregator} eventAggregator - Event mediator.\n\t */\n\tfunction ResetTool(canvasWrapper, eventAggregator) {\n\t\t_classCallCheck(this, ResetTool);\n\t\n\t\teventAggregator.subscribeTo(_canvasConst2.default.TOOL.RESET, 'ResetTool', initClear);\n\t\tfunction initClear(topic, sender, payload) {\n\t\t\tif (payload !== 'toolbar-deactivate' && confirm('This will restore your image to its default state.\\nAll your modifications will be deleted.\\nDo you want to continue?')) {\n\t\t\t\tclearAllElements();\n\t\t\t}\n\t\t\teventAggregator.notify('TOOL_USAGE', _canvasConst2.default.TOOL.RESET, 'inactive');\n\t\t}\n\t\n\t\tfunction clearAllElements() {\n\t\t\tvar c = canvasWrapper.canvas;\n\t\t\tvar all = c.getObjects();\n\t\t\tfor (var i = all.length - 1; i >= 0; i--) {\n\t\t\t\tc.remove(all[i]);\n\t\t\t}\n\t\t}\n\t};\n\t\n\texports.default = ResetTool;\n\n/***/ },\n/* 13 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar editorHeight = 30;\n\t\n\t/**\n\t * A tool to create a text editor in the canvas.\n\t */\n\t\n\tvar TextTool =\n\t/**\n\t * Tools contructor. Is provided with canvas-wrapper and eventAggregator by contract.\n\t * @constructor\n\t * @param {Canvas} canvasWrapper - Canvas.\n\t * @param {EventAggregator} eventAggregator - Event mediator.\n\t */\n\tfunction TextTool(canvasWrapper, eventAggregator, toolOptions) {\n\t    _classCallCheck(this, TextTool);\n\t\n\t    var canvas = canvasWrapper.canvas;\n\t    var editor;\n\t    eventAggregator.subscribeTo(_canvasConst2.default.TOOL.TEXT, 'TextTool', textTool);\n\t    eventAggregator.subscribeTo('keydown', 'TextTool', function (topic, sender, keyCode) {\n\t        if (keyCode === 27) {\n\t            abort();\n\t        }\n\t    });\n\t\n\t    function notify(message) {\n\t        eventAggregator.notify('TOOL_USAGE', _canvasConst2.default.TOOL.TEXT, message);\n\t    }\n\t\n\t    function abort() {\n\t        if (editor) {\n\t            canvas.remove(editor);\n\t            editor = undefined;\n\t            notify('inactive');\n\t        }\n\t    }\n\t    function textTool(topic, sender, payload) {\n\t        if (payload !== 'toolbar-click') {\n\t            abort();\n\t            return;\n\t        }\n\t        notify('active');\n\t        editor = new fabric.IText('Click to leave a comment', {\n\t            fontFamily: toolOptions.fontFamily,\n\t            fontSize: toolOptions.fontSize,\n\t            left: 100,\n\t            top: -40,\n\t            fill: toolOptions.color,\n\t            hasControls: false\n\t        });\n\t\n\t        canvas.add(editor);\n\t\n\t        var onMove = function onMove(options) {\n\t            if (editor) {\n\t                var pointer = canvas.getPointer(options.e);\n\t                editor.set({\n\t                    'top': pointer.y,\n\t                    'left': pointer.x\n\t                });\n\t                editor.setCoords();\n\t                canvas.renderAll();\n\t            }\n\t        };\n\t        canvas.on('mouse:move', onMove);\n\t\n\t        function detachTextListener() {\n\t            if (editor) {\n\t                canvas.off('mouse:move', onMove);\n\t                canvas.off('mouse:up', detachTextListener);\n\t                editor.setCoords();\n\t                editor = undefined;\n\t                canvas.renderAll();\n\t                notify('inactive');\n\t            }\n\t        }\n\t        canvas.on('mouse:up', detachTextListener);\n\t    }\n\t};\n\t\n\texports.default = TextTool;\n\n/***/ },\n/* 14 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _arrowTool = __webpack_require__(7);\n\t\n\tvar _arrowTool2 = _interopRequireDefault(_arrowTool);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/**\n\t * Default Arrow options.\n\t */\n\tvar defaultToolProps = {\n\t  label: 'Arrow',\n\t  color: _canvasConst2.default.DEFAULT_COLOR,\n\t  activeColor: '#55f',\n\t  size: 15,\n\t  lineWidth: 4\n\t};\n\t\n\tnew _browserApi2.default().getFromWindow('redraw').registerTool(_canvasConst2.default.TOOL.ARROW, _arrowTool2.default, defaultToolProps);\n\n/***/ },\n/* 15 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _deleteTool = __webpack_require__(8);\n\t\n\tvar _deleteTool2 = _interopRequireDefault(_deleteTool);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/**\n\t * Default Delete options.\n\t */\n\tvar defaultToolProps = {\n\t  label: 'Delete'\n\t};\n\t\n\tnew _browserApi2.default().getFromWindow('redraw').registerTool(_canvasConst2.default.TOOL.DELETE, _deleteTool2.default, defaultToolProps);\n\n/***/ },\n/* 16 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _horizontalLineTool = __webpack_require__(9);\n\t\n\tvar _horizontalLineTool2 = _interopRequireDefault(_horizontalLineTool);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/**\n\t * Default Horizontal Line options.\n\t */\n\tvar defaultToolProps = {\n\t  label: 'Horizontal Line',\n\t  color: _canvasConst2.default.DEFAULT_COLOR,\n\t  activeColor: '#55f'\n\t};\n\t\n\tnew _browserApi2.default().getFromWindow('redraw').registerTool(_canvasConst2.default.TOOL.HORIZONTAL_LINE, _horizontalLineTool2.default, defaultToolProps);\n\n/***/ },\n/* 17 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _pixelateTool = __webpack_require__(10);\n\t\n\tvar _pixelateTool2 = _interopRequireDefault(_pixelateTool);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/**\n\t * Default Pixelate options.\n\t */\n\tvar defaultToolProps = {\n\t  label: 'Pixelate',\n\t  color: _canvasConst2.default.DEFAULT_COLOR,\n\t  blocksize: 8\n\t};\n\t\n\tnew _browserApi2.default().getFromWindow('redraw').registerTool(_canvasConst2.default.TOOL.PIXELATE, _pixelateTool2.default, defaultToolProps);\n\n/***/ },\n/* 18 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _rectangleTool = __webpack_require__(11);\n\t\n\tvar _rectangleTool2 = _interopRequireDefault(_rectangleTool);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/**\n\t * Default Rectangle options.\n\t */\n\tvar defaultToolProps = {\n\t  label: 'Rectangle',\n\t  color: _canvasConst2.default.DEFAULT_COLOR\n\t};\n\t\n\tnew _browserApi2.default().getFromWindow('redraw').registerTool(_canvasConst2.default.TOOL.RECTANGLE, _rectangleTool2.default, defaultToolProps);\n\n/***/ },\n/* 19 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _resetTool = __webpack_require__(12);\n\t\n\tvar _resetTool2 = _interopRequireDefault(_resetTool);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/**\n\t * Default Reset options.\n\t */\n\tvar defaultToolProps = {\n\t  label: 'Reset'\n\t};\n\t\n\tnew _browserApi2.default().getFromWindow('redraw').registerTool(_canvasConst2.default.TOOL.RESET, _resetTool2.default, defaultToolProps);\n\n/***/ },\n/* 20 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _canvasConst = __webpack_require__(4);\n\t\n\tvar _canvasConst2 = _interopRequireDefault(_canvasConst);\n\t\n\tvar _browserApi = __webpack_require__(2);\n\t\n\tvar _browserApi2 = _interopRequireDefault(_browserApi);\n\t\n\tvar _textTool = __webpack_require__(13);\n\t\n\tvar _textTool2 = _interopRequireDefault(_textTool);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t/**\n\t * Default Text options.\n\t */\n\tvar defaultToolProps = {\n\t  label: 'Text',\n\t  fontFamily: 'arial',\n\t  fontSize: 18,\n\t  color: _canvasConst2.default.DEFAULT_COLOR\n\t};\n\t\n\tnew _browserApi2.default().getFromWindow('redraw').registerTool(_canvasConst2.default.TOOL.TEXT, _textTool2.default, defaultToolProps);\n\n/***/ }\n/******/ ])\n});\n;\n//# sourceMappingURL=redraw.js.map"],"sourceRoot":"/source/"}